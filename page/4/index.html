<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="format-detection" content="telephone=no"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><link rel="icon" href="/images/icons/favicon-16x16.png?v=2.6.2" type="image/png" sizes="16x16"><link rel="icon" href="/images/icons/favicon-32x32.png?v=2.6.2" type="image/png" sizes="32x32"><meta property="og:type" content="website">
<meta property="og:title" content="MIRACLE">
<meta property="og:url" content="https://planeswalker1205.github.io/page/4/index.html">
<meta property="og:site_name" content="MIRACLE">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="ashen">
<meta name="twitter:card" content="summary"><title>MIRACLE</title><link ref="canonical" href="https://planeswalker1205.github.io/page/4/index.html"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.12.1/css/all.min.css" type="text/css"><link rel="stylesheet" href="/css/index.css?v=2.6.2"><script>var Stun = window.Stun || {};
var CONFIG = {
  root: '/',
  algolia: undefined,
  assistSearch: undefined,
  fontIcon: {"prompt":{"success":"fas fa-check-circle","info":"fas fa-arrow-circle-right","warning":"fas fa-exclamation-circle","error":"fas fa-times-circle"},"copyBtn":"fas fa-copy"},
  sidebar: {"offsetTop":"20px","tocMaxDepth":6},
  header: {"enable":true,"showOnPost":true,"scrollDownIcon":false},
  postWidget: {"endText":true},
  nightMode: {"enable":true},
  back2top: {"enable":true},
  codeblock: {"style":"default","highlight":"light","wordWrap":false},
  reward: false,
  fancybox: false,
  zoomImage: {"gapAside":"20px"},
  galleryWaterfall: undefined,
  lazyload: false,
  pjax: undefined,
  externalLink: {"icon":{"enable":true,"name":"fas fa-external-link-alt"}},
  shortcuts: undefined,
  prompt: {"copyButton":"Copy","copySuccess":"Copy Success","copyError":"Copy Error"},
  sourcePath: {"js":"js","css":"css","images":"images"},
};

window.CONFIG = CONFIG;</script><meta name="generator" content="Hexo 6.1.0"></head><body><div class="container" id="container"><header class="header" id="header"><div class="header-inner"><nav class="header-nav header-nav--fixed"><div class="header-nav-inner"><div class="header-nav-menubtn"><i class="fas fa-bars"></i></div><div class="header-nav-menu"><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/"><span class="header-nav-menu-item__icon"><i class="fas fa-home"></i></span><span class="header-nav-menu-item__text">Home</span></a></div><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/archives/"><span class="header-nav-menu-item__icon"><i class="fas fa-folder-open"></i></span><span class="header-nav-menu-item__text">Archives</span></a></div><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/categories/"><span class="header-nav-menu-item__icon"><i class="fas fa-layer-group"></i></span><span class="header-nav-menu-item__text">Categories</span></a></div><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/tags/"><span class="header-nav-menu-item__icon"><i class="fas fa-tags"></i></span><span class="header-nav-menu-item__text">Tags</span></a></div></div><div class="header-nav-mode"><div class="mode"><div class="mode-track"><span class="mode-track-moon"></span><span class="mode-track-sun"></span></div><div class="mode-thumb"></div></div></div></div></nav><div class="header-banner"><div class="header-banner-info"><div class="header-banner-info__title">MIRACLE</div><div class="header-banner-info__subtitle"></div></div></div></div></header><main class="main" id="main"><div class="main-inner"><div class="content-wrap" id="content-wrap"><div class="content content-home" id="content"><section class="postlist"><article class="postlist-item post"><header class="post-header"><h1 class="post-title"><a class="post-title__link" href="/2020/08/02/Spring-%E5%BC%82%E6%AD%A5%E7%BA%BF%E7%A8%8B%E6%B1%A0/">Spring 异步线程池</a></h1><div class="post-meta"><span class="post-meta-item post-meta-item--createtime"><span class="post-meta-item__icon"><i class="far fa-calendar-plus"></i></span><span class="post-meta-item__info">Created</span><span class="post-meta-item__value">2020-08-02</span></span><span class="post-meta-item post-meta-item--updatetime"><span class="post-meta-item__icon"><i class="far fa-calendar-check"></i></span><span class="post-meta-item__info">Updated</span><span class="post-meta-item__value">2022-05-21</span></span></div></header><div class="post-body"><div class="post-excerpt">
        <h2 id="异步实例">
          <a href="#异步实例" class="heading-link"><i class="fas fa-link"></i></a><a href="#异步实例" class="headerlink" title="异步实例"></a>异步实例</h2>
      <p><strong><font color="DarkBlue">为了满足运维人员的需求，往往需要生成报表交由后台线程操作，生成报表是另外一个线程的任务</font></strong></p>
<p><strong><font color="DarkKhaki">1. 使用Java配置定义线程池和启用异步</font></strong></p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.rediscachetest.tools;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.scheduling.annotation.AsyncConfigurer;</span><br><span class="line"><span class="keyword">import</span> org.springframework.scheduling.annotation.EnableAsync;</span><br><span class="line"><span class="keyword">import</span> org.springframework.scheduling.concurrent.ThreadPoolTaskExecutor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.Executor;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableAsync</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AsymcConfig</span> <span class="keyword">implements</span> <span class="title class_">AsyncConfigurer</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Executor <span class="title function_">getAsyncExecutor</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//定义线程池</span></span><br><span class="line">        <span class="type">ThreadPoolTaskExecutor</span> <span class="variable">taskExecutor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ThreadPoolTaskExecutor</span>();</span><br><span class="line">        <span class="comment">//核心线程数</span></span><br><span class="line">        taskExecutor.setCorePoolSize(<span class="number">10</span>);</span><br><span class="line">        <span class="comment">//线程池最大线程数</span></span><br><span class="line">        taskExecutor.setMaxPoolSize(<span class="number">30</span>);</span><br><span class="line">        <span class="comment">//线程队列最大线程数</span></span><br><span class="line">        taskExecutor.setQueueCapacity(<span class="number">2000</span>);</span><br><span class="line">        <span class="comment">//初始化</span></span><br><span class="line">        taskExecutor.initialize();</span><br><span class="line">        <span class="keyword">return</span> taskExecutor;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>

<blockquote>
<p>代码中，注解@EnableAsync代表开启Spring异步，这样就可以使用@Async驱动Spring使用异步。但是异步需要提供可用线程池，所以此配置类会哦实现AsyncConfigurer接口，然后重写getAsyncExecutor方法进行相关配置。</p>
</blockquote>
<p><strong><font color="DarkKhaki">2. 为了进行测试，定义一个service服务接口和其实现类</font></strong></p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.rediscachetest.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">AsyncService</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">generateReport</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>

<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.rediscachetest.serviceImpl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.rediscachetest.service.AsyncService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.scheduling.annotation.Async;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AsyncServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">AsyncService</span> &#123;</span><br><span class="line">    <span class="meta">@Async</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">generateReport</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//打印异步线程名称</span></span><br><span class="line">        System.out.println(<span class="string">&quot;此线程名称：&quot;</span>+<span class="string">&quot;【&quot;</span>+Thread.currentThread().getName()+<span class="string">&quot;】&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>

<p><strong><font color="DarkKhaki">3. 定义控制器</font></strong></p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.rediscachetest.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.rediscachetest.service.AsyncService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/async&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">asyController</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">AsyncService</span> <span class="variable">asyncService</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="meta">@GetMapping(&quot;/table&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">asyncPage</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;请求线程名称:&quot;</span>+<span class="string">&quot;【&quot;</span>+Thread.currentThread().getName()+<span class="string">&quot;】&quot;</span>);</span><br><span class="line">        <span class="comment">//调用异步服务</span></span><br><span class="line">        asyncService.generateReport();</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;async&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>

<blockquote>
<p>启动服务后，对asyncPage方法进行请求，会发现控制器的方法和异步方法的线程名称是不同的，说明它们是由不同的线程运行的</p>
</blockquote>
<p><img src="/2020/08/02/Spring-%E5%BC%82%E6%AD%A5%E7%BA%BF%E7%A8%8B%E6%B1%A0/QQ%E6%88%AA%E5%9B%BE20200803173132.png"></p>

        <h2 id="异步消息">
          <a href="#异步消息" class="heading-link"><i class="fas fa-link"></i></a><a href="#异步消息" class="headerlink" title="异步消息"></a>异步消息</h2>
      
        <h3 id="JMS实例-ActiveMQ">
          <a href="#JMS实例-ActiveMQ" class="heading-link"><i class="fas fa-link"></i></a><a href="#JMS实例-ActiveMQ" class="headerlink" title="JMS实例-ActiveMQ"></a><font color="Brown">JMS实例-ActiveMQ</font></h3>
      <p><strong>1. ActiveMQ的使用，首先在<span class="exturl"><a class="exturl__link" target="_blank" rel="noopener" href="http://activemq.apache.org/download.html%E4%B8%8B%E8%BD%BDActiveMQ%E3%80%82%E7%84%B6%E5%90%8E%E8%BF%9B%E5%85%A5bin%E7%9B%AE%E5%BD%95%E4%B8%8B%E5%90%AF%E5%8A%A8activemq.bat(Windows%E7%B3%BB%E7%BB%9F).%E8%BF%90%E8%A1%8C%E4%B9%8B%E5%90%8E%EF%BC%8C%E6%89%93%E5%BC%80%E6%B5%8F%E8%A7%88%E5%99%A8%E8%AE%BF%E9%97%AEhttp://localhost:8161/admin/%EF%BC%8C%E4%BD%BF%E7%94%A8%E7%94%A8%E6%88%B7%E5%90%8Damdin%E5%92%8C%E5%AF%86%E7%A0%81admin%E7%99%BB%E5%BD%95%E6%88%90%E5%8A%9F%E5%90%8E%EF%BC%8C%E8%AF%B4%E6%98%8EActiveMQ%E5%B7%B2%E7%BB%8F%E5%90%AF%E5%8A%A8%E5%A5%BD%E4%BA%86">http://activemq.apache.org/download.html下载ActiveMQ。然后进入bin目录下启动activemq.bat(Windows系统).运行之后，打开浏览器访问http://localhost:8161/admin/，使用用户名amdin和密码admin登录成功后，说明ActiveMQ已经启动好了</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></strong></p>
<p><strong>2. 配置支持ActiveMQ的依赖</strong></p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">	&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">	&lt;artifactId&gt;spring-boot-starter-activemq&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">	&lt;groupId&gt;org.messaginghub&lt;/groupId&gt;</span><br><span class="line">	&lt;artifactId&gt;pooled-jms&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>

<blockquote>
<p>Spring Boot放弃了对自动配置的支持，activemq-pool而支持pooled-jms,所以第二项依赖配置的是pooled-jms。</p>
</blockquote>
<p><strong>3. 配置ActiveMQ和JMS信息</strong></p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"># ActiveMQ地址</span><br><span class="line">spring.activemq.broker-url=tcp:<span class="comment">//localhost:61616</span></span><br><span class="line"># 用户名密码配置</span><br><span class="line">spring.activemq.user=admin</span><br><span class="line">spring.activemq.password=admin</span><br><span class="line"># 是否使用发布订阅模式默认为<span class="literal">false</span>，即点对点模式</span><br><span class="line">spring.jms.pub-sub-domain=<span class="literal">true</span></span><br><span class="line">#默认目的地址</span><br><span class="line">spring.jms.template.<span class="keyword">default</span>-destination=activemq.<span class="keyword">default</span>.destination</span><br><span class="line">#是否启用连接池</span><br><span class="line">spring.activemq.pool.enabled=<span class="literal">true</span></span><br><span class="line"># 连接池最大连接数量配置</span><br><span class="line">spring.activemq.pool.max-connections=<span class="number">50</span></span><br></pre></td></tr></table></div></figure>

<p>如果想要传递的消息是pojo对象，可配置其信任pojo包</p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 配置ActiveMQ信任ServerUser类</span><br><span class="line">spring.activemq.packages.trusted=com.example.rediscachetest.pojo,java.<span class="type">long</span></span><br><span class="line">#若让ActiveMQ信任所有的包，可配置</span><br><span class="line">#spring.activemq.packages.trust-all=<span class="literal">true</span></span><br></pre></td></tr></table></div></figure>

<p><strong>4. 定义传递普通消息的服务接口和传递pojo类的服务接口</strong></p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.rediscachetest.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ActiveMQService</span> &#123;</span><br><span class="line">    <span class="comment">//发送消息</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sendMsg</span><span class="params">(String msg)</span>;</span><br><span class="line">    <span class="comment">//接收消息</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">receiveMsg</span><span class="params">(String msg)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>

<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.rediscachetest.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.rediscachetest.pojo.ServerUser;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ActiveMQUserService</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//发送消息</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sendMsg</span><span class="params">(ServerUser serverUser)</span>;</span><br><span class="line">        <span class="comment">//接收消息</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">receiveMsg</span><span class="params">(ServerUser serverUser)</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>

<p><strong>5. 其实现类</strong></p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.rediscachetest.serviceImpl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.rediscachetest.service.ActiveMQService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.jms.annotation.JmsListener;</span><br><span class="line"><span class="keyword">import</span> org.springframework.jms.core.JmsTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ActivveMQServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">ActiveMQService</span> &#123;</span><br><span class="line">    <span class="comment">//注入由SpringBoot自动产生的jmsTemplate</span></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">JmsTemplate</span> <span class="variable">jmsTemplate</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sendMsg</span><span class="params">(String msg)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;发送消息:【&quot;</span>+msg+<span class="string">&quot;】&quot;</span>);</span><br><span class="line">        jmsTemplate.convertAndSend(msg);</span><br><span class="line">        <span class="comment">//自定义发送地址，因为配置中默认了地址所以可不写</span></span><br><span class="line">        <span class="comment">//jmsTemplate.convertAndSend(&quot;your-destination&quot;,msg);</span></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//使用注解，监听地址发送过来的消息</span></span><br><span class="line">    <span class="meta">@JmsListener(destination = &quot;$&#123;spring.jms.template.default-destination&#125;&quot;)</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">receiveMsg</span><span class="params">(String msg)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;接受到消息:【&quot;</span>+msg+<span class="string">&quot;】&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>


<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.rediscachetest.serviceImpl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.rediscachetest.pojo.ServerUser;</span><br><span class="line"><span class="keyword">import</span> com.example.rediscachetest.service.ActiveMQUserService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.jms.annotation.JmsListener;</span><br><span class="line"><span class="keyword">import</span> org.springframework.jms.core.JmsTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ActiveMQUserServviceImpl</span> <span class="keyword">implements</span> <span class="title class_">ActiveMQUserService</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">JmsTemplate</span> <span class="variable">jmsTemplate</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="comment">//自定义地址</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">myDestination</span> <span class="operator">=</span>  <span class="string">&quot;my-destination&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sendMsg</span><span class="params">(ServerUser serverUser)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;发送消息:【&quot;</span>+serverUser+<span class="string">&quot;】&quot;</span>);</span><br><span class="line">        jmsTemplate.convertAndSend(myDestination,serverUser);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="comment">//监控自定义地址</span></span><br><span class="line">    <span class="meta">@JmsListener(destination = myDestination)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">receiveMsg</span><span class="params">(ServerUser serverUser)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;接收到消息:【&quot;</span>+serverUser+<span class="string">&quot;】&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>

<blockquote>
<p>实现类的发送地址既可以自定义，也可以默认使用application.properties文件中配置的地址。监控自定义地址和发送消息时的地址是一致的。如果使用的是默认的地址，那么只需要写成在application.properties中配置的地址的名称就可以了</p>
</blockquote>
<blockquote>
<p>POJO类必须是可以序列化的，因此必须继承Serializable。</p>
</blockquote>
<blockquote>
<p>由于POJO类的ID属性是Long类型的。所以在配置信任的包时也需要加上Java.Long的包</p>
</blockquote>
<p><strong>6. 控制器测试</strong></p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">package</span> com.example.rediscachetest.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.rediscachetest.pojo.ServerUser;</span><br><span class="line"><span class="keyword">import</span> com.example.rediscachetest.service.ActiveMQService;</span><br><span class="line"><span class="keyword">import</span> com.example.rediscachetest.service.ActiveMQUserService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.ResponseBody;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/activemq&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">activemqController</span> &#123;</span><br><span class="line">    <span class="comment">//注入服务对象</span></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">ActiveMQService</span> <span class="variable">activeMQService</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">ActiveMQUserService</span> <span class="variable">activeMQUserService</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="comment">//测试普通消息的发送</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/msg&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Map&lt;String,Object&gt; <span class="title function_">msg</span><span class="params">(String message)</span>&#123;</span><br><span class="line"></span><br><span class="line">        Map&lt;String,Object&gt; msgMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        msgMap.put(<span class="string">&quot;success&quot;</span>,<span class="literal">true</span>);</span><br><span class="line">        msgMap.put(<span class="string">&quot;message&quot;</span>,message);</span><br><span class="line">        activeMQService.sendMsg(message);</span><br><span class="line">        <span class="keyword">return</span>  msgMap;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//测试ServerUser对象的发送</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/usermsg&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Map&lt;String,Object&gt; <span class="title function_">userMsg</span><span class="params">(Long id,String userName,String note)</span>&#123;</span><br><span class="line"></span><br><span class="line">        Map&lt;String,Object&gt; msgMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        <span class="type">ServerUser</span> <span class="variable">serUser</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ServerUser</span>();</span><br><span class="line">        serUser.setId(id);</span><br><span class="line">        serUser.setName(userName);</span><br><span class="line">        serUser.setRemark(note);</span><br><span class="line">        msgMap.put(<span class="string">&quot;success&quot;</span>,<span class="literal">true</span>);</span><br><span class="line">        msgMap.put(<span class="string">&quot;sUser&quot;</span>,serUser);</span><br><span class="line">        activeMQUserService.sendMsg(serUser);</span><br><span class="line">        <span class="keyword">return</span>  msgMap;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>

<p>最终效果:</p>
<p><img src="/2020/08/02/Spring-%E5%BC%82%E6%AD%A5%E7%BA%BF%E7%A8%8B%E6%B1%A0/QQ%E6%88%AA%E5%9B%BE20200803203953.png"></p>
<p><img src="/2020/08/02/Spring-%E5%BC%82%E6%AD%A5%E7%BA%BF%E7%A8%8B%E6%B1%A0/QQ%E6%88%AA%E5%9B%BE20200803204028.png"></p>

        <h2 id="定时任务">
          <a href="#定时任务" class="heading-link"><i class="fas fa-link"></i></a><a href="#定时任务" class="headerlink" title="定时任务"></a>定时任务</h2>
      <p><strong><font color="Brown">Spring中使用定时器，首先要在配置文件中加入@EnableScheduling，就能够使用注解驱动定时任务的机制。然后可以通过注解@Scheduled去配置如何定时。下面首先加入Spring Boot启动类标注@EnableScheduling。再开发服务类</font></strong></p>
<p><strong>1. 简易定时任务服务类</strong></p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.rediscachetest.serviceImpl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.scheduling.annotation.Async;</span><br><span class="line"><span class="keyword">import</span> org.springframework.scheduling.annotation.Scheduled;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ScheduleServiceImpl</span> &#123;</span><br><span class="line">    <span class="comment">//计数器</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">count1</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">    <span class="type">int</span> <span class="variable">count2</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">    <span class="comment">// 每隔一秒执行一次</span></span><br><span class="line">    <span class="meta">@Scheduled(fixedRate = 1000)</span></span><br><span class="line">    <span class="comment">//使用异步执行</span></span><br><span class="line">    <span class="meta">@Async</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">job1</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;【&quot;</span>+Thread.currentThread().getName()+<span class="string">&quot;】，【job1】每一秒钟执行一次，执行第&quot;</span>+count1+<span class="string">&quot;次&quot;</span>);</span><br><span class="line">        count1++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Scheduled(fixedRate = 1000)</span></span><br><span class="line">    <span class="meta">@Async</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">job2</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;【&quot;</span>+Thread.currentThread().getName()+<span class="string">&quot;】，【job2】每一秒钟执行一次，执行第&quot;</span>+count2+<span class="string">&quot;次&quot;</span>);</span><br><span class="line">        count2++;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></div></figure>

<blockquote>
<p>使用@Async注解代表这需要使用异步线程执行，异步配置参考上一节。</p>
</blockquote>
<p><strong>2. 启动后效果如图</strong></p>
<p><img src="/2020/08/02/Spring-%E5%BC%82%E6%AD%A5%E7%BA%BF%E7%A8%8B%E6%B1%A0/QQ%E6%88%AA%E5%9B%BE20200805181440.png"></p>
<blockquote>
<p>这说明Spring每秒钟都会运行这个标注了@Scheduled的方法，并且是在不同的线程之间运行。</p>
</blockquote>
<p>如果需要指定为更具体的某一时间，则可用表达式来完成。</p>

        <h2 id="WebSocket应用">
          <a href="#WebSocket应用" class="heading-link"><i class="fas fa-link"></i></a><a href="#WebSocket应用" class="headerlink" title="WebSocket应用"></a>WebSocket应用</h2>
      <p><strong>1. 加入依赖</strong></p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">	&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">	&lt;artifactId&gt;spring-boot-starter-security&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">	&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">	&lt;artifactId&gt;spring-boot-starter-websocket&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></div></figure>

<p><strong>2. 自定义WebScoket服务端点配置</strong></p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.rediscachetest.tools;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.socket.server.standard.ServerEndpointExporter;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebSocketConfig</span> &#123;</span><br><span class="line">    <span class="comment">//创建服务器端点</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> ServerEndpointExporter <span class="title function_">serverEndpointExporter</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ServerEndpointExporter</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>

<blockquote>
<p>有了这个Bean，就可以使用@ServerEndpoint定义一个端点服务类，在这个服务类中，可以定义WebSocket的打开，关闭，错误和发送消息的方法。</p>
</blockquote>
<p><strong>3. 定义WebSocket服务端站点</strong></p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.rediscachetest.serviceImpl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.websocket.*;</span><br><span class="line"><span class="keyword">import</span> javax.websocket.server.ServerEndpoint;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.CopyOnWriteArraySet;</span><br><span class="line"></span><br><span class="line"><span class="meta">@ServerEndpoint(&quot;/ws&quot;)</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebSocketServiceImpl</span> &#123;</span><br><span class="line">    <span class="comment">// 静态变量 用来记录当前在线连接数，且应该是线程安全的</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> <span class="variable">onlineCount</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="comment">// concurrent包的线程安全Set，用来存放每个客户端对应的WebSocketServiceImpl对象</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> CopyOnWriteArraySet&lt;WebSocketServiceImpl&gt; webSocketSet = <span class="keyword">new</span> <span class="title class_">CopyOnWriteArraySet</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//与某个客户端的连接回话，需要通过它来给客户端发送数据</span></span><br><span class="line">    <span class="keyword">private</span> Session session;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 连接建立成功调用的方法</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@OnOpen</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onOpen</span><span class="params">(Session session)</span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.session = session;</span><br><span class="line">        webSocketSet.add(<span class="built_in">this</span>);</span><br><span class="line">        addOnlineCount();</span><br><span class="line">        System.out.println(<span class="string">&quot;有新的连接加入!当前在线人数为:&quot;</span>+getOnlineCount());</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            sendMessage(<span class="string">&quot;有新的连接加入了!&quot;</span>);</span><br><span class="line">        &#125;<span class="keyword">catch</span> (IOException e)&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;IO异常&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 连接关闭</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@OnClose</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onClose</span><span class="params">()</span>&#123;</span><br><span class="line">        webSocketSet.remove(<span class="built_in">this</span>);</span><br><span class="line">        subOnlineCount();</span><br><span class="line">        System.out.println(<span class="string">&quot;有一连接关闭！当前在线人数为:&quot;</span>+getOnlineCount());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 收到客户端消息后调用的方法</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@OnMessage</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onMessage</span><span class="params">(String message,Session session)</span>&#123;</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;来自客户端的消息:&quot;</span>+message);</span><br><span class="line">        <span class="comment">//群发消息</span></span><br><span class="line">        <span class="keyword">for</span>(WebSocketServiceImpl item:webSocketSet)&#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                item.sendMessage(message);</span><br><span class="line">            &#125;<span class="keyword">catch</span> (IOException e)&#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 发生错误时调用</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@OnError</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onError</span><span class="params">(Session session,Throwable error)</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;发生错误！&quot;</span>);</span><br><span class="line">        error.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 发送消息</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> message 客户端消息</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">sendMessage</span><span class="params">(String message)</span> <span class="keyword">throws</span> IOException&#123;</span><br><span class="line">        <span class="built_in">this</span>.session.getBasicRemote().sendText(message);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//返回在线数</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">synchronized</span> <span class="type">int</span> <span class="title function_">getOnlineCount</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> onlineCount;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//当连接人数增加时</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">addOnlineCount</span><span class="params">()</span>&#123;</span><br><span class="line">        WebSocketServiceImpl.onlineCount++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//当连接人数减少时</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">subOnlineCount</span><span class="params">()</span>&#123;</span><br><span class="line">        WebSocketServiceImpl.onlineCount--;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>

<blockquote>
<p>因为每一个客户端打开时，都会为其创建一个WebSocketServiceImpl对象，所以这里的打开方法中都会计数并且将这个对象保存到Set集合中。这样就可以知道拥有多少条连接。对于消息发送的方法，则是通过遍历对所有客户端的连接都给予发送消息，所以所有的连接都可以接收这个消息。如果只需要发送特定用户，则需要得到用户的信息再发送。</p>
</blockquote>
<p><strong>4. 页面开发</strong></p>
<figure class="highlight jsp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page pageEncoding=<span class="string">&quot;utf-8&quot;</span>%&gt;</span><br><span class="line">&lt;%@ taglib prefix=<span class="string">&quot;c&quot;</span> uri=<span class="string">&quot;http://java.sun.com/jsp/jstl/core&quot;</span>%&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt;验证用户&lt;/title&gt;</span><br><span class="line">    &lt;<span class="type">script</span> <span class="variable">src</span> <span class="operator">=</span> <span class="string">&quot;https://code.jquery.com/jquery-3.0.0.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    测试WebSocket站点</span><br><span class="line">&lt;br/&gt;</span><br><span class="line">    &lt;input type=<span class="string">&quot;text&quot;</span> id = <span class="string">&quot;message&quot;</span>/&gt;</span><br><span class="line">    &lt;<span class="type">button</span> <span class="variable">onclick</span> <span class="operator">=</span> <span class="string">&quot;sendMessage()&quot;</span>&gt;发送消息&lt;/button&gt;</span><br><span class="line">    &lt;button onclick=<span class="string">&quot;closeWebSocket()&quot;</span>&gt;关闭WebScoket连接&lt;/button&gt;</span><br><span class="line">    &lt;<span class="type">div</span> <span class="variable">id</span> <span class="operator">=</span> <span class="string">&quot;context&quot;</span>&gt;&lt;/div&gt;</span><br><span class="line"></span><br><span class="line">&lt;script type=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line">    <span class="type">var</span> <span class="variable">webSocket</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="comment">// 判断当前浏览器是否支持WebSocket</span></span><br><span class="line">    <span class="keyword">if</span>(<span class="string">&#x27;WebSocket&#x27;</span> in window)&#123;</span><br><span class="line">        <span class="comment">//创建WebSocket对象，连接服务端点</span></span><br><span class="line">        webSocket = <span class="keyword">new</span> <span class="title class_">WebSocket</span>(<span class="string">&quot;ws://localhost:8080/ws&quot;</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">        alert(<span class="string">&quot;不支持WebSocket&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//连接发生错误回调</span></span><br><span class="line">    webSocket.onerror = function()&#123;</span><br><span class="line">        appendMessage(<span class="string">&quot;error&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//连接成功回调</span></span><br><span class="line">    webSocket.onopen = function(event)&#123;</span><br><span class="line">        appendMessage(<span class="string">&quot;open&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//接收到消息回调</span></span><br><span class="line">    webSocket.onmessage = function(event)&#123;</span><br><span class="line">        appendMessage(event.data);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//连接关闭回调方法</span></span><br><span class="line">    webSocket.onclose = function()&#123;</span><br><span class="line">        appendMessage(<span class="string">&quot;close&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//监听窗口关闭时间，当窗口关闭时，主动关闭websocket连接</span></span><br><span class="line">    <span class="comment">//防止连接还没断开就关闭窗口导致server端发生异常</span></span><br><span class="line"></span><br><span class="line">    window.onbeforeunload = function()&#123;</span><br><span class="line">        webSocket.close();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//将消息显示在网页上</span></span><br><span class="line">    function <span class="title function_">appendMessage</span><span class="params">(message)</span>&#123;</span><br><span class="line">        <span class="type">var</span> <span class="variable">context</span> <span class="operator">=</span> $(<span class="string">&quot;#context&quot;</span>).html()+<span class="string">&quot;&lt;br/&gt;&quot;</span>+message;</span><br><span class="line">        $(<span class="string">&quot;#context&quot;</span>).html(context);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//关闭连接</span></span><br><span class="line">    function <span class="title function_">closeWebSocket</span><span class="params">()</span>&#123;</span><br><span class="line">        webSocket.close();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//发送消息</span></span><br><span class="line">    function <span class="title function_">sendMessage</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">var</span> <span class="variable">message</span> <span class="operator">=</span> $(<span class="string">&quot;#message&quot;</span>).val();</span><br><span class="line">        webSocket.send(message);</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>

<p><strong>5. 通过控制器访问页面</strong></p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.rediscachetest.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/webs&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">websocketController</span> &#123;</span><br><span class="line">    <span class="meta">@GetMapping(&quot;/sockets&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">messagePage</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;user/websocket&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>


        <h3 id="使用Stomp">
          <a href="#使用Stomp" class="heading-link"><i class="fas fa-link"></i></a><a href="#使用Stomp" class="headerlink" title="使用Stomp"></a>使用Stomp</h3>
      <p><font color="#A52A2A">并不是所有的浏览器都能够支持WebSocket协议，为了使得WebSocket的应用能够兼容那些不支持的浏览器，可以使用Stomp协议进行处理</font></p>
<p><strong>1. 在配置文件中加入注解@EnableWebSocketMessageBroker，此注解会启动WebSocket下的子协议STOMP、为了配置这个协议，可以实现接口WebSocketMessageBrokerConfigurer</strong></p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.rediscachetest.tools;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> ...</span><br><span class="line"><span class="meta">@EnableWebSocketMessageBroker</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebSocketConfig</span> <span class="keyword">implements</span> <span class="title class_">WebSocketMessageBrokerConfigurer</span> &#123;</span><br><span class="line">    <span class="comment">//创建服务器端点</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> ServerEndpointExporter <span class="title function_">serverEndpointExporter</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ServerEndpointExporter</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">registerStompEndpoints</span><span class="params">(StompEndpointRegistry registry)</span>&#123;</span><br><span class="line">        <span class="comment">// 增加一个聊天服务端点（任何用户都会收到消息）</span></span><br><span class="line">        registry.addEndpoint(<span class="string">&quot;/socket&quot;</span>).withSockJS();</span><br><span class="line">        <span class="comment">//增加一个用户端点服务（特定用户才会受到消息）</span></span><br><span class="line">        registry.addEndpoint(<span class="string">&quot;/wsuser&quot;</span>).withSockJS();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">configureMessageBroker</span><span class="params">(MessageBrokerRegistry registry)</span>&#123;</span><br><span class="line">        <span class="comment">//客户端订阅路径前缀</span></span><br><span class="line">        registry.enableSimpleBroker(<span class="string">&quot;/sub&quot;</span>,<span class="string">&quot;/queue&quot;</span>);</span><br><span class="line">        <span class="comment">//服务端点请求前缀</span></span><br><span class="line">        registry.setApplicationDestinationPrefixes(<span class="string">&quot;/request&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>

<blockquote>
<p><b><font color="#D2691E">registerStompEndpoints()方法中定义了两个服务端点，还加入了withSockJS方法，代表支持SockJS这种第三方支持WebSocket请求的JavaScript1框架。</font></b></p>
</blockquote>
<blockquote>
<p><b><font color="#D2691E">configureMessageBroker()方法注册请求的前缀和客户端订阅的前缀</font></b></p>
</blockquote>
<p><strong>2. Stomp下的控制器</strong></p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.rediscachetest.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> ...</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.security.Principal;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/websocket&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">websocketController</span> &#123;</span><br><span class="line">    <span class="comment">/*@GetMapping(&quot;/sockets&quot;)</span></span><br><span class="line"><span class="comment">    public String messagePage()&#123;</span></span><br><span class="line"><span class="comment">        return &quot;user/websocket&quot;;</span></span><br><span class="line"><span class="comment">    &#125;*/</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">SimpMessagingTemplate</span> <span class="variable">simpMessagingTemplate</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//发送页面</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/send&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">send</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;web/send&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//接收页面</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/receive&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">receive</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;web/receive&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//对特定用户的发送页面</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/sendUser&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">sendUser</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;web/send-user&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//特定用户接收页面</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/receiveUser&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">reveiveUser</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;web/receive-user&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//定义消息请求路径</span></span><br><span class="line">    <span class="meta">@MessageMapping(&quot;/send&quot;)</span></span><br><span class="line">    <span class="comment">//定义结果发送到特定路径</span></span><br><span class="line">    <span class="meta">@SendTo(&quot;/sub/chat&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">sendMsg</span><span class="params">(String value)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> value;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//将消息发送给特定用户</span></span><br><span class="line">    <span class="meta">@MessageMapping(&quot;/sendUser&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sendToUser</span><span class="params">(Principal principal,String body)</span>&#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">srcUser</span> <span class="operator">=</span> principal.getName();</span><br><span class="line">        <span class="comment">//解析用户和小熊</span></span><br><span class="line">        String[] args = body.split(<span class="string">&quot;,&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">desUser</span> <span class="operator">=</span> args[<span class="number">0</span>];</span><br><span class="line">        <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> <span class="string">&quot;【&quot;</span>+srcUser+<span class="string">&quot;】给你发来消息:&quot;</span>+args[<span class="number">1</span>];</span><br><span class="line">        <span class="comment">//发送到用户和监听地址</span></span><br><span class="line">        simpMessagingTemplate.convertAndSendToUser(desUser,<span class="string">&quot;/queue/customer&quot;</span>,message);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></div></figure>

<blockquote>
<p><b><font color="#D2691E">此处的send，receive，sendUser，reveiveUser方法都是定义了Spring MVC的视图，这样就可以指向4个jsp视图。 sendMsg和sendToUser方法都标注了@MessageMapping，和@RequestMapping类似，它是定义WebSocket请求的路径，当然需要与WebSocketConfig所定义的前缀(“&#x2F;request”)连用。</font></b></p>
</blockquote>
<blockquote>
<p><b><font color="#D2691E">sendMsg方法，它还会标注@SendTo注解，然后配置为”&#x2F;sub&#x2F;chat“，说明在执行完这个方法后，会将返回结果发送到订阅的这个目的地中，这样客户端就可以得到消息。sendToUser方法，这个方法存在Principal参数，如果你使用了SpringSecurit，这个参数就可以回去当前用户的消息，然后通过SimpMessagingTemplate的convertAndSendToUser方法，就可以设置发送给对应的目的地并且限定特定的用户消息。</font></b></p>
</blockquote>
<p><strong>3. 开启SpringSecurity认证过</strong></p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.rediscachetest.tools;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> ...</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.sql.DataSource;</span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">securityConf</span>  <span class="keyword">extends</span> <span class="title class_">WebSecurityConfigurerAdapter</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">configure</span><span class="params">(AuthenticationManagerBuilder auth)</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//定义3个可以登录的内存用户</span></span><br><span class="line"></span><br><span class="line">        <span class="type">PasswordEncoder</span> <span class="variable">passwordEncoder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BCryptPasswordEncoder</span>();</span><br><span class="line">        <span class="comment">//加入三个内存用户  密码分别为加密后的p1，p2，p3</span></span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">pass1</span> <span class="operator">=</span> passwordEncoder.encode(<span class="string">&quot;p1&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">pass2</span> <span class="operator">=</span> passwordEncoder.encode(<span class="string">&quot;p2&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">pass3</span> <span class="operator">=</span> passwordEncoder.encode(<span class="string">&quot;p3&quot;</span>);</span><br><span class="line"></span><br><span class="line">        auth.inMemoryAuthentication().passwordEncoder(passwordEncoder)</span><br><span class="line">                .withUser(<span class="string">&quot;user1&quot;</span>)</span><br><span class="line">                .password(pass1)</span><br><span class="line">                .roles(<span class="string">&quot;USER&quot;</span>).and().withUser(<span class="string">&quot;user2&quot;</span>)</span><br><span class="line">                .password(pass2)</span><br><span class="line">                .roles(<span class="string">&quot;ADMIN&quot;</span>).and().withUser(<span class="string">&quot;user3&quot;</span>)</span><br><span class="line">                .password(pass3)</span><br><span class="line">                .roles(<span class="string">&quot;USER&quot;</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>

<blockquote>
<p>定义三个可以登录的用户</p>
</blockquote>
<p><strong>4. 发送WebSocket请求的客户端页面</strong></p>
<figure class="highlight jsp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page pageEncoding=<span class="string">&quot;utf-8&quot;</span>%&gt;</span><br><span class="line">&lt;%@ taglib prefix=<span class="string">&quot;c&quot;</span> uri=<span class="string">&quot;http://java.sun.com/jsp/jstl/core&quot;</span>%&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt;stomp&lt;/title&gt;</span><br><span class="line">    &lt;script type=<span class="string">&quot;text/javascript&quot;</span> src = <span class="string">&quot;https://code.jquery.com/jquery-3.0.0.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line">    &lt;script type=<span class="string">&quot;text/javascript&quot;</span>  src = <span class="string">&quot;https://cdn.jsdelivr.net/sockjs/1/sockjs.min.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line">    &lt;<span class="type">script</span> <span class="variable">type</span> <span class="operator">=</span> <span class="string">&quot;text/javascript&quot;</span> src = <span class="string">&quot;../../js/stomp.min.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;div&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &lt;div&gt;</span><br><span class="line">        &lt;<span class="type">button</span> <span class="variable">id</span> <span class="operator">=</span> <span class="string">&quot;connect&quot;</span> onclick = <span class="string">&quot;connect()&quot;</span>&gt;连接&lt;/button&gt;</span><br><span class="line">        &lt;<span class="type">button</span> <span class="variable">id</span> <span class="operator">=</span> <span class="string">&quot;disconnect&quot;</span> disabled = <span class="string">&quot;disabled&quot;</span> onclick = <span class="string">&quot;disconnect()&quot;</span>&gt;断开连接&lt;/button&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &lt;/div&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &lt;<span class="type">div</span> <span class="variable">id</span> <span class="operator">=</span> <span class="string">&quot;convertsationDiv&quot;</span>&gt;</span><br><span class="line">        &lt;p&gt;</span><br><span class="line">            &lt;label&gt;发送的内容&lt;/label&gt;</span><br><span class="line">        &lt;/p&gt;</span><br><span class="line">        &lt;p&gt;</span><br><span class="line">            &lt;<span class="type">textarea</span> <span class="variable">id</span> <span class="operator">=</span> <span class="string">&quot;message&quot;</span> rows = <span class="string">&quot;5&quot;</span>&gt;&lt;/textarea&gt;</span><br><span class="line">        &lt;/p&gt;</span><br><span class="line">        &lt;<span class="type">button</span> <span class="variable">id</span> <span class="operator">=</span> <span class="string">&quot;sendMsg&quot;</span> onclick=<span class="string">&quot;sendMsg()&quot;</span>&gt;Send&lt;/button&gt;</span><br><span class="line">        &lt;<span class="type">p</span> <span class="variable">id</span> <span class="operator">=</span> <span class="string">&quot;response&quot;</span>&gt;&lt;/p&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">&lt;/div&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;script type=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line">    <span class="type">var</span> <span class="variable">stompClient</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//设置连接</span></span><br><span class="line"></span><br><span class="line">    function <span class="title function_">setConnected</span><span class="params">(connected)</span>&#123;</span><br><span class="line"></span><br><span class="line">        $(<span class="string">&quot;#connect&quot;</span>).attr(&#123;<span class="string">&quot;disabled&quot;</span>:connected&#125;);</span><br><span class="line"></span><br><span class="line">        $(<span class="string">&quot;#disconnect&quot;</span>).attr(&#123;<span class="string">&quot;disabled&quot;</span>:!connected&#125;);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(connected)&#123;</span><br><span class="line">            $(<span class="string">&quot;#convertsationDiv&quot;</span>).show();</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            $(<span class="string">&quot;#convertsationDiv&quot;</span>).hide();</span><br><span class="line">        &#125;</span><br><span class="line">        $(<span class="string">&quot;#response&quot;</span>).html(<span class="string">&quot;&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//开启socket连接</span></span><br><span class="line">    function <span class="title function_">connect</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">//定义请求服务器的端点</span></span><br><span class="line">        <span class="type">var</span> <span class="variable">socket</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SockJS</span>(<span class="string">&quot;/socket&quot;</span>);</span><br><span class="line">        <span class="comment">//stomp客户端</span></span><br><span class="line">        stompClient = Stomp.over(socket);</span><br><span class="line">        <span class="comment">//连接服务器端点、</span></span><br><span class="line">        stompClient.connect(&#123;&#125;,function(frame)&#123;</span><br><span class="line">            <span class="comment">//建立连接后的回调</span></span><br><span class="line">            setConnected(<span class="literal">true</span>);</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//断开socket连接</span></span><br><span class="line">    function <span class="title function_">disconnect</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(stompClient = <span class="literal">null</span>)&#123;</span><br><span class="line">            stompClient.disconnect();</span><br><span class="line">        &#125;</span><br><span class="line">        setConnected(<span class="literal">false</span>);</span><br><span class="line">        Console.log(<span class="string">&quot;Disconnected&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//向/request/send服务端发送消息</span></span><br><span class="line">    function <span class="title function_">sendMsg</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">var</span> <span class="variable">value</span> <span class="operator">=</span> $(<span class="string">&quot;#message&quot;</span>).val();</span><br><span class="line">        <span class="comment">//发送消息到/request/send，其中/request是服务器定义的前缀</span></span><br><span class="line">        <span class="comment">// 而/send则是@MessageMapping所配置的路径</span></span><br><span class="line">        stompClient.send(<span class="string">&quot;/request/send&quot;</span>,&#123;&#125;,value);</span><br><span class="line">    &#125;</span><br><span class="line">    connect();</span><br><span class="line"></span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>

<p>客户端订阅消息</p>
<figure class="highlight jsp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page pageEncoding=<span class="string">&quot;utf-8&quot;</span>%&gt;</span><br><span class="line">&lt;%@ taglib prefix=<span class="string">&quot;c&quot;</span> uri=<span class="string">&quot;http://java.sun.com/jsp/jstl/core&quot;</span>%&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt;stomp&lt;/title&gt;</span><br><span class="line">    &lt;script type=<span class="string">&quot;text/javascript&quot;</span> src = <span class="string">&quot;https://code.jquery.com/jquery-3.0.0.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line">    &lt;script type=<span class="string">&quot;text/javascript&quot;</span>  src = <span class="string">&quot;https://cdn.jsdelivr.net/sockjs/1/sockjs.min.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line">    &lt;<span class="type">script</span> <span class="variable">type</span> <span class="operator">=</span> <span class="string">&quot;text/javascript&quot;</span> src = <span class="string">&quot;../../js/stomp.min.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line"></span><br><span class="line">&lt;h1&gt;</span><br><span class="line">    &lt;<span class="type">span</span> <span class="variable">id</span> <span class="operator">=</span> <span class="string">&quot;receive&quot;</span>&gt;等待消息接收&lt;/span&gt;</span><br><span class="line"></span><br><span class="line">&lt;/h1&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;script type=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line"><span class="type">var</span> <span class="variable">noticeSocket</span> <span class="operator">=</span> function()&#123;</span><br><span class="line">    <span class="comment">//连接服务端点</span></span><br><span class="line">    <span class="type">var</span> <span class="variable">s</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SockJS</span>(<span class="string">&quot;/socket&quot;</span>);</span><br><span class="line">    <span class="comment">//客户端</span></span><br><span class="line">    <span class="type">var</span> <span class="variable">stompClient</span> <span class="operator">=</span> Stomp.over(s);</span><br><span class="line">    stompClient.connect(&#123;&#125;,function()&#123;</span><br><span class="line">        console.log(<span class="string">&quot;notice socket connected!&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//订阅消息地址</span></span><br><span class="line">        stompClient.subscribe(<span class="string">&quot;/sub/chat&quot;</span>,function(data)&#123;</span><br><span class="line">            $(<span class="string">&#x27;#receive&#x27;</span>).html(data.body);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">&#125;;</span><br><span class="line">    noticeSocket();</span><br><span class="line"></span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>

<p><strong>5. 发送用户消息页面</strong></p>
<figure class="highlight jsp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page pageEncoding=<span class="string">&quot;utf-8&quot;</span>%&gt;</span><br><span class="line">&lt;%@ taglib prefix=<span class="string">&quot;c&quot;</span> uri=<span class="string">&quot;http://java.sun.com/jsp/jstl/core&quot;</span>%&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt;stomp&lt;/title&gt;</span><br><span class="line">    &lt;script type=<span class="string">&quot;text/javascript&quot;</span> src = <span class="string">&quot;https://code.jquery.com/jquery-3.0.0.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line">    &lt;script type=<span class="string">&quot;text/javascript&quot;</span>  src = <span class="string">&quot;https://cdn.jsdelivr.net/sockjs/1/sockjs.min.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line">    &lt;<span class="type">script</span> <span class="variable">type</span> <span class="operator">=</span> <span class="string">&quot;text/javascript&quot;</span> src = <span class="string">&quot;../../js/stomp.min.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;div&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &lt;div&gt;</span><br><span class="line">        &lt;<span class="type">button</span> <span class="variable">id</span> <span class="operator">=</span> <span class="string">&quot;connect&quot;</span> onclick = <span class="string">&quot;connect()&quot;</span>&gt;连接&lt;/button&gt;</span><br><span class="line">        &lt;<span class="type">button</span> <span class="variable">id</span> <span class="operator">=</span> <span class="string">&quot;disconnect&quot;</span> disabled = <span class="string">&quot;disabled&quot;</span> onclick = <span class="string">&quot;disconnect()&quot;</span>&gt;断开连接&lt;/button&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &lt;/div&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &lt;<span class="type">div</span> <span class="variable">id</span> <span class="operator">=</span> <span class="string">&quot;convertsationDiv&quot;</span>&gt;</span><br><span class="line">        &lt;p&gt;</span><br><span class="line">            &lt;label&gt;发送给用户&lt;/label&gt;</span><br><span class="line"></span><br><span class="line">        &lt;/p&gt;</span><br><span class="line"></span><br><span class="line">        &lt;p&gt;</span><br><span class="line">            &lt;input type=<span class="string">&quot;text&quot;</span> id = <span class="string">&quot;user&quot;</span>/&gt;</span><br><span class="line"></span><br><span class="line">        &lt;/p&gt;</span><br><span class="line"></span><br><span class="line">        &lt;p&gt;</span><br><span class="line">            &lt;label&gt;发送的内容&lt;/label&gt;</span><br><span class="line">        &lt;/p&gt;</span><br><span class="line">        &lt;p&gt;</span><br><span class="line">            &lt;<span class="type">textarea</span> <span class="variable">id</span> <span class="operator">=</span> <span class="string">&quot;message&quot;</span> rows = <span class="string">&quot;5&quot;</span>&gt;&lt;/textarea&gt;</span><br><span class="line">        &lt;/p&gt;</span><br><span class="line">        &lt;<span class="type">button</span> <span class="variable">id</span> <span class="operator">=</span> <span class="string">&quot;sendMsg&quot;</span> onclick=<span class="string">&quot;sendMsg()&quot;</span>&gt;Send&lt;/button&gt;</span><br><span class="line">        &lt;<span class="type">p</span> <span class="variable">id</span> <span class="operator">=</span> <span class="string">&quot;response&quot;</span>&gt;&lt;/p&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">&lt;/div&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;script type=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line">    <span class="type">var</span> <span class="variable">stompClient</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//设置连接</span></span><br><span class="line"></span><br><span class="line">    function <span class="title function_">setConnected</span><span class="params">(connected)</span>&#123;</span><br><span class="line"></span><br><span class="line">        $(<span class="string">&quot;#connect&quot;</span>).attr(&#123;<span class="string">&quot;disabled&quot;</span>:connected&#125;);</span><br><span class="line"></span><br><span class="line">        $(<span class="string">&quot;#disconnect&quot;</span>).attr(&#123;<span class="string">&quot;disabled&quot;</span>:!connected&#125;);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(connected)&#123;</span><br><span class="line">            $(<span class="string">&quot;#convertsationDiv&quot;</span>).show();</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            $(<span class="string">&quot;#convertsationDiv&quot;</span>).hide();</span><br><span class="line">        &#125;</span><br><span class="line">        $(<span class="string">&quot;#response&quot;</span>).html(<span class="string">&quot;&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//开启socket连接</span></span><br><span class="line">    function <span class="title function_">connect</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">//定义请求服务器的端点</span></span><br><span class="line">        <span class="type">var</span> <span class="variable">socket</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SockJS</span>(<span class="string">&quot;/wsuser&quot;</span>);</span><br><span class="line">        <span class="comment">//stomp客户端</span></span><br><span class="line">        stompClient = Stomp.over(socket);</span><br><span class="line">        <span class="comment">//连接服务器端点、</span></span><br><span class="line">        stompClient.connect(&#123;&#125;,function(frame)&#123;</span><br><span class="line">            <span class="comment">//建立连接后的回调</span></span><br><span class="line">            setConnected(<span class="literal">true</span>);</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//断开socket连接</span></span><br><span class="line">    function <span class="title function_">disconnect</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(stompClient = <span class="literal">null</span>)&#123;</span><br><span class="line">            stompClient.disconnect();</span><br><span class="line">        &#125;</span><br><span class="line">        setConnected(<span class="literal">false</span>);</span><br><span class="line">        Console.log(<span class="string">&quot;Disconnected&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//向/request/send服务端发送消息</span></span><br><span class="line">    function <span class="title function_">sendMsg</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">var</span> <span class="variable">value</span> <span class="operator">=</span> $(<span class="string">&quot;#message&quot;</span>).val();</span><br><span class="line">        <span class="type">var</span> <span class="variable">user</span> <span class="operator">=</span> $(<span class="string">&quot;#user&quot;</span>).val();</span><br><span class="line">        <span class="comment">//用户和消息组成的字符串</span></span><br><span class="line">        <span class="type">var</span> <span class="variable">text</span> <span class="operator">=</span> user+<span class="string">&quot;,&quot;</span>+value;</span><br><span class="line">        stompClient.send(<span class="string">&quot;/request/sendUser&quot;</span>,&#123;&#125;,text);</span><br><span class="line">    &#125;</span><br><span class="line">    connect();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></div></figure>

<p>订阅指定用户的消息</p>
<figure class="highlight jsp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page pageEncoding=<span class="string">&quot;utf-8&quot;</span>%&gt;</span><br><span class="line">&lt;%@ taglib prefix=<span class="string">&quot;c&quot;</span> uri=<span class="string">&quot;http://java.sun.com/jsp/jstl/core&quot;</span>%&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt;stomp&lt;/title&gt;</span><br><span class="line">    &lt;script type=<span class="string">&quot;text/javascript&quot;</span> src = <span class="string">&quot;https://code.jquery.com/jquery-3.0.0.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line">    &lt;script type=<span class="string">&quot;text/javascript&quot;</span>  src = <span class="string">&quot;https://cdn.jsdelivr.net/sockjs/1/sockjs.min.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line">    &lt;<span class="type">script</span> <span class="variable">type</span> <span class="operator">=</span> <span class="string">&quot;text/javascript&quot;</span> src = <span class="string">&quot;../../js/stomp.min.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line"></span><br><span class="line">&lt;h1&gt;</span><br><span class="line">    &lt;<span class="type">span</span> <span class="variable">id</span> <span class="operator">=</span> <span class="string">&quot;receive&quot;</span>&gt;等待消息接收&lt;/span&gt;</span><br><span class="line"></span><br><span class="line">&lt;/h1&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;script type=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line">    <span class="type">var</span> <span class="variable">noticeSocket</span> <span class="operator">=</span> function()&#123;</span><br><span class="line">        <span class="comment">//连接服务端点</span></span><br><span class="line">        <span class="type">var</span> <span class="variable">s</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SockJS</span>(<span class="string">&quot;/wsuser&quot;</span>);</span><br><span class="line">        <span class="comment">//客户端</span></span><br><span class="line">        <span class="type">var</span> <span class="variable">stompClient</span> <span class="operator">=</span> Stomp.over(s);</span><br><span class="line">        stompClient.connect(&#123;&#125;,function()&#123;</span><br><span class="line">            console.log(<span class="string">&quot;notice socket connected!&quot;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//订阅消息地址</span></span><br><span class="line">            stompClient.subscribe(<span class="string">&quot;/user/queue/customer&quot;</span>,function(data)&#123;</span><br><span class="line">                $(<span class="string">&#x27;#receive&#x27;</span>).html(data.body);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">    &#125;;</span><br><span class="line">    noticeSocket();</span><br><span class="line"></span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></div></figure>

<blockquote>
<p><b><font color="#D2691E">stompClient.subscribe(“&#x2F;user&#x2F;queue&#x2F;customer”,function(data){ $(‘#receive’).html(data.body);中的user前缀是不可缺少的，它代表订阅指定用户的消息</font></b></p>
</blockquote>
</div></div></article><article class="postlist-item post"><header class="post-header"><h1 class="post-title"><a class="post-title__link" href="/2020/07/22/Spring-Security/">Spring Security</a></h1><div class="post-meta"><span class="post-meta-item post-meta-item--createtime"><span class="post-meta-item__icon"><i class="far fa-calendar-plus"></i></span><span class="post-meta-item__info">Created</span><span class="post-meta-item__value">2020-07-22</span></span><span class="post-meta-item post-meta-item--updatetime"><span class="post-meta-item__icon"><i class="far fa-calendar-check"></i></span><span class="post-meta-item__info">Updated</span><span class="post-meta-item__value">2022-05-21</span></span></div></header><div class="post-body"><div class="post-excerpt"><span id="more"></span>

        <h1 id="安全–Spring-Security">
          <a href="#安全–Spring-Security" class="heading-link"><i class="fas fa-link"></i></a><a href="#安全–Spring-Security" class="headerlink" title="安全–Spring Security"></a>安全–Spring Security</h1>
      <div class="table-container"><table>
<tr>
<td bgcolor="Aquamarine">
    <b>为了使用SpringSecurity，需要在Maven配置文件中引入对应的依赖</b>
</td>
</tr>
</table></div>

<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">	&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">	&lt;artifactId&gt;spring-boot-starter-security&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>


        <h2 id="简单安全认证">
          <a href="#简单安全认证" class="heading-link"><i class="fas fa-link"></i></a><a href="#简单安全认证" class="headerlink" title="简单安全认证"></a>简单安全认证</h2>
      <blockquote>
<p>引入依赖完成后，直接启动SpringBoot的应用也会启用Spring Security，启动完后可以看到如下打印随机生成密码的日志(需保证日志级别为INFO或以下才能看到)</p>
</blockquote>
<p><img src="/2020/07/22/Spring-Security/QQ%E6%88%AA%E5%9B%BE20200722153547.png"></p>
<font color="BlueViolet">
这时访问URL http://localhost:8080/ 相关便会进入一个登录页面。使用用户名"user",密码为以上随机生成的密码即可登录成功
</font>

<p><img src="/2020/07/22/Spring-Security/QQ%E6%88%AA%E5%9B%BE20200722154351.png"></p>
<p><strong>Spring Boot的自动配置机制，允许开发者快速修改用户名和密码</strong></p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#自定义用户名和密码</span><br><span class="line">spring.security.user.name=myusers</span><br><span class="line">spring.security.user.password=darksouls</span><br></pre></td></tr></table></div></figure>

<p>这样就可以使用上述配置的用户名和密码而不再使用固定的用户名和随机生成的密码</p>

        <h2 id="使用WebSecurityConfigurerAdapter自定义-x2F-自定义用户服务信息">
          <a href="#使用WebSecurityConfigurerAdapter自定义-x2F-自定义用户服务信息" class="heading-link"><i class="fas fa-link"></i></a><a href="#使用WebSecurityConfigurerAdapter自定义-x2F-自定义用户服务信息" class="headerlink" title="使用WebSecurityConfigurerAdapter自定义&#x2F;自定义用户服务信息"></a>使用WebSecurityConfigurerAdapter自定义&#x2F;自定义用户服务信息</h2>
      <div class="table-container"><table>
<tr>
<td bgcolor="#FFFAF0">
    <b>
在Spring Security中默认时没有任何用户配置的，而在SpringBoot中，如果没有用户的配置，它将会自动生成一个名称为user，密码通过随机生成的用户。为了克服这个问题，下面将讨论如何使用内存签名服务，数据库签名服务和自定义签名服务。
    </b>
</td>
</tr>
</table></div>


        <h3 id="使用内存签名服务">
          <a href="#使用内存签名服务" class="heading-link"><i class="fas fa-link"></i></a><a href="#使用内存签名服务" class="headerlink" title="使用内存签名服务"></a>使用内存签名服务</h3>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.rediscachetest.tools;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> ***</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">securityConf</span> <span class="keyword">extends</span> <span class="title class_">WebSecurityConfigurerAdapter</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">configure</span><span class="params">(AuthenticationManagerBuilder auth)</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">        <span class="comment">//密码编码器</span></span><br><span class="line"></span><br><span class="line">        <span class="type">PasswordEncoder</span> <span class="variable">passwordEncoder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BCryptPasswordEncoder</span>();</span><br><span class="line">        <span class="comment">//使用内存存储</span></span><br><span class="line">        InMemoryUserDetailsManagerConfigurer&lt;AuthenticationManagerBuilder&gt; userConfig = auth.inMemoryAuthentication()</span><br><span class="line">                <span class="comment">//设置密码编译器</span></span><br><span class="line">                .passwordEncoder(passwordEncoder);</span><br><span class="line">        <span class="comment">//生成abc加密后的密码</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">secrePass</span> <span class="operator">=</span> passwordEncoder.encode(<span class="string">&quot;abc&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;abc加密后的密码:&quot;</span>+secrePass);</span><br><span class="line">        <span class="comment">//注册用户admin，密码abc，并赋予USER和ADMIN权限</span></span><br><span class="line">        userConfig.withUser(<span class="string">&quot;admin&quot;</span>)</span><br><span class="line">                .password(secrePass)</span><br><span class="line">                .authorities(<span class="string">&quot;ROLE_USER&quot;</span>,<span class="string">&quot;ROLE_ADMIN&quot;</span>);</span><br><span class="line">        <span class="comment">//生成123456加密后的密码</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">secreONETWO</span> <span class="operator">=</span> passwordEncoder.encode(<span class="string">&quot;123456&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;123456加密后的密码:&quot;</span>+secreONETWO);</span><br><span class="line">        <span class="comment">//注册用户myuser，密码为123456并赋予USER角色权限</span></span><br><span class="line">        userConfig.withUser(<span class="string">&quot;myuser&quot;</span>)</span><br><span class="line">                .password(secreONETWO)</span><br><span class="line">                .authorities(<span class="string">&quot;ROLE_USER&quot;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>


<blockquote>
<p>在Spring 5的Security中都要求使用密码编译器，否则会发生异常</p>
</blockquote>

        <h3 id="使用数据库定义用户认证服务">
          <a href="#使用数据库定义用户认证服务" class="heading-link"><i class="fas fa-link"></i></a><a href="#使用数据库定义用户认证服务" class="headerlink" title="使用数据库定义用户认证服务"></a>使用数据库定义用户认证服务</h3>
      <p><strong>1. 创建用户表，角色表，用户角色表</strong></p>
<p><font color="orange">用户角色表关联用户表和角色表</font></p>
<p><img src="/2020/07/22/Spring-Security/tabUser.png"></p>
<p><img src="/2020/07/22/Spring-Security/tabRole.png"></p>
<p><img src="/2020/07/22/Spring-Security/tabUserRole.png"></p>
<p><strong>2. 使用数据库验证</strong></p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">/**</span></span><br><span class="line"><span class="comment">  * 数据库定义用户认证服务</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//注入数据源</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> <span class="type">DataSource</span> <span class="variable">dataSource</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"><span class="comment">//使用用户名称查询密码</span></span><br><span class="line"><span class="type">String</span> <span class="variable">pwdQuery</span> <span class="operator">=</span> <span class="string">&quot; select user_name,user_password,available from tab_user where user_name = ? &quot;</span>;</span><br><span class="line"><span class="comment">//使用用户名称查询角色信息</span></span><br><span class="line"><span class="type">String</span> <span class="variable">roleQuery</span> <span class="operator">=</span> <span class="string">&quot; select u.user_name,r.role_name from tab_user u,tab_user_role ur,tab_role r where u.id = ur.user_id and r.id = ur.role_id and u.user_name=? &quot;</span>;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">configure</span><span class="params">(AuthenticationManagerBuilder auth)</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//密码编译器</span></span><br><span class="line">    auth.</span><br><span class="line">            jdbcAuthentication()</span><br><span class="line">            <span class="comment">//密码编译器</span></span><br><span class="line">            .passwordEncoder(<span class="keyword">new</span> <span class="title class_">BCryptPasswordEncoder</span>())</span><br><span class="line">            <span class="comment">//数据源</span></span><br><span class="line">            .dataSource(dataSource)</span><br><span class="line">            <span class="comment">//查询用户</span></span><br><span class="line">            .usersByUsernameQuery(pwdQuery)</span><br><span class="line">            <span class="comment">//赋予权限</span></span><br><span class="line">            .authoritiesByUsernameQuery(roleQuery);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<blockquote>
<p>注意方法中<font color="#0000FF"> .passwordEncoder(new BCryptPasswordEncoder())</font>中的<font color="#0000FF">new BCryptPasswordEncoder()</font>方法。Spring 5的Security中都要求使用密码编码器，这里指定的是<strong>BCryptPasswordEncoder</strong>实例，如果不想指定的话可以写成<font color="#0000FF">NoOpPasswordEncoder.getInstance()</font>，不过此方法已经画横线了所以最好不用。</p>
</blockquote>
<blockquote>
<p><font color="#0000FF">usersByUsernameQuery</font>方法通过定义的sql语句返回3个列。分别是用户名，密码和布尔值，这样就可以对用户名和密码进行验证了。<font color="#0000FF">authoritiesByUsernameQuery</font>方法会用roleQuery定义的SQL通过用户名称查找角色名称，根据查询的结果赋予权限，如果这条SQL语句返回的时多条，那么就会给这个用户赋予多个角色</p>
</blockquote>
<p><strong>值得一提的是，如果使用了<font color="blue">BCryptPasswordEncoder</font>类型的编码器进行加密，那么在保存在数据库中密码的格式就需要是BCryt格式的，否则就会报错。比如密码为”123456789”,那么保存在数据库中的就应该是<font color="#7FFFD4">$2a$10$rrZC9HLI2CwN4WWrVSf9Ie0APh.WVRAzvdcX0Pzm5MpIqjJKjNaNK</font>，切记这只是保存在数据库中的密码格式，如果登录验证时使用的密码一定是”123456789”，它会转换成BCryt格式的密文进行比对。而不是<font color="#7FFFD4">$2a$10$rrZC9HLI2CwN4WWrVSf9Ie0APh.WVRAzvdcX0Pzm5MpIqjJKjNaNK</font>。</strong></p>

        <h3 id="限制请求">
          <a href="#限制请求" class="heading-link"><i class="fas fa-link"></i></a><a href="#限制请求" class="headerlink" title="限制请求"></a>限制请求</h3>
      <div class="table-container"><table>
<tr>
<td bgcolor="Beige">
    <b>
对于不同的角色而言，其访问的权限也是不一样的。通过继承的抽象类WebSecurityConfigurerAdapter的configure(HttpSecurity)方法便能实现对于不同角色赋予不同权限的功能
    </b>
</td>
</tr>
</table></div>

<p><strong>1. 配置请求路径访问权限</strong></p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.rediscachetest.tools;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.config.annotation.authentication.builders.AuthenticationManagerBuilder;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.config.annotation.authentication.configurers.provisioning.InMemoryUserDetailsManagerConfigurer;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.config.annotation.web.builders.HttpSecurity;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.config.annotation.web.configuration.WebSecurityConfigurerAdapter;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.crypto.password.PasswordEncoder;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.sql.DataSource;</span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">securityConf</span>  <span class="keyword">extends</span> <span class="title class_">WebSecurityConfigurerAdapter</span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 数据库定义用户认证服务</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="comment">//注入数据源</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">DataSource</span> <span class="variable">dataSource</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="comment">//使用用户名称查询密码</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">pwdQuery</span> <span class="operator">=</span> <span class="string">&quot; select user_name,user_password,available from tab_user where user_name = ? &quot;</span>;</span><br><span class="line">    <span class="comment">//使用用户名称查询角色信息</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">roleQuery</span> <span class="operator">=</span> <span class="string">&quot; select u.user_name,r.role_name from tab_user u,tab_user_role ur,tab_role r where u.id = ur.user_id and r.id = ur.role_id and u.user_name=? &quot;</span>;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">configure</span><span class="params">(AuthenticationManagerBuilder auth)</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//密码编译器</span></span><br><span class="line">        auth.</span><br><span class="line">                jdbcAuthentication()</span><br><span class="line">                <span class="comment">//密码编译器</span></span><br><span class="line">                .passwordEncoder(<span class="keyword">new</span> <span class="title class_">BCryptPasswordEncoder</span>())</span><br><span class="line">                <span class="comment">//数据源</span></span><br><span class="line">                .dataSource(dataSource)</span><br><span class="line">                <span class="comment">//查询用户</span></span><br><span class="line">                .usersByUsernameQuery(pwdQuery)</span><br><span class="line">                <span class="comment">//赋予权限</span></span><br><span class="line">                .authoritiesByUsernameQuery(roleQuery);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">configure</span><span class="params">(HttpSecurity httpSecurity)</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">         httpSecurity</span><br><span class="line">                 .authorizeRequests()</span><br><span class="line">                 .antMatchers(<span class="string">&quot;/models/mod1&quot;</span>).hasAnyRole(<span class="string">&quot;SYSTEM&quot;</span>,<span class="string">&quot;SUPER&quot;</span>,<span class="string">&quot;USER&quot;</span>)</span><br><span class="line">                 .antMatchers(<span class="string">&quot;/session/**&quot;</span>).hasAnyAuthority(<span class="string">&quot;ROLE_ADMIN&quot;</span>)</span><br><span class="line">                 .anyRequest().permitAll()</span><br><span class="line">                 .and().anonymous()</span><br><span class="line">                 .and().formLogin()</span><br><span class="line">                 .and().httpBasic();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></div></figure>

<blockquote>
<p>着重在于方法**<font color="red">configure(HttpSecurity httpSecurity)</font>**。<font color="orange">antMatchers</font>方法指定了请求的路径。<font color="orange">hasAnyRole</font>指定了该路径访问的角色权限为”ROLE_SYSTEM”,”ROLE_SUPER”,”ROLE_USER”.第二个<font color="orange">antMatchers</font>方法限定”session”下所有请求权限赋予角色”ROLE_ADMIN”.注意，<font color="orange">hasAnyRole</font>方法会自动加入前缀“ROLE_”,<font color="orange">hasAnyAuthority</font>方法则不会，此方法可以使用自定义不带ROLE的角色。<font color="orange">.anyRequest().permitAll()</font>表示其他路径允许签名后访问，<font color="orange">and().anonymous()</font>表示对于没有配置权限的其他请求允许匿名访问。</p>
</blockquote>
<p><strong>2. Spring表达式设置权限</strong></p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">configure</span><span class="params">(HttpSecurity httpSecurity)</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Spring 表达式设置权限</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    httpSecurity.authorizeRequests()</span><br><span class="line">			<span class="comment">//限定角色只有ROLE_USER或者ROLE_ADMIN</span></span><br><span class="line">            .antMatchers(<span class="string">&quot;/models/mod1&quot;</span>).access(<span class="string">&quot;hasAnyRole(&#x27;USER&#x27;) or hasAnyRole(&#x27;ADMIN&#x27;)&quot;</span>)</span><br><span class="line">			<span class="comment">//限定角色只有testone，要求是完整登录</span></span><br><span class="line">            .antMatchers(<span class="string">&quot;/session/**&quot;</span>).access(<span class="string">&quot;hasAnyAuthority(&#x27;testone&#x27;) &amp;&amp; isFullyAuthenticated()&quot;</span>)</span><br><span class="line">			<span class="comment">//使用记住我功能</span></span><br><span class="line">            .and().rememberMe()</span><br><span class="line">			<span class="comment">//使用Spring Security默认登录页面</span></span><br><span class="line">            .and().formLogin()</span><br><span class="line">			<span class="comment">//启用http基础验证</span></span><br><span class="line">            .and().httpBasic();</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>


        <h3 id="用户认证功能">
          <a href="#用户认证功能" class="heading-link"><i class="fas fa-link"></i></a><a href="#用户认证功能" class="headerlink" title="用户认证功能"></a>用户认证功能</h3>
      <p><strong>自定义登录界面</strong></p>
<p><strong><font color="gray">1. 配置登录请求和记住我</font></strong></p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">configure</span><span class="params">(HttpSecurity httpSecurity)</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Spring 表达式设置权限</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    httpSecurity.authorizeRequests()</span><br><span class="line">            .antMatchers(<span class="string">&quot;/models/mod1&quot;</span>).access(<span class="string">&quot;hasAnyRole(&#x27;USER&#x27;) or hasAnyRole(&#x27;ADMIN&#x27;)&quot;</span>)</span><br><span class="line">            .antMatchers(<span class="string">&quot;/session/**&quot;</span>).access(<span class="string">&quot;hasAnyAuthority(&#x27;testone&#x27;) &amp;&amp; isFullyAuthenticated()&quot;</span>)</span><br><span class="line">            .and().rememberMe().tokenValiditySeconds(<span class="number">86400</span>).key(<span class="string">&quot;remember-me-key&quot;</span>)</span><br><span class="line">            .and().formLogin().loginPage(<span class="string">&quot;/login/page&quot;</span>).defaultSuccessUrl(<span class="string">&quot;/admin/welcome&quot;</span>)</span><br><span class="line">            .and().logout().logoutUrl(<span class="string">&quot;/logout&quot;</span>).logoutSuccessUrl(<span class="string">&quot;/logout/page&quot;</span>)</span><br><span class="line">            .and().httpBasic().realmName(<span class="string">&quot;my_basic_name&quot;</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<blockquote>
<p>这里的rememberMe方法意思是“记住我”功能，有效时间为1天（86400s）,在浏览器中将使用Cookie以键“remember-me-key”进行保存、loginPage方法是指定登录的路径(login&#x2F;page)，defaultSuccessUrl为默认跳转路径。</p>
</blockquote>
<p><strong><font color="gray">2. 指定的login&#x2F;page所映射的路径既可以用传统的控制器映射，也可以使用新增映射关系完成</font></strong></p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.rediscachetest.tools;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.ViewControllerRegistry;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.WebMvcConfigurer;</span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebConfig</span> <span class="keyword">implements</span> <span class="title class_">WebMvcConfigurer</span> &#123;</span><br><span class="line">    <span class="comment">// 增加映射关系</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addViewControllers</span><span class="params">(ViewControllerRegistry registry)</span>&#123;</span><br><span class="line">        <span class="comment">// 使得/login/page映射为login.jsp</span></span><br><span class="line"></span><br><span class="line">        registry.addViewController(<span class="string">&quot;/login/page&quot;</span>).setViewName(<span class="string">&quot;user/login&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//使得/logout/page映射为/logout_welcome.jsp</span></span><br><span class="line"></span><br><span class="line">        registry.addViewController(<span class="string">&quot;/logout/page&quot;</span>).setViewName(<span class="string">&quot;user/logout_welcome&quot;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">//使得/loogout映射为logout.jsp</span></span><br><span class="line">        registry.addViewController(<span class="string">&quot;/logout&quot;</span>).setViewName(<span class="string">&quot;user/logout&quot;</span>);</span><br><span class="line"></span><br><span class="line">        registry.addViewController(<span class="string">&quot;/admin/welcome&quot;</span>).setViewName(<span class="string">&quot;user/welcome&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></div></figure>

<p><strong><font color="gray">3. 自定义登录界面</font></strong></p>
<figure class="highlight jsp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page pageEncoding=<span class="string">&quot;utf-8&quot;</span>%&gt;</span><br><span class="line">&lt;%@ taglib prefix=<span class="string">&quot;c&quot;</span> uri=<span class="string">&quot;http://java.sun.com/jsp/jstl/core&quot;</span>%&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt;登录页面&lt;/title&gt;</span><br><span class="line">    &lt;<span class="type">script</span> <span class="variable">src</span> <span class="operator">=</span> <span class="string">&quot;https://code.jquery.com/jquery-3.0.0.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line"></span><br><span class="line">&lt;h1&gt;</span><br><span class="line">    &lt;% System.out.println(<span class="string">&quot;视图渲染&quot;</span>);%&gt;</span><br><span class="line">&lt;/h1&gt;</span><br><span class="line">&lt;form action=<span class="string">&quot;/login/page&quot;</span> method=<span class="string">&quot;post&quot;</span>&gt;</span><br><span class="line">    &lt;input type=<span class="string">&quot;text&quot;</span> id = <span class="string">&quot;username&quot;</span> name = <span class="string">&quot;username&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line">    &lt;input type=<span class="string">&quot;text&quot;</span> id = <span class="string">&quot;password&quot;</span> name = <span class="string">&quot;password&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line">    &lt;input type=<span class="string">&quot;checkbox&quot;</span> id = <span class="string">&quot;remember_me&quot;</span> name = <span class="string">&quot;remember-me&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line">    &lt;input type=<span class="string">&quot;submit&quot;</span> value=<span class="string">&quot;登录&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line">    &lt;input type=<span class="string">&quot;hidden&quot;</span> id = <span class="string">&quot;$&#123;_csrf.parameterName&#125;&quot;</span> name = <span class="string">&quot;$&#123;_csrf.parameterName&#125;&quot;</span> value=<span class="string">&quot;$&#123;_csrf.token&#125;&quot;</span>&gt;</span><br><span class="line">&lt;/form&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></div></figure>

<blockquote>
<p>此处的表单提交的action定义为&#x2F;login&#x2F;page,这样安全登录拦截器就会拦截这些参数。此处要求method为post，用户名为username，密码为password，记住我为remember-me且为checkbox类型</p>
</blockquote>
<p><strong><font color="gray">4. 登出页面</font></strong></p>
<p>logout_welcome.jsp</p>
<figure class="highlight jsp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page pageEncoding=<span class="string">&quot;utf-8&quot;</span>%&gt;</span><br><span class="line">&lt;%@ taglib prefix=<span class="string">&quot;c&quot;</span> uri=<span class="string">&quot;http://java.sun.com/jsp/jstl/core&quot;</span>%&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt;登出页面&lt;/title&gt;</span><br><span class="line">    &lt;<span class="type">script</span> <span class="variable">src</span> <span class="operator">=</span> <span class="string">&quot;https://code.jquery.com/jquery-3.0.0.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line"></span><br><span class="line">&lt;h1&gt;</span><br><span class="line"></span><br><span class="line">&lt;/h1&gt;</span><br><span class="line">&lt;p&gt;您已登出系统&lt;/p&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></div></figure>

<p>logout.jsp</p>
<figure class="highlight jsp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page pageEncoding=<span class="string">&quot;utf-8&quot;</span>%&gt;</span><br><span class="line">&lt;%@ taglib prefix=<span class="string">&quot;c&quot;</span> uri=<span class="string">&quot;http://java.sun.com/jsp/jstl/core&quot;</span>%&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt;登出&lt;/title&gt;</span><br><span class="line">    &lt;<span class="type">script</span> <span class="variable">src</span> <span class="operator">=</span> <span class="string">&quot;https://code.jquery.com/jquery-3.0.0.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line"></span><br><span class="line">&lt;form action=<span class="string">&quot;/logout&quot;</span> method=<span class="string">&quot;post&quot;</span>&gt;</span><br><span class="line">&lt;input type=<span class="string">&quot;submit&quot;</span> value=<span class="string">&quot;登出&quot;</span>&gt;</span><br><span class="line">&lt;input type=<span class="string">&quot;hidden&quot;</span> id = <span class="string">&quot;$&#123;_csrf.parameterName&#125;&quot;</span> name = <span class="string">&quot;$&#123;_csrf.parameterName&#125;&quot;</span> value=<span class="string">&quot;$&#123;_csrf.token&#125;&quot;</span>&gt;</span><br><span class="line">&lt;/form&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure></div></div></article><article class="postlist-item post"><header class="post-header"><h1 class="post-title"><a class="post-title__link" href="/2020/07/19/REST%E9%A3%8E%E6%A0%BC/">REST风格</a></h1><div class="post-meta"><span class="post-meta-item post-meta-item--createtime"><span class="post-meta-item__icon"><i class="far fa-calendar-plus"></i></span><span class="post-meta-item__info">Created</span><span class="post-meta-item__value">2020-07-19</span></span><span class="post-meta-item post-meta-item--updatetime"><span class="post-meta-item__icon"><i class="far fa-calendar-check"></i></span><span class="post-meta-item__info">Updated</span><span class="post-meta-item__value">2022-05-21</span></span></div></header><div class="post-body"><div class="post-excerpt">
        <h1 id="REST简述">
          <a href="#REST简述" class="heading-link"><i class="fas fa-link"></i></a><a href="#REST简述" class="headerlink" title="REST简述"></a>REST简述</h1>
      
        <h2 id="REST名词">
          <a href="#REST名词" class="heading-link"><i class="fas fa-link"></i></a><a href="#REST名词" class="headerlink" title="REST名词"></a>REST名词</h2>
      <p><strong>1. 资源:是一个具体存在的对象，它可以是系统权限用户，角色和菜单等。也可以是一些媒体类型，如文本，图片，歌曲</strong></p>
<p><strong>2. 表现层:表现这个资源</strong></p>
<p><strong>3. 状态转换:现实中的资源不是一层不变的，它是一个变化的过程，一个资源可以经历创建，访问，修改和删除的过程。</strong></p>

        <h2 id="开发REST风格端点">
          <a href="#开发REST风格端点" class="heading-link"><i class="fas fa-link"></i></a><a href="#开发REST风格端点" class="headerlink" title="开发REST风格端点"></a>开发REST风格端点</h2>
      
        <h3 id="Spring-4-3之后除了-RequestMapping外，还可以使用以下5个注解">
          <a href="#Spring-4-3之后除了-RequestMapping外，还可以使用以下5个注解" class="heading-link"><i class="fas fa-link"></i></a><a href="#Spring-4-3之后除了-RequestMapping外，还可以使用以下5个注解" class="headerlink" title="Spring 4.3之后除了@RequestMapping外，还可以使用以下5个注解:"></a>Spring 4.3之后除了@RequestMapping外，还可以使用以下5个注解:</h3>
      <p><strong>1. @GetMapping:对应HTTP的GET请求，获取资源</strong></p>
<p><strong>2. @PostMapping: 对应HTTP的POST请求，创建资源</strong></p>
<p><strong>3. @PutMapping: 对应HTTP的PUT请求，提交所有的资源属性以修改资源</strong></p>
<p><strong>4. @PatchMapping: 对应HTTP的PATCH请求，提交资源部分修改的属性</strong></p>
<p><strong>5. @DeleteMapping: 对应HTTP的DELETE请求，删除服务器端的资源。</strong></p>
<blockquote>
<div class="table-container"><table><tr><td bgcolor="#F0FFFF">通过这些注解就能把URI定位到对应的控制器方法上。通过注解@PathVariable进行获取，这样就能满足REST风格传递参数的要求。对于复杂的参数，比如传递十几个的字段，可以考虑请求体JSON的方式提交给服务器。</td></tr></table></div>
</blockquote>

        <h2 id="RestController使用">
          <a href="#RestController使用" class="heading-link"><i class="fas fa-link"></i></a><a href="#RestController使用" class="headerlink" title="RestController使用"></a>RestController使用</h2>
      <div class="table-container"><table><tr><td bgcolor="#F5F5F5">因为现在的前后端分离，所以使用JSOM作为前后端交互已经十分普遍。如果每个方法都加上@ResponseBody才能将数据转换为JSON，显然有些冗余。@RestController注解，通过它可以将控制器返回的对象转换为JSON数据集。</td></tr></table></div>

<div class="table-container"><table><tr><td bgcolor="#FFF5EE">使用此注解就能让之前的getUser方法返回的对象转变为JSON数据集了，为了使得JSP视图也能够被渲染成功，原本通过直接返回字符串的方式就不能使用了。这时可以使用ModelAndView的返回，通过视图名称找到对应的视图，将数据模型进行渲染，展示JSP视图给用户观看。</td></tr></table></div>


        <h2 id="渲染结果">
          <a href="#渲染结果" class="heading-link"><i class="fas fa-link"></i></a><a href="#渲染结果" class="headerlink" title="渲染结果"></a>渲染结果</h2>
      <p>在@RequestMapping，@GetMapping中还存在consumes和produces属性。欠着代表的是限制该方法接受什么类型的请求体，后者代表的是限定返回的媒体类型，仅当request请求头中的类型中包含该指定的类型才返回。如：</p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(value=&quot;user2/name/&#123;id&#125;&quot;,consumes=MediaType.All_VALUE,prodices=MediaType.TEXT_PLAIN_VALUE)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">getUsername</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long id)</span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userService.getUser(id);</span><br><span class="line">	<span class="keyword">return</span> user.getUserName();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>
<blockquote>
<p>以上表示接收任意的请求体，限定返回的媒体类型为文本。</p>
</blockquote>
</div></div></article><article class="postlist-item post"><header class="post-header"><h1 class="post-title"><a class="post-title__link" href="/2020/06/17/Spring-MVC%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0v1/">Spring MVC学习笔记v1</a></h1><div class="post-meta"><span class="post-meta-item post-meta-item--createtime"><span class="post-meta-item__icon"><i class="far fa-calendar-plus"></i></span><span class="post-meta-item__info">Created</span><span class="post-meta-item__value">2020-06-17</span></span><span class="post-meta-item post-meta-item--updatetime"><span class="post-meta-item__icon"><i class="far fa-calendar-check"></i></span><span class="post-meta-item__info">Updated</span><span class="post-meta-item__value">2022-05-21</span></span></div></header><div class="post-body"><div class="post-excerpt">
        <h1 id="Spring-MVC">
          <a href="#Spring-MVC" class="heading-link"><i class="fas fa-link"></i></a><a href="#Spring-MVC" class="headerlink" title="Spring MVC"></a>Spring MVC</h1>
      
        <h2 id="简单页面配置">
          <a href="#简单页面配置" class="heading-link"><i class="fas fa-link"></i></a><a href="#简单页面配置" class="headerlink" title="简单页面配置"></a>简单页面配置</h2>
      <p><strong>1. 控制器</strong></p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.rediscachetest.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.rediscachetest.pojo.ServerUser;</span><br><span class="line"><span class="keyword">import</span> com.example.rediscachetest.serviceImpl.userServiceImpl;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.ModelAndView;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/users&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">userController</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">userServiceImpl</span> <span class="variable">uSer</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/resUser&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ModelAndView <span class="title function_">getUserOne</span><span class="params">(<span class="type">long</span> id)</span>&#123;</span><br><span class="line">        <span class="type">ServerUser</span> <span class="variable">sUser</span> <span class="operator">=</span> uSer.getServerUser(id);</span><br><span class="line">        <span class="type">ModelAndView</span> <span class="variable">mav</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ModelAndView</span>();</span><br><span class="line">        mav.setViewName(<span class="string">&quot;user/detail&quot;</span>);</span><br><span class="line">        mav.addObject(<span class="string">&quot;user&quot;</span>,sUser);</span><br><span class="line">        <span class="keyword">return</span> mav;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>

<p><strong>2. 引入关于jsp、jstl的依赖并通过application.properties定制InternalResourceViewResolver初始化.</strong></p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">	&lt;groupId&gt;javax.servlet&lt;/groupId&gt;</span><br><span class="line">	&lt;artifactId&gt;jstl&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">	&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">	&lt;artifactId&gt;spring-boot-starter-tomcat&lt;/artifactId&gt;</span><br><span class="line">	&lt;scope&gt;provided&lt;/scope&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">	&lt;groupId&gt;org.apache.tomcat.embed&lt;/groupId&gt;</span><br><span class="line">	&lt;artifactId&gt;tomcat-embed-jasper&lt;/artifactId&gt;</span><br><span class="line">	&lt;scope&gt;provided&lt;/scope&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></div></figure>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">spring.mvc.view.prefix=/WEB-INF/jsp/</span><br><span class="line">spring.mvc.view.suffix=.jsp</span><br></pre></td></tr></table></div></figure>

<p><strong>3. jsp视图</strong></p>
<figure class="highlight html"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page pageEncoding=&quot;utf-8&quot;%&gt;</span><br><span class="line">&lt;%@ taglib prefix=&quot;c&quot; uri=&quot;http://java.sun.com/jsp/jstl/core&quot;%&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>用户详情<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">center</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">table</span> <span class="attr">border</span> = <span class="string">&quot;1&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">td</span>&gt;</span>标签<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">td</span>&gt;</span>值<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">td</span>&gt;</span>用户编号<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">c:out</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;user.id&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">c:out</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">td</span>&gt;</span>用户名称<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">c:out</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;user.name&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">c:out</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">td</span>&gt;</span>用户备注<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">c:out</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;user.remark&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">c:out</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">center</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></div></figure>

<p><strong>4. jsp视图的位置</strong></p>
<p><img src="/2020/06/17/Spring-MVC%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0v1/QQ%E6%88%AA%E5%9B%BE20200617135014.png"></p>

        <h2 id="使用JSON视图-MappingJackson2JsonView转换出JSON">
          <a href="#使用JSON视图-MappingJackson2JsonView转换出JSON" class="heading-link"><i class="fas fa-link"></i></a><a href="#使用JSON视图-MappingJackson2JsonView转换出JSON" class="headerlink" title="使用JSON视图(MappingJackson2JsonView转换出JSON)"></a>使用JSON视图(MappingJackson2JsonView转换出JSON)</h2>
      <p><strong>控制器</strong></p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/detailsForjson&quot;)</span></span><br><span class="line">   <span class="keyword">public</span> ModelAndView <span class="title function_">detailsForJson</span><span class="params">(<span class="type">long</span> id)</span>&#123;</span><br><span class="line">       <span class="comment">//访问模型层得到数据</span></span><br><span class="line">       <span class="type">ServerUser</span> <span class="variable">oUser</span> <span class="operator">=</span> uSer.getServerUser(id);</span><br><span class="line">       <span class="comment">//模型和视图</span></span><br><span class="line">       <span class="type">ModelAndView</span> <span class="variable">mav</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ModelAndView</span>();</span><br><span class="line">       <span class="comment">//生成Json视图</span></span><br><span class="line">       <span class="type">MappingJackson2JsonView</span> <span class="variable">jsonView</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MappingJackson2JsonView</span>();</span><br><span class="line">       mav.setView(jsonView);</span><br><span class="line">       <span class="comment">//加入模型</span></span><br><span class="line">       mav.addObject(oUser);</span><br><span class="line">       <span class="keyword">return</span> mav;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></div></figure>

<blockquote>
<p>注意到这里在控制器的方法中模型和视图中捆绑了JSON视图(MappingJackson2JsonView),这里的JSON视图是没有视图解析器的定位视图的，它并不是一个逻辑视图，只是需要将数据模型转换为json。<br>。</p>
</blockquote>

        <h2 id="Spring-MVC实例">
          <a href="#Spring-MVC实例" class="heading-link"><i class="fas fa-link"></i></a><a href="#Spring-MVC实例" class="headerlink" title="Spring MVC实例"></a>Spring MVC实例</h2>
      
        <h3 id="1-定制InternalResourceViewResolver初始化">
          <a href="#1-定制InternalResourceViewResolver初始化" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-定制InternalResourceViewResolver初始化" class="headerlink" title="1. 定制InternalResourceViewResolver初始化"></a>1. 定制InternalResourceViewResolver初始化</h3>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">spring.mvc.view.prefix=/WEB-INF/jsp/</span><br><span class="line">spring.mvc.view.suffix=.jsp</span><br></pre></td></tr></table></div></figure>
<blockquote>
<p>通过这样的配置，就能在SpringBoot的机制下定制InternalResourceViewResolver这个视图解析器的初始化，也就是在返回视图名称之后，它会以前缀和后缀以及视图的名称组成全路径定位视图。</p>
</blockquote>

        <h3 id="2-控制器">
          <a href="#2-控制器" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-控制器" class="headerlink" title="2. 控制器"></a>2. 控制器</h3>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/tablePage&quot;)</span></span><br><span class="line"><span class="keyword">public</span> ModelAndView <span class="title function_">disTablePage</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">ModelAndView</span> <span class="variable">mv</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ModelAndView</span>();</span><br><span class="line">    List&lt;ServerUser&gt; suList = uSer.getTarServerUser(<span class="literal">null</span>,<span class="literal">null</span>);</span><br><span class="line">    mv.addObject(<span class="string">&quot;suserList&quot;</span>,suList);</span><br><span class="line">    mv.setViewName(<span class="string">&quot;user/table&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> mv;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@RequestMapping(&quot;/likeData&quot;)</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="keyword">public</span> List&lt;ServerUser&gt; <span class="title function_">likeSeruList</span><span class="params">(<span class="meta">@RequestParam(value = &quot;suName&quot;,required = false)</span> String sName, <span class="meta">@RequestParam(value = &quot;suRemark&quot;,required = false)</span> String sRemark)</span>&#123;</span><br><span class="line">    <span class="comment">//访问模型层得到数据</span></span><br><span class="line">    List&lt;ServerUser&gt; suserList = uSer.getTarServerUser(sName,sRemark);</span><br><span class="line">    <span class="keyword">return</span> suserList;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>


<blockquote>
<p>该控制器的第一个方法是指当访问到它时它将会跳转到table.jsp页面，且将查询到的用户列表捆绑到模型和视图中，这样当跳转到jsp页面时数据将会显示出来。<br>第二个方法，如果对当前表格数据进行查询时可以通过**@RequestParam**注解传递参数进行查询。因为它标注了@ResponseBody,于是SpringMVC就知道最终需要将返回的结果转换为JSON。</p>
</blockquote>

        <h3 id="3-jsp页面">
          <a href="#3-jsp页面" class="heading-link"><i class="fas fa-link"></i></a><a href="#3-jsp页面" class="headerlink" title="3. jsp页面"></a>3. jsp页面</h3>
      <figure class="highlight jsp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page pageEncoding=<span class="string">&quot;utf-8&quot;</span>%&gt;</span><br><span class="line">&lt;%@ taglib prefix=<span class="string">&quot;c&quot;</span> uri=<span class="string">&quot;http://java.sun.com/jsp/jstl/core&quot;</span>%&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">&quot;UTF-8&quot;</span>&gt;</span><br><span class="line">    &lt;title&gt;用户列表&lt;/title&gt;</span><br><span class="line">    &lt;<span class="type">link</span> <span class="variable">rel</span> <span class="operator">=</span> <span class="string">&quot;stylesheet&quot;</span> type=<span class="string">&quot;text/css&quot;</span> href = <span class="string">&quot;../../easyUI/themes/default/easyui.css&quot;</span>&gt;</span><br><span class="line">    &lt;<span class="type">link</span> <span class="variable">rel</span> <span class="operator">=</span> <span class="string">&quot;stylesheet&quot;</span> type=<span class="string">&quot;text/css&quot;</span> href = <span class="string">&quot;../../easyUI/themes/icon.css&quot;</span>&gt;</span><br><span class="line">    &lt;<span class="type">script</span> <span class="variable">type</span> <span class="operator">=</span> <span class="string">&quot;text/javascript&quot;</span> src = <span class="string">&quot;../../easyUI/jquery.min.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line">    &lt;<span class="type">script</span> <span class="variable">type</span> <span class="operator">=</span> <span class="string">&quot;text/javascript&quot;</span> src = <span class="string">&quot;../../easyUI/jquery.easyui.min.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;div id=<span class="string">&quot;cc&quot;</span> class=<span class="string">&quot;easyui-layout&quot;</span> style=<span class="string">&quot;width:600px;height:400px;&quot;</span>&gt;</span><br><span class="line">    &lt;div data-options = <span class="string">&quot;region:&#x27;north&#x27;&quot;</span> style = <span class="string">&quot;height:70px;&quot;</span>&gt;</span><br><span class="line">        &lt;<span class="type">form</span> <span class="variable">id</span> <span class="operator">=</span> <span class="string">&quot;searchForm&quot;</span> method=<span class="string">&quot;post&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line">            &lt;table&gt;</span><br><span class="line">                &lt;tr&gt;</span><br><span class="line">                &lt;td&gt;</span><br><span class="line">                    用户名称:</span><br><span class="line">                &lt;/td&gt;</span><br><span class="line">                &lt;td&gt;</span><br><span class="line">                    &lt;<span class="type">input</span> <span class="variable">id</span> <span class="operator">=</span> <span class="string">&quot;userName&quot;</span> name = <span class="string">&quot;userName&quot;</span> class = <span class="string">&quot;easyui-textbox&quot;</span> data-options = <span class="string">&quot;prompt:&#x27;请输入用户名称...&#x27;&quot;</span></span><br><span class="line">                    style = <span class="string">&quot;width:100%;height:32px;&quot;</span>&gt;</span><br><span class="line">                &lt;/td&gt;</span><br><span class="line">                    &lt;td&gt;</span><br><span class="line">                        备注:</span><br><span class="line">                    &lt;/td&gt;</span><br><span class="line">                    &lt;td&gt;</span><br><span class="line">                        &lt;<span class="type">input</span> <span class="variable">id</span> <span class="operator">=</span> <span class="string">&quot;note&quot;</span> name = <span class="string">&quot;note&quot;</span> class = <span class="string">&quot;easyui-textbox&quot;</span> data-options = <span class="string">&quot;prompt:&#x27;请输入备注...&#x27;&quot;</span></span><br><span class="line">                               style = <span class="string">&quot;width:100%;height:32px;&quot;</span>&gt;</span><br><span class="line">                    &lt;/td&gt;</span><br><span class="line">                    &lt;td&gt;</span><br><span class="line">                        &lt;<span class="type">a</span> <span class="variable">href</span> <span class="operator">=</span> <span class="string">&quot;#&quot;</span> class = <span class="string">&quot;easyui-linkbutton&quot;</span> data-options = <span class="string">&quot;iconCls:&#x27;icon-search&#x27;&quot;</span> style=<span class="string">&quot;width: 80px;&quot;</span> onclick = <span class="string">&quot;onSearch()&quot;</span>&gt;查询&lt;/a&gt;</span><br><span class="line">                    &lt;/td&gt;</span><br><span class="line">                &lt;/tr&gt;</span><br><span class="line">            &lt;/table&gt;</span><br><span class="line"></span><br><span class="line">        &lt;/form&gt;</span><br><span class="line"></span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;div data-options = <span class="string">&quot;region:&#x27;center&#x27;,title:&#x27;用户列表&#x27;,iconCls:&#x27;icon-ok&#x27;&quot;</span>&gt;</span><br><span class="line">&lt;<span class="type">table</span> <span class="variable">id</span> <span class="operator">=</span> <span class="string">&quot;dg&quot;</span> class = <span class="string">&quot;easyui-datagrid&quot;</span> data-options = <span class="string">&quot;border:false,singleSelect:true,fit:true,fitColumns:true&quot;</span>&gt;</span><br><span class="line">        &lt;thead&gt;</span><br><span class="line">            &lt;tr&gt;</span><br><span class="line">                &lt;th data-options = <span class="string">&quot;field:&#x27;id&#x27;&quot;</span> width=<span class="string">&quot;80&quot;</span>&gt;</span><br><span class="line">                    编号</span><br><span class="line">                &lt;/th&gt;</span><br><span class="line">                &lt;th data-options = <span class="string">&quot;field:&#x27;name&#x27;&quot;</span> width=<span class="string">&quot;100&quot;</span>&gt;</span><br><span class="line">                    用户名称</span><br><span class="line">                &lt;/th&gt;</span><br><span class="line">                &lt;th data-options = <span class="string">&quot;field:&#x27;phone&#x27;&quot;</span> width=<span class="string">&quot;100&quot;</span>&gt;</span><br><span class="line">                    用户电话</span><br><span class="line">                &lt;/th&gt;</span><br><span class="line">                &lt;th data-options = <span class="string">&quot;field:&#x27;remark&#x27;&quot;</span> width=<span class="string">&quot;80&quot;</span>&gt;</span><br><span class="line">                    备注</span><br><span class="line">                &lt;/th&gt;</span><br><span class="line">            &lt;/tr&gt;</span><br><span class="line">        &lt;/thead&gt;</span><br><span class="line">        &lt;tbody&gt;</span><br><span class="line">        &lt;c:forEach items=<span class="string">&quot;$&#123;suserList&#125;&quot;</span> <span class="keyword">var</span> = <span class="string">&quot;user&quot;</span>&gt;</span><br><span class="line">            &lt;tr&gt;</span><br><span class="line">                &lt;td&gt;$&#123;user.id&#125;&lt;/td&gt;</span><br><span class="line">                &lt;td&gt;$&#123;user.name&#125;&lt;/td&gt;</span><br><span class="line">                &lt;td&gt;$&#123;user.phone&#125;&lt;/td&gt;</span><br><span class="line">                &lt;td&gt;$&#123;user.remark&#125;&lt;/td&gt;</span><br><span class="line">            &lt;/tr&gt;</span><br><span class="line">        &lt;/c:forEach&gt;</span><br><span class="line"></span><br><span class="line">        &lt;/tbody&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &lt;/table&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;script type=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><br><span class="line">    function <span class="title function_">onSearch</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">var</span> <span class="variable">opts</span> <span class="operator">=</span> $(<span class="string">&quot;#dg&quot;</span>).datagrid(<span class="string">&quot;options&quot;</span>);</span><br><span class="line">        opts.url = <span class="string">&quot;./likeData&quot;</span>;</span><br><span class="line">        <span class="comment">//获取参数</span></span><br><span class="line">        <span class="type">var</span> <span class="variable">suName</span> <span class="operator">=</span> $(<span class="string">&quot;#userName&quot;</span>).val();</span><br><span class="line">        <span class="type">var</span> <span class="variable">suRemark</span> <span class="operator">=</span> $(<span class="string">&quot;#note&quot;</span>).val();</span><br><span class="line">        <span class="type">var</span> <span class="variable">params</span> <span class="operator">=</span> &#123;&#125;;</span><br><span class="line">        <span class="keyword">if</span>(suName!=<span class="literal">null</span>&amp;&amp;suName.trim()!=<span class="string">&quot;&quot;</span>)&#123;</span><br><span class="line">            params.suName = suName;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(suRemark!=<span class="literal">null</span>&amp;&amp;suRemark.trim()!=<span class="string">&quot;&quot;</span>)&#123;</span><br><span class="line">            params.suRemark = suRemark;</span><br><span class="line">        &#125;</span><br><span class="line">        $(<span class="string">&quot;#dg&quot;</span>).datagrid(<span class="string">&quot;load&quot;</span>,params);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></div></figure>

<ol>
<li>JSP页面及静态资源所在位置:</li>
</ol>
<p><img src="/2020/06/17/Spring-MVC%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0v1/QQ%E6%88%AA%E5%9B%BE20200622175140.png"></p>
<ol start="2">
<li>JSP页面所需要的依赖关系</li>
</ol>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">	&lt;groupId&gt;javax.servlet&lt;/groupId&gt;</span><br><span class="line">	&lt;artifactId&gt;jstl&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">	&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">	&lt;artifactId&gt;spring-boot-starter-tomcat&lt;/artifactId&gt;</span><br><span class="line">	&lt;scope&gt;provided&lt;/scope&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">	&lt;groupId&gt;org.apache.tomcat.embed&lt;/groupId&gt;</span><br><span class="line">	&lt;artifactId&gt;tomcat-embed-jasper&lt;/artifactId&gt;</span><br><span class="line">	&lt;scope&gt;provided&lt;/scope&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>

<blockquote>
<p>首先，在我们访问控制器第一个方法后就会跳转到jsp页面，因为我们绑定了所查询到的用户列表数据，可以直接使用jstl语言将查询到的数据展示在表格中。然后写查询的js方法，在输入用户名称或者是备注后将数据传入到后台中。</p>
</blockquote>
<p><img src="/2020/06/17/Spring-MVC%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0v1/QQ%E6%88%AA%E5%9B%BE20200622175618.png"></p>
<p><img src="/2020/06/17/Spring-MVC%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0v1/QQ%E6%88%AA%E5%9B%BE20200622175640.png"></p>
<p><strong>注意传递参数值的一致</strong></p>
<blockquote>
<p> 注意一点的是，在jsp页面中使用的是easyui的框架，所以表格头<strong>th</strong>的<strong>field</strong>的属性要与封装类的属性一致，这样在查询后返回的数据才能完整的显示在表格中。</p>
</blockquote>

        <h2 id="获取控制器参数">
          <a href="#获取控制器参数" class="heading-link"><i class="fas fa-link"></i></a><a href="#获取控制器参数" class="headerlink" title="获取控制器参数"></a>获取控制器参数</h2>
      
        <h4 id="1-无注解获取参数">
          <a href="#1-无注解获取参数" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-无注解获取参数" class="headerlink" title="1.无注解获取参数"></a>1.无注解获取参数</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/no/annotation&quot;)</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="keyword">public</span> Map&lt;String,Object&gt; <span class="title function_">getNoAnnotationParam</span><span class="params">(Integer par1,Long par2,String str3)</span>&#123;</span><br><span class="line">    Map&lt;String,Object&gt; parMap = <span class="keyword">new</span> <span class="title class_">LinkedHashMap</span>&lt;&gt;();</span><br><span class="line">    parMap.put(<span class="string">&quot;par1&quot;</span>,par1);</span><br><span class="line">    parMap.put(<span class="string">&quot;par2&quot;</span>,par2);</span><br><span class="line">    parMap.put(<span class="string">&quot;str3&quot;</span>,str3);</span><br><span class="line">    <span class="keyword">return</span> parMap;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>
<p>访问:<span class="exturl"><a class="exturl__link" target="_blank" rel="noopener" href="http://localhost:8080/users/no/annotation?par1=3&amp;par2=4&amp;str3=aaa">http://localhost:8080/users/no/annotation?par1=3&amp;par2=4&amp;str3=aaa</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>
<p><strong>注意:参数的名称要与http请求的参数名称保持一致。</strong></p>

        <h4 id="2-RequestParam传递参数">
          <a href="#2-RequestParam传递参数" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-RequestParam传递参数" class="headerlink" title="2.@RequestParam传递参数"></a>2.@RequestParam传递参数</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/have/annotationParam&quot;)</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="keyword">public</span> Map&lt;String,Object&gt; <span class="title function_">getParamMap</span><span class="params">(<span class="meta">@RequestParam(value = &quot;par1&quot;,required = false)</span> String par1,<span class="meta">@RequestParam(value = &quot;par2&quot;,required = false)</span> String par2)</span>&#123;</span><br><span class="line"></span><br><span class="line">    Map&lt;String,Object&gt; paraMap = <span class="keyword">new</span> <span class="title class_">LinkedHashMap</span>&lt;&gt;();</span><br><span class="line">    paraMap.put(<span class="string">&quot;par1&quot;</span>,par1);</span><br><span class="line">    paraMap.put(<span class="string">&quot;par2&quot;</span>,par2);</span><br><span class="line">    <span class="keyword">return</span> paraMap;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<blockquote>
<p>required属性可以支持传递的参数为空</p>
</blockquote>

        <h4 id="3-传递数组">
          <a href="#3-传递数组" class="heading-link"><i class="fas fa-link"></i></a><a href="#3-传递数组" class="headerlink" title="3.传递数组"></a>3.传递数组</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/arrParam&quot;)</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="keyword">public</span> Map&lt;String,Object&gt; <span class="title function_">getArrParameter</span><span class="params">(<span class="type">int</span>[] intarr,<span class="type">long</span>[] longarr,String[] strarr)</span>&#123;</span><br><span class="line"></span><br><span class="line">    Map&lt;String,Object&gt; arrMap = <span class="keyword">new</span> <span class="title class_">LinkedHashMap</span>&lt;&gt;();</span><br><span class="line">    arrMap.put(<span class="string">&quot;intarr&quot;</span>,intarr);</span><br><span class="line">    arrMap.put(<span class="string">&quot;longarr&quot;</span>,longarr);</span><br><span class="line">    arrMap.put(<span class="string">&quot;strarr&quot;</span>,strarr);</span><br><span class="line">    <span class="keyword">return</span> arrMap;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<blockquote>
<p>访问地址<span class="exturl"><a class="exturl__link" target="_blank" rel="noopener" href="http://localhost:8080/users/arrParam?intarr=1,2,3&amp;longarr=4,5,6&amp;strarr=a,b,c">http://localhost:8080/users/arrParam?intarr=1,2,3&amp;longarr=4,5,6&amp;strarr=a,b,c</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>
</blockquote>
<blockquote>
<p>可以看到，传递数组时，每个参数的数组元素只需要通过逗号分隔开即可</p>
</blockquote>

        <h4 id="4-传递JSON">
          <a href="#4-传递JSON" class="heading-link"><i class="fas fa-link"></i></a><a href="#4-传递JSON" class="headerlink" title="4.传递JSON"></a>4.传递JSON</h4>
      <p><strong>搭建表单JSP文件</strong></p>
<figure class="highlight jsp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page pageEncoding=<span class="string">&quot;utf-8&quot;</span>%&gt;</span><br><span class="line">&lt;%@ taglib prefix=<span class="string">&quot;c&quot;</span> uri=<span class="string">&quot;http://java.sun.com/jsp/jstl/core&quot;</span>%&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt;添加用户&lt;/title&gt;</span><br><span class="line">    &lt;<span class="type">script</span> <span class="variable">src</span> <span class="operator">=</span> <span class="string">&quot;https://code.jquery.com/jquery-3.0.0.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line"></span><br><span class="line">        &lt;table&gt;</span><br><span class="line">            &lt;tr&gt;</span><br><span class="line">                &lt;td&gt;</span><br><span class="line">                    用户名称：</span><br><span class="line">                &lt;/td&gt;</span><br><span class="line">                &lt;td&gt;</span><br><span class="line">                    &lt;<span class="type">input</span> <span class="variable">id</span> <span class="operator">=</span> <span class="string">&quot;userName&quot;</span> name = <span class="string">&quot;userName&quot;</span>/&gt;</span><br><span class="line">                &lt;/td&gt;</span><br><span class="line">            &lt;/tr&gt;</span><br><span class="line">            &lt;tr&gt;</span><br><span class="line">                &lt;td&gt;</span><br><span class="line">                    备注：</span><br><span class="line">                &lt;/td&gt;</span><br><span class="line">                &lt;td&gt;</span><br><span class="line">                    &lt;<span class="type">input</span> <span class="variable">id</span> <span class="operator">=</span> <span class="string">&quot;userRemark&quot;</span> name = <span class="string">&quot;userRemark&quot;</span>/&gt;</span><br><span class="line">                &lt;/td&gt;</span><br><span class="line">            &lt;/tr&gt;</span><br><span class="line">            &lt;tr&gt;</span><br><span class="line">                &lt;td colspan=<span class="string">&quot;2&quot;</span>&gt;</span><br><span class="line">                    &lt;<span class="type">button</span> <span class="variable">id</span> <span class="operator">=</span> <span class="string">&quot;userSubmit&quot;</span>&gt;</span><br><span class="line">                        提交</span><br><span class="line">                    &lt;/button&gt;</span><br><span class="line"></span><br><span class="line">                &lt;/td&gt;</span><br><span class="line">            &lt;/tr&gt;</span><br><span class="line">        &lt;/table&gt;</span><br><span class="line"></span><br><span class="line">&lt;script type=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><br><span class="line">    $(function()&#123;</span><br><span class="line">       $(<span class="string">&quot;#userSubmit&quot;</span>) .click(function()&#123;</span><br><span class="line">           <span class="comment">//获取表单输入的值</span></span><br><span class="line">          <span class="type">var</span> <span class="variable">userName</span> <span class="operator">=</span> $(<span class="string">&quot;#userName&quot;</span>).val();</span><br><span class="line">          <span class="type">var</span> <span class="variable">userRemark</span> <span class="operator">=</span> $(<span class="string">&quot;#userRemark&quot;</span>).val();</span><br><span class="line"></span><br><span class="line">          <span class="type">var</span> <span class="variable">params</span> <span class="operator">=</span> &#123;&#125;;</span><br><span class="line">          params.name = userName;</span><br><span class="line">          params.remark = userRemark;</span><br><span class="line"></span><br><span class="line">          $.post(&#123;</span><br><span class="line">              url : <span class="string">&quot;./addUserInfo&quot;</span>,</span><br><span class="line">              <span class="comment">//告知传递的类型为json，不可缺少</span></span><br><span class="line">              contentType : <span class="string">&quot;application/json&quot;</span>,</span><br><span class="line">              <span class="comment">//将JSON转化为字符串传递</span></span><br><span class="line">              data : JSON.stringify(params),</span><br><span class="line">              <span class="comment">//成功后的回调方法</span></span><br><span class="line">              success : function(result)&#123;</span><br><span class="line">                  <span class="keyword">if</span>(result == <span class="literal">null</span>||result.id == <span class="literal">null</span>)&#123;</span><br><span class="line">                      alert(<span class="string">&quot;插入失败!&quot;</span>);</span><br><span class="line">                      <span class="keyword">return</span>;</span><br><span class="line">                  &#125;</span><br><span class="line">                  alert(<span class="string">&quot;插入成功！！&quot;</span>);</span><br><span class="line"></span><br><span class="line">              &#125;</span><br><span class="line">          &#125;);</span><br><span class="line">       &#125;);</span><br><span class="line"></span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></div></figure>

<p><strong>控制器方法(访问页面和添加数据的方法)</strong></p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 访问添加用户对象的页面</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/add&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">addUserPage</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;/user/add&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 添加数据</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@PostMapping(&quot;/addUserInfo&quot;)</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="keyword">public</span> ServerUser <span class="title function_">addServerUser</span><span class="params">(<span class="meta">@RequestBody</span> ServerUser sUser)</span>&#123;</span><br><span class="line">    <span class="type">ServerUser</span> <span class="variable">serUser</span> <span class="operator">=</span> uSer.insertServerUser(sUser);</span><br><span class="line">    <span class="keyword">return</span> serUser;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<blockquote>
<p>在控制器的第二个方法addServerUser中，参数标注为@RequestBody，意味着它将接受前端提交的JSON请求体，而前端JSON数据的请求体与ServerUser类之间的属性名称是保持一致的，这样SpringMVC就会通过这层映射关系将JSON请求体转换为ServerUser对象。</p>
</blockquote>
<p><strong>添加测试</strong></p>

        <h4 id="5-通过URL传递数据">
          <a href="#5-通过URL传递数据" class="heading-link"><i class="fas fa-link"></i></a><a href="#5-通过URL传递数据" class="headerlink" title="5.通过URL传递数据"></a>5.通过URL传递数据</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 通过URL传递数据</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="keyword">public</span> ServerUser <span class="title function_">getUrlParamSerUser</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long id)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> uSer.getServerUser(id);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<blockquote>
<p>一些网站中，提供了REST风格，这时的参数往往通过URL传递。例如获取编号为1的用户，URL就要写为&#x2F;user&#x2F;1，1代表用户编号。可以通过处理器映射和注解@PathVariable的组合获取URL参数。例如以上控制器的方法就可以使用网址<span class="exturl"><a class="exturl__link" target="_blank" rel="noopener" href="http://localhost:8080/users/16">http://localhost:8080/users/16</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>访问编号为16的用户信息。</p>
</blockquote>
<p><strong>JSP页面</strong></p>
<figure class="highlight jsp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="type">form</span> <span class="variable">action</span> <span class="operator">=</span> <span class="string">&quot;./formatParam&quot;</span> method=<span class="string">&quot;post&quot;</span>&gt;</span><br><span class="line">    &lt;<span class="type">input</span> <span class="variable">type</span> <span class="operator">=</span> <span class="string">&quot;text&quot;</span> name = <span class="string">&quot;date1&quot;</span> value = <span class="string">&quot;2019-12-15&quot;</span>/&gt;</span><br><span class="line">    &lt;<span class="type">input</span> <span class="variable">type</span> <span class="operator">=</span> <span class="string">&quot;text&quot;</span> name = <span class="string">&quot;number1&quot;</span> value = <span class="string">&quot;1,234,567.89&quot;</span>/&gt;</span><br><span class="line">    &lt;<span class="type">input</span> <span class="variable">type</span> <span class="operator">=</span> <span class="string">&quot;submit&quot;</span> value = <span class="string">&quot;提交&quot;</span>/&gt;</span><br><span class="line">&lt;/form&gt;</span><br></pre></td></tr></table></div></figure>

<p><strong>控制器</strong></p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">/**</span></span><br><span class="line"><span class="comment">  * 获取格式化参数</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"><span class="meta">@PostMapping(&quot;/formatParam&quot;)</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="keyword">public</span> Map&lt;String,Object&gt; <span class="title function_">getFormatterParams</span><span class="params">(<span class="meta">@DateTimeFormat(iso = DateTimeFormat.ISO.DATE)</span> Date date1, <span class="meta">@NumberFormat(pattern = &quot;#,###.##&quot;)</span> Double number1)</span>&#123;</span><br><span class="line">    Map&lt;String,Object&gt; formatNums = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    formatNums.put(<span class="string">&quot;date&quot;</span>,date1);</span><br><span class="line">    formatNums.put(<span class="string">&quot;nums&quot;</span>,number1);</span><br><span class="line">    <span class="keyword">return</span> formatNums;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<p>提交后页面数据显示:</p>
<p><img src="/2020/06/17/Spring-MVC%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0v1/QQ%E6%88%AA%E5%9B%BE20200624191746.png"></p>

        <h4 id="6-一对一转换器">
          <a href="#6-一对一转换器" class="heading-link"><i class="fas fa-link"></i></a><a href="#6-一对一转换器" class="headerlink" title="6.一对一转换器"></a>6.一对一转换器</h4>
      <p><strong>字符串用户转换器</strong></p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.rediscachetest.tools;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.rediscachetest.pojo.ServerUser;</span><br><span class="line"><span class="keyword">import</span> org.springframework.core.convert.converter.Converter;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StringToUserConvert</span> <span class="keyword">implements</span> <span class="title class_">Converter</span>&lt;String, ServerUser&gt; &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> ServerUser <span class="title function_">convert</span><span class="params">(String s)</span> &#123;</span><br><span class="line">        <span class="type">ServerUser</span> <span class="variable">suser</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ServerUser</span>();</span><br><span class="line">        String[] strArr = s.split(<span class="string">&quot;-&quot;</span>);</span><br><span class="line">        <span class="type">Long</span> <span class="variable">id</span> <span class="operator">=</span> Long.parseLong(strArr[<span class="number">0</span>]);</span><br><span class="line">        <span class="type">String</span> <span class="variable">userName</span> <span class="operator">=</span> strArr[<span class="number">1</span>];</span><br><span class="line">        <span class="type">String</span> <span class="variable">remark</span> <span class="operator">=</span> strArr[<span class="number">2</span>];</span><br><span class="line">        suser.setId(id);</span><br><span class="line">        suser.setName(userName);</span><br><span class="line">        suser.setRemark(remark);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> suser;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>

<blockquote>
<p>这里的类标注为@Component，并且实现了Converter接口，这样Spring就会将这个类扫描并装配到IoC容器中。这里的泛型指定为String和ServerUser，这样SpringMVC就会通过HTTP的参数类型（String）和控制器的参数类型（ServerUser）进行匹配，就可以从注册机制中发现这个转换类，这样就能够将参数转换出来。</p>
</blockquote>
<p><strong>控制器验证</strong></p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/convertTest&quot;)</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="keyword">public</span> ServerUser <span class="title function_">getUserByConverter</span><span class="params">(ServerUser serverUser)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> serverUser;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<p>输入地址：<span class="exturl"><a class="exturl__link" target="_blank" rel="noopener" href="http://localhost:8080/users/convertTest?serverUser=1--note_1&amp;date=2018-01-01">http://localhost:8080/users/convertTest?serverUser=1--note_1&amp;date=2018-01-01</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>
<p>如此一来就可以得到用户的id和备注</p>

        <h2 id="数据验证">
          <a href="#数据验证" class="heading-link"><i class="fas fa-link"></i></a><a href="#数据验证" class="headerlink" title="数据验证"></a>数据验证</h2>
      
        <h3 id="JSR-303验证">
          <a href="#JSR-303验证" class="heading-link"><i class="fas fa-link"></i></a><a href="#JSR-303验证" class="headerlink" title="JSR-303验证"></a>JSR-303验证</h3>
      <p><strong>验证POJO类</strong></p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.rediscachetest.pojo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.type.Alias;</span><br><span class="line"><span class="keyword">import</span> org.hibernate.validator.constraints.Range;</span><br><span class="line"><span class="keyword">import</span> org.springframework.format.annotation.DateTimeFormat;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.validation.constraints.*;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"><span class="meta">@Alias(&quot;validdate&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ValidatorPojo</span> &#123;</span><br><span class="line">    <span class="meta">@NotNull(message = &quot;Id不能为空&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Long Id;</span><br><span class="line">    <span class="meta">@NotNull(message = &quot;日期不能为空&quot;)</span></span><br><span class="line">    <span class="meta">@Future(message = &quot;需要一个将来的日期&quot;)</span></span><br><span class="line">    <span class="meta">@DateTimeFormat(pattern = &quot;yyyy-MM-dd&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Date Date;</span><br><span class="line">    <span class="meta">@NotNull</span></span><br><span class="line">    <span class="meta">@DecimalMin(value = &quot;0.1&quot;)</span></span><br><span class="line">    <span class="meta">@DecimalMax(value = &quot;10000.00&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Double DoubleValue;</span><br><span class="line">    <span class="meta">@Min(value = 1,message = &quot;最小值为1&quot;)</span></span><br><span class="line">    <span class="meta">@Max(value = 3,message = &quot;最大值为3&quot;)</span></span><br><span class="line">    <span class="meta">@NotNull</span></span><br><span class="line">    <span class="keyword">private</span> Integer IntegerValue;</span><br><span class="line">    <span class="meta">@org</span>.hibernate.validator.constraints.Range(min = <span class="number">1</span>,max = <span class="number">888</span>,message = <span class="string">&quot;范围1-888&quot;</span>)</span><br><span class="line">    <span class="meta">@NotNull</span></span><br><span class="line">    <span class="keyword">private</span> Long Range;</span><br><span class="line">    <span class="meta">@Email(message = &quot;邮箱格式错误&quot;)</span></span><br><span class="line">    <span class="meta">@NotNull</span></span><br><span class="line">    <span class="keyword">private</span> String Email;</span><br><span class="line">    <span class="meta">@Size(min = 20,max = 30,message = &quot;字段长度20-30&quot;)</span></span><br><span class="line">    <span class="meta">@NotNull</span></span><br><span class="line">    <span class="keyword">private</span> String Size;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">	 *set/get</span></span><br><span class="line"><span class="comment">	 **/</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>

<p><strong>ajax发送请求</strong></p>
<figure class="highlight jsp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page pageEncoding=<span class="string">&quot;utf-8&quot;</span>%&gt;</span><br><span class="line">&lt;%@ taglib prefix=<span class="string">&quot;c&quot;</span> uri=<span class="string">&quot;http://java.sun.com/jsp/jstl/core&quot;</span>%&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt;验证用户&lt;/title&gt;</span><br><span class="line">    &lt;<span class="type">script</span> <span class="variable">src</span> <span class="operator">=</span> <span class="string">&quot;https://code.jquery.com/jquery-3.0.0.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;script type=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><br><span class="line">    $(function()&#123;</span><br><span class="line">            <span class="comment">//获取表单输入的值</span></span><br><span class="line">            <span class="type">var</span> <span class="variable">pojo</span> <span class="operator">=</span> &#123;</span><br><span class="line">                id:<span class="literal">null</span>,</span><br><span class="line">                date:<span class="string">&quot;2017-08-08&quot;</span>,</span><br><span class="line">                doubleValue:<span class="number">1999999.09</span>,</span><br><span class="line">                integerValue:<span class="number">100</span>,</span><br><span class="line">                range:<span class="number">1000</span>,</span><br><span class="line">                email:<span class="string">&quot;email&quot;</span>,</span><br><span class="line">                size:<span class="string">&#x27;adv1212&#x27;</span>,</span><br><span class="line">            &#125;;</span><br><span class="line">            $.post(&#123;</span><br><span class="line">                url : <span class="string">&quot;./validate&quot;</span>,</span><br><span class="line">                <span class="comment">//告知传递的类型为json，不可缺少</span></span><br><span class="line">                contentType : <span class="string">&quot;application/json&quot;</span>,</span><br><span class="line">                <span class="comment">//将JSON转化为字符串传递</span></span><br><span class="line">                data : JSON.stringify(pojo),</span><br><span class="line">                <span class="comment">//成功后的回调方法</span></span><br><span class="line">                success : function(result)&#123;</span><br><span class="line">                    console.info(result);</span><br><span class="line"></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></div></figure>

<blockquote>
<p>注意此处json数据需要和封装类的属性对应，且json数据的属性开头字母必须小写</p>
</blockquote>
<p><strong>控制器</strong></p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">@GetMapping(&quot;/page/trans&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">returnPageVali</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;/user/valid&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@RequestMapping(&quot;/page/validate&quot;)</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="keyword">public</span> Map&lt;String,Object&gt; <span class="title function_">validate</span><span class="params">(<span class="meta">@Valid</span> <span class="meta">@RequestBody</span> ValidatorPojo vpo, Errors errors)</span>&#123;</span><br><span class="line">    Map&lt;String,Object&gt; errMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    List&lt;ObjectError&gt; oes = errors.getAllErrors();</span><br><span class="line">    <span class="keyword">for</span>(ObjectError oe:oes)&#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">msg</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">if</span>(oe <span class="keyword">instanceof</span> FieldError)&#123;</span><br><span class="line">            <span class="type">FieldError</span> <span class="variable">fe</span> <span class="operator">=</span> (FieldError)oe;</span><br><span class="line">            key = fe.getField();<span class="comment">//获取错误字段名</span></span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            key = oe.getObjectName();<span class="comment">//获取验证对象名称</span></span><br><span class="line">        &#125;</span><br><span class="line">        msg = oe.getDefaultMessage();</span><br><span class="line">        errMap.put(key,msg);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> errMap;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<blockquote>
<p>由于一开始访问的jsp页面的路径中包含<strong>page</strong>，所以ajax访问的控制器方法的路径也需要包含page。在一开始访问jsp页面时路径中就包含了<strong>page</strong>路径，所以在ajax访问控制器路径时不需要加上<strong>page</strong>的路径。</p>
</blockquote>
<blockquote>
<p>@Valid注解表示启动验证机制。他会自动将最后的验证结果放入Errors对象中，这样就可以从中得到相关验证过后的信息。</p>
</blockquote>
<p><strong>结果</strong></p>
<p><img src="/2020/06/17/Spring-MVC%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0v1/QQ%E6%88%AA%E5%9B%BE20200628183852.png"></p>

        <h3 id="参数验证机制">
          <a href="#参数验证机制" class="heading-link"><i class="fas fa-link"></i></a><a href="#参数验证机制" class="headerlink" title="参数验证机制"></a>参数验证机制</h3>
      <p><strong>自定义用户验证器</strong></p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.rediscachetest.validator;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.rediscachetest.pojo.ServerUser;</span><br><span class="line"><span class="keyword">import</span> org.springframework.util.StringUtils;</span><br><span class="line"><span class="keyword">import</span> org.springframework.validation.Errors;</span><br><span class="line"><span class="keyword">import</span> org.springframework.validation.Validator;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserValidator</span> <span class="keyword">implements</span> <span class="title class_">Validator</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">supports</span><span class="params">(Class&lt;?&gt; aClass)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> aClass.equals(ServerUser.class);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">validate</span><span class="params">(Object o, Errors errors)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(o == <span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="comment">//直接在参数处报错，这样就无法进入控制器</span></span><br><span class="line">            errors.rejectValue(<span class="string">&quot;&quot;</span>,<span class="literal">null</span>,<span class="string">&quot;用户不能为空&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">ServerUser</span> <span class="variable">sUser</span> <span class="operator">=</span> (ServerUser)o;</span><br><span class="line">        <span class="keyword">if</span>(StringUtils.isEmpty(sUser.getName()))&#123;</span><br><span class="line">            errors.rejectValue(<span class="string">&quot;name&quot;</span>,<span class="literal">null</span>,<span class="string">&quot;用户名不能为空&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>

<blockquote>
<p>其中，support方法参数为需要验证的POJO类型。若返回为true，则Spring会使用当前验证器的validate方法去验证POJO。validate方法包含需要额target对象和错误对象errors，其中，target是参数绑定后的POJO，如果发现错误，则会保存在errors对象中，然后返回给控制器。</p>
</blockquote>
<p><strong>虽然有了这个验证器，但是Spring还不会启用它，因为还没有绑定WebDataBinder机制。这里提供了注解@InitBinder,他的作用是在执行控制器的方法前，处理器会先执行被@InitBinder标注额地方法。这时可以将WebDataBinder对象作为参数传递到方法中。通过这层关系得到WebDataBinder对象，此对象有一个setValidator方法，可以绑定自定义的验证器，这样就可以获取参数后，通过自定义的验证器去验证参数。WebDataBinder除了可以绑定验证器外，还可以进行参数的自定义。</strong></p>
<p><strong>绑定验证器</strong></p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 调用控制器前先执行此方法</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> binder</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@InitBinder</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">initBinder</span><span class="params">(WebDataBinder binder)</span>&#123;</span><br><span class="line">    binder.setValidator(<span class="keyword">new</span> <span class="title class_">UserValidator</span>());</span><br><span class="line">    <span class="comment">//定义日期参数格式，参数不在需要注解@DateTimeFormat，boolean参数表示是否允许为空</span></span><br><span class="line">    binder.registerCustomEditor(Date.class,<span class="keyword">new</span> <span class="title class_">CustomDateEditor</span>(<span class="keyword">new</span> <span class="title class_">SimpleDateFormat</span>(<span class="string">&quot;yyyy-MM-dd&quot;</span>),<span class="literal">false</span>));</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@GetMapping(&quot;/validatorOne&quot;)</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="keyword">public</span> Map&lt;String,Object&gt; <span class="title function_">validator</span><span class="params">(<span class="meta">@Valid</span> ServerUser serverUserOne,Errors errorrs,Date date)</span>&#123;</span><br><span class="line">    Map&lt;String,Object&gt; mapObj = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    mapObj.put(<span class="string">&quot;ServerUser&quot;</span>,serverUserOne);</span><br><span class="line">    mapObj.put(<span class="string">&quot;date&quot;</span>,date);</span><br><span class="line">    <span class="comment">//判断是否存在错误</span></span><br><span class="line">    List&lt;ObjectError&gt; oes = errorrs.getAllErrors();</span><br><span class="line">    <span class="keyword">for</span>(ObjectError oe:oes)&#123;</span><br><span class="line">        <span class="keyword">if</span>(oe <span class="keyword">instanceof</span> FieldError)&#123;</span><br><span class="line">            <span class="type">FieldError</span> <span class="variable">fe</span> <span class="operator">=</span> (FieldError)oe;</span><br><span class="line">            mapObj.put(fe.getField(),fe.getDefaultMessage());</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            mapObj.put(oe.getObjectName(),oe.getDefaultMessage());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> mapObj;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<p>最后访问地址<span class="exturl"><a class="exturl__link" target="_blank" rel="noopener" href="http://localhost:8080/users/validatorOne?serverUser=1--note_1&amp;date=2018-01-01%E3%80%82">http://localhost:8080/users/validatorOne?serverUser=1--note_1&amp;date=2018-01-01。</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>

        <h2 id="数据模型">
          <a href="#数据模型" class="heading-link"><i class="fas fa-link"></i></a><a href="#数据模型" class="headerlink" title="数据模型"></a>数据模型</h2>
      <p>数据模型的作用就是绑定数据，为后面的视图渲染做准备。</p>
<p><strong>如果在控制器的方法中的参数中使用ModelAndView，Model，ModelMap作为参数类型，SpringMVC会自动创建数据模型对象。如下代码:</strong></p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.rediscachetest.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.rediscachetest.pojo.ServerUser;</span><br><span class="line"><span class="keyword">import</span> com.example.rediscachetest.serviceImpl.userServiceImpl;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.ui.Model;</span><br><span class="line"><span class="keyword">import</span> org.springframework.ui.ModelMap;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.ResponseBody;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.ModelAndView;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/models&quot;)</span></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">modelController</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> userServiceImpl uServ;</span><br><span class="line">    <span class="meta">@GetMapping(&quot;/mod1&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getModelUser</span><span class="params">(Long id, Model moodel)</span>&#123;</span><br><span class="line">        <span class="type">ServerUser</span> <span class="variable">suser</span> <span class="operator">=</span> uServ.getServerUser(id);</span><br><span class="line">        moodel.addAttribute(<span class="string">&quot;user&quot;</span>,suser);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;/user/detail&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@GetMapping(&quot;/mod2&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ModelAndView <span class="title function_">userModelMap</span><span class="params">(Long id, ModelMap modelMap)</span>&#123;</span><br><span class="line">        <span class="type">ServerUser</span> <span class="variable">serverUser</span> <span class="operator">=</span> uServ.getServerUser(id);</span><br><span class="line">        <span class="type">ModelAndView</span> <span class="variable">mv1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ModelAndView</span>();</span><br><span class="line">        <span class="comment">//设置视图名称</span></span><br><span class="line">        mv1.setViewName(<span class="string">&quot;/user/detail&quot;</span>);</span><br><span class="line">        <span class="comment">//设置视图模型，此处modelMap并没有与mv绑定，这个步骤系统会自动处理</span></span><br><span class="line">        modelMap.put(<span class="string">&quot;user&quot;</span>,serverUser);</span><br><span class="line">        <span class="keyword">return</span> mv1;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@GetMapping(&quot;/mod3&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ModelAndView <span class="title function_">useModelAndView</span><span class="params">(Long id,ModelAndView mv)</span>&#123;</span><br><span class="line">        <span class="type">ServerUser</span> <span class="variable">serverUser</span> <span class="operator">=</span> uServ.getServerUser(id);</span><br><span class="line">        mv.setViewName(<span class="string">&quot;/user/detail&quot;</span>);</span><br><span class="line">        mv.addObject(<span class="string">&quot;user&quot;</span>,serverUser);</span><br><span class="line">        <span class="keyword">return</span>  mv;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>

<blockquote>
<p>从上述代码中可以看出，SpringMVC是比较智能的，比如第一个控制器的方法啊只是返回了一个字符串，SpringMVC便会自动生成对应的视图，并且绑定数据模型，第二个方法中，返回的是ModelAndView对象，但是并没有绑定ModelMap对象，SpringMVC会自动绑定它。上述数据对象，使用哪一个都是可以的，因为他们都是渲染的同一个jsp视图，这样通过定位，就可以将数据渲染到JSP中了。</p>
</blockquote>

        <h2 id="SpringMVC文件上传">
          <a href="#SpringMVC文件上传" class="heading-link"><i class="fas fa-link"></i></a><a href="#SpringMVC文件上传" class="headerlink" title="SpringMVC文件上传"></a>SpringMVC文件上传</h2>
      <p><strong>1. SpringMVC上传文件配置</strong></p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">spring.servlet.multipart.location=d:/Otherfiles/JSPdownload</span><br><span class="line">spring.servlet.multipart.max-file-size=<span class="number">5242880</span></span><br><span class="line">spring.servlet.multipart.max-request-size=20MB</span><br></pre></td></tr></table></div></figure>

<p><strong>2. JSP文件</strong></p>
<figure class="highlight jsp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page pageEncoding=<span class="string">&quot;utf-8&quot;</span>%&gt;</span><br><span class="line">&lt;%@ taglib prefix=<span class="string">&quot;c&quot;</span> uri=<span class="string">&quot;http://java.sun.com/jsp/jstl/core&quot;</span>%&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt;上传文件&lt;/title&gt;</span><br><span class="line">    &lt;<span class="type">script</span> <span class="variable">src</span> <span class="operator">=</span> <span class="string">&quot;https://code.jquery.com/jquery-3.0.0.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line"></span><br><span class="line">    &lt;<span class="type">form</span> <span class="variable">method</span> <span class="operator">=</span> <span class="string">&quot;post&quot;</span> action = <span class="string">&quot;./requests&quot;</span> enctype=<span class="string">&quot;multipart/form-data&quot;</span>&gt;</span><br><span class="line">        &lt;input type=<span class="string">&quot;file&quot;</span> name = <span class="string">&quot;file&quot;</span> value = <span class="string">&quot;请选择上传的文件&quot;</span>&gt;</span><br><span class="line">        &lt;<span class="type">input</span> <span class="variable">type</span> <span class="operator">=</span> <span class="string">&quot;submit&quot;</span> value=<span class="string">&quot;提交&quot;</span>&gt;</span><br><span class="line">    &lt;/form&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></div></figure>

<blockquote>
<p>此处form表单声明为  multipart&#x2F;form-data ,如果没有这个声明，SpringMVC就会解析文件请求出错。method的属性也必须是POST</p>
</blockquote>
<p><strong>3. 文件上传控制器</strong></p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 打开文件上传的请求界面</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/uploads/pages&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">openUpPage</span><span class="params">()</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;user/upload&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 上传文件</span></span><br><span class="line"><span class="comment"> * 使用HttpServletRequest作为参数</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> request</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@PostMapping(&quot;/uploads/requests&quot;)</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="keyword">public</span> Map&lt;String,Object&gt; <span class="title function_">uploadRequest</span><span class="params">(HttpServletRequest request)</span>&#123;</span><br><span class="line">    <span class="type">MultipartHttpServletRequest</span> <span class="variable">mreq</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">if</span>(request <span class="keyword">instanceof</span> MultipartHttpServletRequest)&#123;</span><br><span class="line">        mreq = (MultipartHttpServletRequest)request;</span><br><span class="line"></span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> dealResultMap(<span class="literal">false</span>,<span class="string">&quot;上传失败&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//获取MultipartFile信息</span></span><br><span class="line">    <span class="type">MultipartFile</span> <span class="variable">mf</span> <span class="operator">=</span> mreq.getFile(<span class="string">&quot;file&quot;</span>);</span><br><span class="line">    <span class="type">String</span> <span class="variable">filename</span> <span class="operator">=</span> mf.getOriginalFilename();</span><br><span class="line">    <span class="type">File</span> <span class="variable">file</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(filename);</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        mf.transferTo(file);</span><br><span class="line">    &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">        e.printStackTrace();;</span><br><span class="line">        <span class="keyword">return</span> dealResultMap(<span class="literal">false</span>,<span class="string">&quot;上传失败&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> dealResultMap(<span class="literal">true</span>,<span class="string">&quot;上传成功&quot;</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 使用MultipartFile作为参数</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> file</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@PostMapping(&quot;/uploads/multipart&quot;)</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="keyword">public</span> Map&lt;String,Object&gt; <span class="title function_">uplloadMultipartFile</span><span class="params">(MultipartFile file)</span>&#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">fileName</span> <span class="operator">=</span> file.getOriginalFilename();</span><br><span class="line">    <span class="type">File</span> <span class="variable">dest</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(fileName);</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        file.transferTo(dest);</span><br><span class="line">    &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">        <span class="keyword">return</span> dealResultMap(<span class="literal">false</span>,<span class="string">&quot;上传失败&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> dealResultMap(<span class="literal">true</span>,<span class="string">&quot;上传成功&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 使用Part作为参数</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> file</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@PostMapping(&quot;/uploads/part&quot;)</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="keyword">public</span> Map&lt;String,Object&gt; <span class="title function_">uploadPart</span><span class="params">(Part file)</span>&#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">fileName</span> <span class="operator">=</span> file.getSubmittedFileName();</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        file.write(fileName);</span><br><span class="line">    &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">        <span class="keyword">return</span> dealResultMap(<span class="literal">false</span>,<span class="string">&quot;上传失败&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> dealResultMap(<span class="literal">true</span>,<span class="string">&quot;上传成功&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 处理上传文件结果</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> success</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> msg</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> Map&lt;String,Object&gt; <span class="title function_">dealResultMap</span><span class="params">(<span class="type">boolean</span> success,String msg)</span>&#123;</span><br><span class="line">    Map&lt;String,Object&gt; result = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;String,Object&gt;();</span><br><span class="line">    result.put(<span class="string">&quot;success&quot;</span>,success);</span><br><span class="line">    result.put(<span class="string">&quot;msg&quot;</span>,msg);</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>

<blockquote>
<p>参数是HttpServletRequest对象时。在调用控制器之前，DispatcherSerrvlet会将其转换为iMultipartHttpServletRequest对象，所以方法中使用了强制转换。通过transferTo方法，就可以将文件保存到对应的路径中。</p>
</blockquote>

        <h2 id="定义多个拦截器">
          <a href="#定义多个拦截器" class="heading-link"><i class="fas fa-link"></i></a><a href="#定义多个拦截器" class="headerlink" title="定义多个拦截器"></a>定义多个拦截器</h2>
      <p><strong>1. 定义拦截器</strong></p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.rediscachetest.interceptor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.HandlerInterceptor;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.ModelAndView;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">selfInterceptor</span> <span class="keyword">implements</span> <span class="title class_">HandlerInterceptor</span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;处理前方法1&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">postHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, ModelAndView modelAndView)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;处理后方法1&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterCompletion</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;处理完成方法1&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>

<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.rediscachetest.interceptor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.HandlerInterceptor;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.ModelAndView;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">selfInteceptor2</span> <span class="keyword">implements</span> <span class="title class_">HandlerInterceptor</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;处理前方法2&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">postHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, ModelAndView modelAndView)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;处理后方法2&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterCompletion</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;处理完成方法2&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>

<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.rediscachetest.interceptor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.HandlerInterceptor;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.ModelAndView;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">selfInterceptor3</span> <span class="keyword">implements</span> <span class="title class_">HandlerInterceptor</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;处理前方法3&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">postHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, ModelAndView modelAndView)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;处理后方法3&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterCompletion</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;处理完成方法3&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>

<p><strong>2. 注册多个拦截器</strong></p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.rediscachetest;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.rediscachetest.interceptor.selfInteceptor2;</span><br><span class="line"><span class="keyword">import</span> com.example.rediscachetest.interceptor.selfInterceptor;</span><br><span class="line"><span class="keyword">import</span> com.example.rediscachetest.interceptor.selfInterceptor3;</span><br><span class="line"><span class="keyword">import</span> org.mybatis.spring.annotation.MapperScan;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Repository;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.InterceptorRegistration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.InterceptorRegistry;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.WebMvcConfigurer;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootApplication(scanBasePackages = &quot;com.example.rediscachetest&quot;)</span></span><br><span class="line"><span class="meta">@MapperScan(basePackages = &quot;com.example.rediscachetest.*&quot;,annotationClass = Repository.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RediscachetestApplication</span> <span class="keyword">implements</span> <span class="title class_">WebMvcConfigurer</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(RediscachetestApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addInterceptors</span><span class="params">(InterceptorRegistry registry)</span>&#123;</span><br><span class="line">        <span class="type">InterceptorRegistration</span> <span class="variable">ir</span> <span class="operator">=</span> registry.addInterceptor(<span class="keyword">new</span> <span class="title class_">selfInterceptor</span>());</span><br><span class="line">        ir.addPathPatterns(<span class="string">&quot;/interceptor/*&quot;</span>);</span><br><span class="line">        <span class="type">InterceptorRegistration</span> <span class="variable">ir1</span> <span class="operator">=</span> registry.addInterceptor(<span class="keyword">new</span> <span class="title class_">selfInteceptor2</span>());</span><br><span class="line">        ir1.addPathPatterns(<span class="string">&quot;/interceptor/*&quot;</span>);</span><br><span class="line">        <span class="type">InterceptorRegistration</span> <span class="variable">ir2</span> <span class="operator">=</span> registry.addInterceptor(<span class="keyword">new</span> <span class="title class_">selfInterceptor3</span>());</span><br><span class="line">        ir2.addPathPatterns(<span class="string">&quot;/interceptor/*&quot;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>

<blockquote>
<p>这些拦截器都会拦截与“&#x2F;interceptor&#x2F;*”匹配的请求。</p>
</blockquote>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.rediscachetest.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/interceptor&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">intercepController</span> &#123;</span><br><span class="line">    <span class="meta">@GetMapping(&quot;/reqPage&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">reqPages</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;/user/add&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>

<p>那么访问控制器后执行的结果是责任链模式的规则，对于处理器前方法采用先注册先执行，而处理器后方法和完成方法则是先注册后执行的规则。</p>
<p>上述只是测试的处理签方法返回为true的情况。如果将第二个注册的拦截器的处理前方法返回为false，则后续的拦截器，处理和所有拦截器的处理后方法都不会执行。完成方法afterCompletion则不一样，它知会执行返回true的拦截器的完成方法。而且顺序是先注册后执行</p>

        <h2 id="重定向">
          <a href="#重定向" class="heading-link"><i class="fas fa-link"></i></a><a href="#重定向" class="headerlink" title="重定向"></a>重定向</h2>
      <p><strong>控制器方法</strong></p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//显示用户</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/show&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">showUser</span><span class="params">(Long id,Model model)</span>&#123;</span><br><span class="line">	<span class="type">ServerUser</span> <span class="variable">user</span> <span class="operator">=</span> uServ.getServerUser(id);</span><br><span class="line">	model.addAttribute(<span class="string">&quot;user&quot;</span>,user);</span><br><span class="line">	<span class="keyword">return</span> <span class="string">&quot;user/detail&quot;</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@GetMapping(&quot;/redirect1&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">redirect1</span><span class="params">(String name,String remark)</span>&#123;</span><br><span class="line">    <span class="type">ServerUser</span> <span class="variable">sUser</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ServerUser</span>();</span><br><span class="line">    sUser.setName(name);</span><br><span class="line">    sUser.setRemark(remark);</span><br><span class="line">    <span class="comment">//插入数据库后，回填ServerUser的Id</span></span><br><span class="line">    uServ.insertServerUser(sUser);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;redirect:/models/show?id=&quot;</span>+sUser.getId();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<blockquote>
<p>首先，添加用户信息进入到<strong>redirect1</strong>的方法中，新增用户数据库会返回用户编号，然后通过以”redirect:”开头的字符串。并以id作为参数传递，这样就能够调用这个请求，跳转到展示用户的界面</p>
</blockquote>
<p><strong>如果采用数据模型重定向</strong></p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/redirect2&quot;)</span></span><br><span class="line"><span class="keyword">public</span> ModelAndView <span class="title function_">redirect2</span><span class="params">(String name,String remark)</span>&#123;</span><br><span class="line">    <span class="type">ServerUser</span> <span class="variable">sUser</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ServerUser</span>();</span><br><span class="line">    sUser.setName(name);</span><br><span class="line">    sUser.setRemark(remark);</span><br><span class="line">    <span class="comment">//插入数据库后，回填ServerUser的Id</span></span><br><span class="line">    uServ.insertServerUser(sUser);</span><br><span class="line">	<span class="type">ModelAndView</span> <span class="variable">mv</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ModelAndView</span>();</span><br><span class="line">	mv.setViewName(<span class="string">&quot;redirect:/models/show?id=&quot;</span>+sUser.getId());</span><br><span class="line">    <span class="keyword">return</span> mv;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<p><strong>重定向传递Java对象</strong></p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//显示用户</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/show&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">showUser</span><span class="params">(ServerUser user,Model model)</span>&#123;</span><br><span class="line">	model.addAttribute(<span class="string">&quot;user&quot;</span>,user);</span><br><span class="line">	<span class="keyword">return</span> <span class="string">&quot;user/detail&quot;</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@GetMapping(&quot;/redirect1&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">redirect1</span><span class="params">(String name,String remark,RedirectAttributes ra)</span>&#123;</span><br><span class="line">    <span class="type">ServerUser</span> <span class="variable">sUser</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ServerUser</span>();</span><br><span class="line">    sUser.setName(name);</span><br><span class="line">    sUser.setRemark(remark);</span><br><span class="line">    <span class="comment">//插入数据库后，回填ServerUser的Id</span></span><br><span class="line">    uServ.insertServerUser(sUser);</span><br><span class="line">	ra.addFlashAttribute(<span class="string">&quot;user&quot;</span>,user);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;redirect:/models/show&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>


        <h2 id="操作会话对象">
          <a href="#操作会话对象" class="heading-link"><i class="fas fa-link"></i></a><a href="#操作会话对象" class="headerlink" title="操作会话对象"></a>操作会话对象</h2>
      <p>SpringMVC提供了支持，主要是两个注解用来操作HttpSession对象。**@SessionAttribute和@SessionAttributes<strong>。前者应用于参数，主要是读取HttpSession得属性，后者只能用于类得注解，它会将相关</strong>数据模型**得属性保存到Session中。</p>
<p><strong>控制器</strong></p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.rediscachetest.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.rediscachetest.pojo.ServerUser;</span><br><span class="line"><span class="keyword">import</span> com.example.rediscachetest.serviceImpl.userServiceImpl;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.*;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.ModelAndView;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SessionAttributes(names = &#123;&quot;users&quot;,&quot;ServerUser&quot;&#125;,types = Long.class)</span></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/session&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">intercepController</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">userServiceImpl</span> <span class="variable">userService</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="meta">@GetMapping(&quot;/test&quot;)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> ModelAndView <span class="title function_">reqPages</span><span class="params">(<span class="meta">@SessionAttribute</span> (<span class="string">&quot;id&quot;</span>)</span> Long id)&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;session取出值Id:&quot;</span>+id);</span><br><span class="line">        <span class="type">ServerUser</span> <span class="variable">user</span> <span class="operator">=</span> userService.getServerUser(id);</span><br><span class="line">        <span class="type">ModelAndView</span> <span class="variable">mav</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ModelAndView</span>();</span><br><span class="line">        mav.addObject(<span class="string">&quot;id_new&quot;</span>,id);</span><br><span class="line">        mav.addObject(<span class="string">&quot;users&quot;</span>,user);</span><br><span class="line">        mav.setViewName(<span class="string">&quot;user/getsession&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> mav;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/sessionPage&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getSessPage</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;user/session&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>

<blockquote>
<p>SessionAttributes注解中得names属性表示数据模型中名称为users或者SessionAttributes会被保存在HttpSession中，types属性表示Long类型得数据模型会被保存在HttpSession中。它们是或者得关系。</p>
</blockquote>
<p><strong>存储Session数据得JSP和读取Session数据得JSP</strong></p>
<figure class="highlight jsp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page pageEncoding=<span class="string">&quot;utf-8&quot;</span>%&gt;</span><br><span class="line">&lt;%@ taglib prefix=<span class="string">&quot;c&quot;</span> uri=<span class="string">&quot;http://java.sun.com/jsp/jstl/core&quot;</span>%&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt;上传文件&lt;/title&gt;</span><br><span class="line">    &lt;<span class="type">script</span> <span class="variable">src</span> <span class="operator">=</span> <span class="string">&quot;https://code.jquery.com/jquery-3.0.0.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line"></span><br><span class="line">&lt;h1&gt;</span><br><span class="line">    &lt;% session.setAttribute(<span class="string">&quot;id&quot;</span>,<span class="number">13</span>);</span><br><span class="line">       response.sendRedirect(<span class="string">&quot;./test&quot;</span>);</span><br><span class="line">    %&gt;</span><br><span class="line">&lt;/h1&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></div></figure>


<figure class="highlight jsp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;com.example.rediscachetest.pojo.ServerUser&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page pageEncoding=<span class="string">&quot;utf-8&quot;</span>%&gt;</span><br><span class="line">&lt;%@ taglib prefix=<span class="string">&quot;c&quot;</span> uri=<span class="string">&quot;http://java.sun.com/jsp/jstl/core&quot;</span>%&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt;用户详情&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;%</span><br><span class="line">    <span class="type">ServerUser</span> <span class="variable">user</span> <span class="operator">=</span> (ServerUser)session.getAttribute(<span class="string">&quot;users&quot;</span>);</span><br><span class="line">    <span class="type">Long</span> <span class="variable">id</span> <span class="operator">=</span> (Long)session.getAttribute(<span class="string">&quot;id_new&quot;</span>);</span><br><span class="line">    out.print(user.getName());</span><br><span class="line">    out.print(id);</span><br><span class="line"></span><br><span class="line">%&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></div></figure>


        <h2 id="获取请求头信息">
          <a href="#获取请求头信息" class="heading-link"><i class="fas fa-link"></i></a><a href="#获取请求头信息" class="headerlink" title="获取请求头信息"></a>获取请求头信息</h2>
      <p><strong>1. JSP</strong></p>
<figure class="highlight jsp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page pageEncoding=<span class="string">&quot;utf-8&quot;</span>%&gt;</span><br><span class="line">&lt;%@ taglib prefix=<span class="string">&quot;c&quot;</span> uri=<span class="string">&quot;http://java.sun.com/jsp/jstl/core&quot;</span>%&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt;上传文件&lt;/title&gt;</span><br><span class="line">    &lt;<span class="type">script</span> <span class="variable">src</span> <span class="operator">=</span> <span class="string">&quot;https://code.jquery.com/jquery-3.0.0.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line"></span><br><span class="line">&lt;h1&gt;</span><br><span class="line">    &lt;% System.out.println(<span class="string">&quot;视图渲染&quot;</span>);%&gt;</span><br><span class="line">&lt;/h1&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;script type=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><br><span class="line">    $.post(&#123;</span><br><span class="line">        url:<span class="string">&quot;./userHeader&quot;</span>,</span><br><span class="line">        headers:&#123;id:<span class="string">&#x27;13&#x27;</span>,iname:<span class="string">&#x27;genji&#x27;</span>&#125;,</span><br><span class="line"></span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></div></figure>


<p><strong>2. Controller</strong></p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping(&quot;/userHeader&quot;)</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="keyword">public</span> ServerUser <span class="title function_">headerServerUser</span><span class="params">(<span class="meta">@RequestHeader(&quot;id&quot;)</span> Long id,<span class="meta">@RequestHeader(&quot;iname&quot;)</span> String iname)</span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;请求头Id：&quot;</span>+id);</span><br><span class="line">    System.out.println(<span class="string">&quot;请求头名称：&quot;</span>+iname);</span><br><span class="line">    <span class="type">ServerUser</span> <span class="variable">serverUser</span> <span class="operator">=</span> userService.getServerUser(id);</span><br><span class="line">    <span class="keyword">return</span> serverUser;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@GetMapping(&quot;/accessHeader&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">accHeader</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;user/intercec&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>

<blockquote>
<p>使用**@RequestHeader**注解获取请求头中的信息。注意控制器是@PostMapping</p>
</blockquote>
</div></div></article><article class="postlist-item post"><header class="post-header"><h1 class="post-title"><a class="post-title__link" href="/2020/05/19/Redis/">Redis</a></h1><div class="post-meta"><span class="post-meta-item post-meta-item--createtime"><span class="post-meta-item__icon"><i class="far fa-calendar-plus"></i></span><span class="post-meta-item__info">Created</span><span class="post-meta-item__value">2020-05-19</span></span><span class="post-meta-item post-meta-item--updatetime"><span class="post-meta-item__icon"><i class="far fa-calendar-check"></i></span><span class="post-meta-item__info">Updated</span><span class="post-meta-item__value">2022-05-21</span></span></div></header><div class="post-body"><div class="post-excerpt"><ul>
<li>
        <h1 id="Redis基础数据类型">
          <a href="#Redis基础数据类型" class="heading-link"><i class="fas fa-link"></i></a><a href="#Redis基础数据类型" class="headerlink" title="Redis基础数据类型"></a>Redis基础数据类型</h1>
      </li>
</ul>
<p><strong>1. String(字符串)</strong></p>
<p>String是Redis最基本的类型，一个key对应一个value。String类型是二进制安全的，意思是string可以包含任何数据，比如jpg图片或者序列化的对象。</p>
<hr>
<ul>
<li><p>设置指定key的值</p>
<p>  <code>SET key value</code></p>
</li>
<li><p>获取指定key的值</p>
<p>  <code>GET key</code></p>
</li>
<li><p>将给定 key 的值设为 value ，并返回 key 的旧值(old value)。</p>
<p>  <code>GETSET key value</code></p>
</li>
<li><p>同时设置一个或多个 key-value 对<br>  <code>MSET K1 V1 K2 V2 K3 V3</code></p>
</li>
</ul>
<p><strong>2. Hash(哈希)</strong></p>
<p>Redis hash 是一个键值对集合</p>
<hr>
<ul>
<li><p>同时将多个 field-value (域-值)对设置到哈希表 key 中</p>
<p>  <code>HMSET key field1 value1 field2 value2</code></p>
</li>
<li><p>获取所有给定字段的值</p>
<p>  <code>HMGET key field1 field2</code></p>
</li>
<li><p>获取所有哈希表中的字段</p>
<p>  <code>HKEYS key</code></p>
</li>
<li><p>删除一个或多个哈希表字段</p>
<p>  <code>HDEL key field1 field2</code>    </p>
</li>
<li><p>查看哈希表 key 中，指定的字段是否存在。</p>
<p>  <code>HEXISTS key field</code></p>
</li>
<li><p>获取存储在哈希表中指定字段的值。</p>
<p>  <code>HGET key field</code></p>
</li>
</ul>
<p><strong>3. List(列表)</strong></p>
<p>Redis列表是简单的字符串列表，按照插入顺序排序。可以添加一个元素到列表的头部或者尾部</p>
<hr>
<ul>
<li><p>将一个值或者多个值插入到列表头部</p>
<p>  <code>LPUSH key value1 value2</code></p>
</li>
<li><p>获取列表指定范围的元素</p>
<p>  <code>LRANGE key start stop</code></p>
</li>
<li><p>从列表中弹出一个值，将弹出的元素插入到另外一个列表中并返回它； 如果列表没有元素会阻塞列表直到等待超时或发现可弹出元素为止。</p>
<p>  <code>BRPOPLPUSH source destination timeout</code></p>
</li>
<li><p>通过索引获取列表中的元素</p>
<p>  <code>LINDEX key index</code></p>
</li>
<li><p>在列表的元素前或者后插入元素</p>
<p>  <code>LINSERT key BEFORE|AFTER pivot value</code></p>
</li>
<li><p>移出并获取列表的第一个元素</p>
<p>  <code>LPOP key</code></p>
</li>
<li><p>获取列表长度</p>
<p>  <code>LLEN key</code></p>
</li>
<li><p>将一个值插入到已存在的列表头部</p>
<p>  <code>LPUSHX key value</code></p>
</li>
<li><p>移除列表元素</p>
<p>  <code>LREM key count value</code></p>
</li>
<li><p>通过索引设置列表元素的值</p>
<p>  <code>LSET key index value</code></p>
</li>
<li><p>对一个列表进行修剪(trim)，就是说，让列表只保留指定区间内的元素，不在指定区间之内的元素都将被删除。</p>
<p>  <code>LTRIM key start stop</code></p>
</li>
<li><p>移除列表的最后一个元素，返回值为移除的元素。</p>
<p>  <code>RPOP key</code></p>
</li>
<li><p>移除列表的最后一个元素，并将该元素添加到另一个列表并返回</p>
<p>  <code>RPOPLPUSH source destination</code></p>
</li>
<li><p>在列表中添加一个或多个值</p>
<p>  <code>RPUSH key value1 value2</code></p>
</li>
<li><p>为已存在的列表添加值</p>
<p>  <code>RPUSHX key value</code></p>
</li>
</ul>
<p><strong>4. Set(集合)</strong></p>
<p>Redis的Set是string类型的无序集合。</p>
<hr>
<ul>
<li><p>向集合里添加一个或者多个成员</p>
<p>  <code>SADD key member1 member2</code></p>
</li>
<li><p>获取集合的成员数</p>
<p>  <code>SCARD key</code></p>
</li>
<li><p>返回给定所有集合的差集</p>
<p>  <code>SDIFF key1 key2</code></p>
</li>
<li><p>返回给定所有集合的差集并存储在 destination 中</p>
<p>  <code>SDIFFSTORE destination key1 key2</code></p>
</li>
<li><p>返回给定所有集合的交集</p>
<p>  <code>SINTER key1 key2</code></p>
</li>
<li><p>返回给定所有集合的交集并存储在 destination 中</p>
<p>  <code>SINTERSTORE destination key1 key2</code></p>
</li>
<li><p>判断 member 元素是否是集合 key 的成员</p>
<p>  <code>SISMEMBER key member</code></p>
</li>
<li><p>返回集合中的所有成员</p>
<p>  <code>SMEMBERS key</code></p>
</li>
<li><p>将 member 元素从 source 集合移动到 destination 集合</p>
<p>  <code>SMOVE source destination member</code></p>
</li>
<li><p>移除集合中一个或多个成员</p>
<p>  <code>SREM key member1 member2</code></p>
</li>
<li><p>返回所有给定集合的并集</p>
<p>  <code>SUNION key1 key2</code></p>
</li>
<li><p>所有给定集合的并集存储在 destination 集合中</p>
<p>  <code>SUNIONSTORE destination key1 key2</code></p>
</li>
</ul>
<p><strong>5. Zset(有序集合)</strong></p>
<p>Redis的ZSet是string类型的无序集合。</p>
<hr>
<ul>
<li><p>向有序集合添加一个或多个成员，或者更新已存在成员的分数</p>
<p>  <code>ZADD key score1 member1 score2 member2</code></p>
</li>
<li><p>获取有序集合的成员数</p>
<p>  <code>ZCARD key</code></p>
</li>
<li><p>通过索引区间返回有序集合指定区间内的成员</p>
<p>  <code>ZRANGE key start stop WITHSCORES</code></p>
</li>
<li><p>返回有序集合中指定成员的索引</p>
<p>  <code>ZRANK key member</code></p>
</li>
<li><p>移除有序集合中的一个或多个成员</p>
<p>  <code>ZREM key member member ...</code></p>
</li>
</ul>

        <h1 id="Spring-data-redis">
          <a href="#Spring-data-redis" class="heading-link"><i class="fas fa-link"></i></a><a href="#Spring-data-redis" class="headerlink" title="Spring-data-redis"></a>Spring-data-redis</h1>
      
        <h3 id="SpringBoot使用Redis">
          <a href="#SpringBoot使用Redis" class="heading-link"><i class="fas fa-link"></i></a><a href="#SpringBoot使用Redis" class="headerlink" title="SpringBoot使用Redis"></a>SpringBoot使用Redis</h3>
      <ol>
<li>引入spring-boot-starter-data-redis</li>
</ol>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">	&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">	&lt;artifactId&gt;spring-boot-starter-data-redis&lt;/artifactId&gt;</span><br><span class="line">	&lt;exclusions&gt;</span><br><span class="line">		&lt;exclusion&gt;</span><br><span class="line">			&lt;groupId&gt;io.lettuce&lt;/groupId&gt;</span><br><span class="line">			&lt;artifactId&gt;lettuce-core&lt;/artifactId&gt;</span><br><span class="line">		&lt;/exclusion&gt;</span><br><span class="line"></span><br><span class="line">	&lt;/exclusions&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">	&lt;groupId&gt;redis.clients&lt;/groupId&gt;</span><br><span class="line">	&lt;artifactId&gt;jedis&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></div></figure>

<ol start="2">
<li>创建RedisConnectionFactory对象，创建RedisTemplate</li>
</ol>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.sqldata.tools;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.connection.RedisConnectionFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.connection.RedisStandaloneConfiguration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.connection.jedis.JedisConnectionFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.core.RedisTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.serializer.RedisSerializer;</span><br><span class="line"><span class="keyword">import</span> redis.clients.jedis.JedisPoolConfig;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">redisConfig</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">RedisConnectionFactory</span> <span class="variable">connectionFactory</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="meta">@Bean(name = &quot;RedisConnectionFactory&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> RedisConnectionFactory <span class="title function_">initRedisConnectionFactory</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">this</span>.connectionFactory!=<span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>.connectionFactory;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">JedisPoolConfig</span> <span class="variable">jedisPoolConfig</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JedisPoolConfig</span>();</span><br><span class="line">         <span class="comment">//最大空闲数</span></span><br><span class="line">        jedisPoolConfig.setMaxIdle(<span class="number">30</span>);</span><br><span class="line">        <span class="comment">//最大连接数</span></span><br><span class="line">        jedisPoolConfig.setMaxTotal(<span class="number">50</span>);</span><br><span class="line">        <span class="comment">//最大等待毫秒数</span></span><br><span class="line">        jedisPoolConfig.setMaxWaitMillis(<span class="number">2000</span>);</span><br><span class="line">        <span class="comment">//创建Jedis连接工厂</span></span><br><span class="line">        <span class="type">JedisConnectionFactory</span> <span class="variable">jedisConnectionFactory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JedisConnectionFactory</span>(jedisPoolConfig);</span><br><span class="line">        <span class="comment">//获取单机的reidis配置</span></span><br><span class="line">        <span class="type">RedisStandaloneConfiguration</span> <span class="variable">rsConf</span> <span class="operator">=</span> jedisConnectionFactory.getStandaloneConfiguration();</span><br><span class="line">        rsConf.setHostName(<span class="string">&quot;127.0.0.1&quot;</span>);</span><br><span class="line">        rsConf.setPort(<span class="number">6379</span>);</span><br><span class="line">        rsConf.setPassword(<span class="string">&quot;123456&quot;</span>);</span><br><span class="line">        <span class="built_in">this</span>.connectionFactory =jedisConnectionFactory;</span><br><span class="line">        <span class="keyword">return</span> connectionFactory;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Bean(name = &quot;redisTemplate&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> RedisTemplate&lt;Object,Object&gt; <span class="title function_">initRedisTemplate</span><span class="params">()</span>&#123;</span><br><span class="line"></span><br><span class="line">        RedisTemplate&lt;Object,Object&gt; redisTemplate = <span class="keyword">new</span> <span class="title class_">RedisTemplate</span>&lt;&gt;();</span><br><span class="line">        <span class="type">RedisSerializer</span> <span class="variable">stringRedisSerializer</span> <span class="operator">=</span> redisTemplate.getStringSerializer();</span><br><span class="line">        <span class="comment">//设置字符串序列化器，这样Spring就会把key值当做字符串处理了</span></span><br><span class="line">        redisTemplate.setKeySerializer(stringRedisSerializer);</span><br><span class="line">        redisTemplate.setHashKeySerializer(stringRedisSerializer);</span><br><span class="line">        redisTemplate.setHashValueSerializer(stringRedisSerializer);</span><br><span class="line">        redisTemplate.setValueSerializer(stringRedisSerializer);</span><br><span class="line">        redisTemplate.setConnectionFactory(initRedisConnectionFactory());</span><br><span class="line">        <span class="keyword">return</span> redisTemplate;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>

<ol start="3">
<li>执行测试</li>
</ol>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.sqldata.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.sqldata.tools.redisConfig;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.ApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.AnnotationConfigApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.core.RedisTemplate;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">maintest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">ApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AnnotationConfigApplicationContext</span>(redisConfig.class);</span><br><span class="line">        <span class="type">RedisTemplate</span> <span class="variable">redisTemplate</span> <span class="operator">=</span> (RedisTemplate)context.getBean(<span class="string">&quot;redisTemplate&quot;</span>);</span><br><span class="line">        redisTemplate.opsForValue().set(<span class="string">&quot;keyTes&quot;</span>,<span class="string">&quot;valTes&quot;</span>);</span><br><span class="line">        redisTemplate.opsForHash().put(<span class="string">&quot;hash&quot;</span>,<span class="string">&quot;field&quot;</span>,<span class="string">&quot;hvalue&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>


        <h1 id="Spring-Boot中整合使用Redis">
          <a href="#Spring-Boot中整合使用Redis" class="heading-link"><i class="fas fa-link"></i></a><a href="#Spring-Boot中整合使用Redis" class="headerlink" title="Spring Boot中整合使用Redis"></a>Spring Boot中整合使用Redis</h1>
      <ol>
<li>applicationContext.yml配置信息</li>
</ol>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">spring:</span><br><span class="line">  redis:</span><br><span class="line">    jedis:</span><br><span class="line">      pool:</span><br><span class="line">        min-idle: <span class="number">5</span></span><br><span class="line">        max-active: <span class="number">10</span></span><br><span class="line">        max-idle: <span class="number">10</span></span><br><span class="line">        max-wait: <span class="number">2000</span></span><br><span class="line">    port: <span class="number">6379</span></span><br><span class="line">    host: <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span></span><br><span class="line">    password: <span class="number">123456</span></span><br><span class="line">    timeout: <span class="number">1000</span></span><br><span class="line"></span><br></pre></td></tr></table></div></figure>

<ol start="2">
<li>修改Redis Template的序列化器</li>
</ol>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Demo class</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> jcx</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/04/10</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">package</span> com.example.sqldata;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.sqldata.dao.userDao;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSessionFactory;</span><br><span class="line"><span class="keyword">import</span> org.mybatis.spring.annotation.MapperScan;</span><br><span class="line"><span class="keyword">import</span> org.mybatis.spring.mapper.MapperFactoryBean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.core.RedisTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.serializer.RedisSerializer;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Repository;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SqldataApplication</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">RedisTemplate</span> <span class="variable">redisTemplate</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//定义自定义后初始化方法</span></span><br><span class="line">	<span class="meta">@PostConstruct</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span>&#123;</span><br><span class="line"></span><br><span class="line">        initRedisTemplate();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">initRedisTemplate</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">RedisSerializer</span> <span class="variable">stringSerializer</span> <span class="operator">=</span> redisTemplate.getStringSerializer();</span><br><span class="line">        redisTemplate.setKeySerializer(stringSerializer);</span><br><span class="line">        redisTemplate.setHashKeySerializer(stringSerializer);</span><br><span class="line">        redisTemplate.setHashValueSerializer(stringSerializer);</span><br><span class="line">        redisTemplate.setValueSerializer(stringSerializer);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(SqldataApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>


        <h1 id="Redis事务">
          <a href="#Redis事务" class="heading-link"><i class="fas fa-link"></i></a><a href="#Redis事务" class="headerlink" title="Redis事务"></a>Redis事务</h1>
      <p><strong>Redis是支持一定事务能力的NoSQL，在Redis中使用事务，通常的命令组合是watch..multi..exec.也就是在一个Redis连接中执行多个命令，可以使用SessionCallBack接口达到这个目的</strong></p>
<ul>
<li><p>watch： 监控Redis的键</p>
</li>
<li><p>multi : 开启事务，开启事务后，该客户端的命令不会马上被执行，而是放在一个队列里，所以此时我们执行一些返回的命令，Redis是不会马上执行的，得到的值为null</p>
</li>
<li><p>exec : 执行事务。在队列命令执行前会判断被watch监控的Redis的键的数据是否发生过变化。如果是，Redis就会取消事务，否则就会执行事务。</p>
</li>
</ul>

        <h1 id="常见问题-x2F-错误">
          <a href="#常见问题-x2F-错误" class="heading-link"><i class="fas fa-link"></i></a><a href="#常见问题-x2F-错误" class="headerlink" title="常见问题&#x2F;错误"></a>常见问题&#x2F;错误</h1>
      <p>当对Redis进行操作时出现以下错误。表示设置了认证密码。此时验证密码即可。</p>
<p><img src="/2020/05/19/Redis/QQ%E6%88%AA%E5%9B%BE20200519142127.png"></p>
<p>密码认证</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">auth 123456</span><br></pre></td></tr></table></div></figure></div></div></article><article class="postlist-item post"><header class="post-header"><h1 class="post-title"><a class="post-title__link" href="/2020/05/19/%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95/">排序算法</a></h1><div class="post-meta"><span class="post-meta-item post-meta-item--createtime"><span class="post-meta-item__icon"><i class="far fa-calendar-plus"></i></span><span class="post-meta-item__info">Created</span><span class="post-meta-item__value">2020-05-19</span></span><span class="post-meta-item post-meta-item--updatetime"><span class="post-meta-item__icon"><i class="far fa-calendar-check"></i></span><span class="post-meta-item__info">Updated</span><span class="post-meta-item__value">2022-05-21</span></span></div></header><div class="post-body"><div class="post-excerpt">
        <h2 id="算法">
          <a href="#算法" class="heading-link"><i class="fas fa-link"></i></a><a href="#算法" class="headerlink" title="算法"></a>算法</h2>
      
        <h3 id="希尔排序">
          <a href="#希尔排序" class="heading-link"><i class="fas fa-link"></i></a><a href="#希尔排序" class="headerlink" title="希尔排序"></a>希尔排序</h3>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span>&#123;</span><br><span class="line">    <span class="type">int</span>[] arrs = <span class="keyword">new</span> <span class="title class_">int</span>[]&#123;<span class="number">5</span>，<span class="number">2</span>，<span class="number">7</span>，<span class="number">6</span>，<span class="number">4</span>，<span class="number">1</span>，<span class="number">3</span>&#125;;</span><br><span class="line">    algoTest.shellself(arrs);</span><br><span class="line">    System.out.println(<span class="string">&quot;主函数结果:&quot;</span>+ Arrays.toString(arrs));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">shellSory</span><span class="params">(<span class="type">int</span>[] arr)</span>&#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">k</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">	</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">d</span> <span class="operator">=</span> arr.length;d&gt;<span class="number">0</span>;d/=<span class="number">2</span>)&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> d;i&lt;arr.length;i++)&#123;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> i-d;j&gt;=<span class="number">0</span>;j-=d)&#123;</span><br><span class="line">                <span class="keyword">if</span>(arr[j]&gt;arr[j+d])&#123;</span><br><span class="line">                    <span class="type">int</span> <span class="variable">temp</span> <span class="operator">=</span> arr[j];</span><br><span class="line">                    arr[j] = arr[j+d];</span><br><span class="line">                    arr[j+d] = temp ;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;第&quot;</span>+(k+<span class="number">1</span>)+<span class="string">&quot;次排序结果:&quot;</span>+Arrays.toString(arr));</span><br><span class="line">        k++;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<p>1： <strong>最外层For第一次循环</strong></p>
<p> (1) 第一次d的值为数组长度除以2，即3</p>
<p> (2) 故分组下标为:[0,3]    [1,4]    [2,5]    [3,6]共四组</p>
<p> (3) 当下标为3的数小于下标为0的数时，两者交替位置。</p>
<p> (4) 当下标为6的数小于下标为3，两者交替位置。又由条件“j&gt;&#x3D;0;j-&#x3D;d”[j的循环初始值为3，j-&#x3D;d为3-3&#x3D;0].故最里层循环会再执行一次下标组[0,3]的对比。</p>
<p><img src="/2020/05/19/%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95/one.png"></p>
<p>2： <strong>最外层for第二次循环</strong></p>
<p><img src="/2020/05/19/%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95/two.png"></p>

        <h3 id="选择排序">
          <a href="#选择排序" class="heading-link"><i class="fas fa-link"></i></a><a href="#选择排序" class="headerlink" title="选择排序"></a>选择排序</h3>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">selectsort</span><span class="params">(<span class="type">int</span>[] arrs)</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; arrs.length; i++)&#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">minIndex</span> <span class="operator">=</span> i;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> i+<span class="number">1</span>; j &lt; arrs.length; j++)&#123;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(arrs[j]&lt;arrs[minIndex])&#123;</span><br><span class="line">                minIndex = j;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(minIndex!=i)&#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">temp</span> <span class="operator">=</span> arrs[i];</span><br><span class="line">            arrs[i] = arrs[minIndex];</span><br><span class="line">            arrs[minIndex] = temp;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<p><img src="/2020/05/19/%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95/se-one.png"></p>

        <h3 id="归并排序">
          <a href="#归并排序" class="heading-link"><i class="fas fa-link"></i></a><a href="#归并排序" class="headerlink" title="归并排序"></a>归并排序</h3>
      <p><strong>两组有顺序的归并</strong></p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span>&#123;</span><br><span class="line">    <span class="type">int</span>[] testArr = <span class="keyword">new</span> <span class="title class_">int</span>[]&#123;<span class="number">1</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">7</span>,<span class="number">2</span>,<span class="number">4</span>,<span class="number">6</span>,<span class="number">8</span>&#125;;</span><br><span class="line">    System.out.println(<span class="string">&quot;执行前testArr:&quot;</span>+Arrays.toString(testArr));</span><br><span class="line">    algoTest.merge(testArr,<span class="number">0</span>,<span class="number">3</span>,<span class="number">7</span>);</span><br><span class="line">    System.out.println(<span class="string">&quot;执行后testArr:&quot;</span>+Arrays.toString(testArr));</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 归并排序</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> arrs  传入的数组</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> low   数组的起始位置。一般为0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> middle   数组两组有顺序排列的数字的分割点。一般为第一组最后一个数字的下标</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> high    数组结束位置。一般为最后一个数字的下标</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">merge</span><span class="params">(<span class="type">int</span>[] arrs,<span class="type">int</span> low,<span class="type">int</span> middle,<span class="type">int</span> high)</span>&#123;</span><br><span class="line">		</span><br><span class="line">	    <span class="type">int</span>[] tempArr = <span class="keyword">new</span> <span class="title class_">int</span>[high-low+<span class="number">1</span>];</span><br><span class="line">	    <span class="comment">//记录左边部分的下标</span></span><br><span class="line">	    <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> low;</span><br><span class="line">	    <span class="comment">//记录右边部分的下标</span></span><br><span class="line">	    <span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> middle + <span class="number">1</span>;</span><br><span class="line">	    <span class="comment">//记录临时数组的下标</span></span><br><span class="line">	    <span class="type">int</span> <span class="variable">index</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">	    <span class="keyword">while</span>(i&lt;=middle&amp;&amp;j&lt;=high)&#123;</span><br><span class="line">	        <span class="keyword">if</span>(arrs[i]&lt;arrs[j])&#123;</span><br><span class="line">	            tempArr[index] = arrs[i];</span><br><span class="line">	            i++;</span><br><span class="line">	            index++;</span><br><span class="line">	</span><br><span class="line">	        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">	            tempArr[index] = arrs[j];</span><br><span class="line">	            j++;</span><br><span class="line">	            index++;</span><br><span class="line">	        &#125;</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	    &#125;</span><br><span class="line">	    <span class="comment">/**</span></span><br><span class="line"><span class="comment">	     * 处理剩余数据</span></span><br><span class="line"><span class="comment">	     */</span></span><br><span class="line">	    <span class="comment">//上述循环结束后左半边部分还剩余</span></span><br><span class="line">	    <span class="keyword">while</span>(i&lt;=middle)&#123;</span><br><span class="line">	        tempArr[index] = arrs[i];</span><br><span class="line">	        i++;</span><br><span class="line">	        index++;</span><br><span class="line">	    &#125;</span><br><span class="line">	    <span class="comment">//第一个循环结束后右半边部分还剩余</span></span><br><span class="line">	    <span class="keyword">while</span> ((j&lt;=high))&#123;</span><br><span class="line">	        tempArr[index] = arrs[j];</span><br><span class="line">	        j++;</span><br><span class="line">	        index++;</span><br><span class="line">	    &#125;</span><br><span class="line">	    <span class="comment">//将临时数组的数据存入原数组</span></span><br><span class="line">	    <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">k</span> <span class="operator">=</span> <span class="number">0</span>;k&lt;tempArr.length;k++)&#123;</span><br><span class="line">	        arrs[k+low] = tempArr[k];</span><br><span class="line">	    &#125;</span><br><span class="line">	</span><br><span class="line">	&#125;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>

<p><strong>&gt; 流程</strong></p>
<ol>
<li>首先将数组分为1,2两个有顺序的数组</li>
</ol>
<p><img src="/2020/05/19/%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95/merge-one.png"></p>
<ol start="2">
<li>创建临时数组t。将1组和2组数据从开始下标i和j（<font color="red">i为1组初始下标，j为2组初始下标</font>）进行对比。若1组对应下标i的值小于2组对应下标j的值，则将1组对应下标i的值装入新数组t，并且1组的下标i往后移一位，2组下标j不变。反之，若2组下标j的值小于1组下标i的值，则2组下标j的值装入临时数组t，2组下标往后移一位。</li>
</ol>
<p><img src="/2020/05/19/%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95/merge-two.png"></p>
<ol start="3">
<li>当某一组的下标已经结束但是另一组还依然存在没有对比完的值时，直接将这一组剩下的数装入临时数组中。</li>
</ol>
<p><img src="/2020/05/19/%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95/merge-three.png"></p>
<p><strong>使用递归处理无序数组的归并</strong></p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span>&#123;</span><br><span class="line">    <span class="type">int</span>[] testArr = <span class="keyword">new</span> <span class="title class_">int</span>[]&#123;<span class="number">5</span>,<span class="number">4</span>,<span class="number">9</span>,<span class="number">1</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">2</span>,<span class="number">7</span>,<span class="number">9</span>,<span class="number">10</span>&#125;;</span><br><span class="line">    System.out.println(<span class="string">&quot;执行前testArr:&quot;</span>+Arrays.toString(testArr));</span><br><span class="line">    algoTest.mergeSort(testArr,<span class="number">0</span>,<span class="number">9</span>);</span><br><span class="line">    System.out.println(<span class="string">&quot;执行后testArr:&quot;</span>+Arrays.toString(testArr));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">mergeSort</span><span class="params">(<span class="type">int</span>[] arr,<span class="type">int</span> low, <span class="type">int</span> high)</span>&#123;</span><br><span class="line">	<span class="comment">//high的值最终会变为0，与low相等。此时high和low的下标同样，无法进行对比</span></span><br><span class="line">    <span class="keyword">if</span>(low&lt;high) &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">middle</span> <span class="operator">=</span> (low + high) / <span class="number">2</span>;</span><br><span class="line">        <span class="comment">//左边的处理</span></span><br><span class="line">        mergeSort(arr, low, middle);</span><br><span class="line">        <span class="comment">//右边的处理</span></span><br><span class="line">        mergeSort(arr, middle+<span class="number">1</span>, high);</span><br><span class="line">        <span class="comment">//归并</span></span><br><span class="line">        merge(arr, low, middle, high);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>





        <h3 id="基数排序">
          <a href="#基数排序" class="heading-link"><i class="fas fa-link"></i></a><a href="#基数排序" class="headerlink" title="基数排序"></a>基数排序</h3>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span>&#123;</span><br><span class="line">    <span class="type">int</span>[] testArr = <span class="keyword">new</span> <span class="title class_">int</span>[]&#123;<span class="number">10</span>,<span class="number">6</span>,<span class="number">52</span>,<span class="number">132</span>,<span class="number">679</span>,<span class="number">25</span>,<span class="number">13</span>,<span class="number">98</span>,<span class="number">4</span>,<span class="number">7</span>&#125;;</span><br><span class="line">    System.out.println(<span class="string">&quot;执行前testArr:&quot;</span>+Arrays.toString(testArr));</span><br><span class="line">    algoTest.radixSort(testArr);</span><br><span class="line">    System.out.println(<span class="string">&quot;执行后testArr:&quot;</span>+Arrays.toString(testArr));</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">radixSort</span><span class="params">(<span class="type">int</span>[] arrs)</span>&#123;</span><br><span class="line">    <span class="comment">//定义一个数用来存放数组中最大的数字</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">maxNum</span> <span class="operator">=</span> Integer.MIN_VALUE;</span><br><span class="line">    <span class="comment">//找出数组中最大的数字</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i&lt;arrs.length; i++)&#123;</span><br><span class="line">        <span class="keyword">if</span>(arrs[i]&gt;maxNum)&#123;</span><br><span class="line">            maxNum = arrs[i];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//计算出数组中最大数字的位数</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">times</span> <span class="operator">=</span> (maxNum+<span class="string">&quot;&quot;</span>).length();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//定义二维数组用来装入每位数的排序结果</span></span><br><span class="line"></span><br><span class="line">    <span class="type">int</span>[][] tempArrs = <span class="keyword">new</span> <span class="title class_">int</span>[<span class="number">10</span>][arrs.length];</span><br><span class="line"></span><br><span class="line">    <span class="comment">//定义数组用来记录二维数组中每个数组中存放值的数量</span></span><br><span class="line">    <span class="type">int</span>[] counts = <span class="keyword">new</span> <span class="title class_">int</span>[<span class="number">10</span>];</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 循环执行的次数依据数组中最大数字的位数</span></span><br><span class="line"><span class="comment">     * 第一次循环找到的是数组中每个数的个位</span></span><br><span class="line"><span class="comment">     * 第二次循环找到的是数组中每个数的十位</span></span><br><span class="line"><span class="comment">     * 以此类推</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>,n = <span class="number">1</span>; i&lt;times; i++,n*=<span class="number">10</span>)&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">k</span> <span class="operator">=</span> <span class="number">0</span>; k &lt;arrs.length; k++)&#123;</span><br><span class="line"></span><br><span class="line">            <span class="comment">//找到对应位数的数字</span></span><br><span class="line">            <span class="type">int</span> <span class="variable">sequenceNum</span> <span class="operator">=</span> arrs[k]/n%<span class="number">10</span>;</span><br><span class="line">            <span class="comment">//将此位数的数字存放在对应的二维数组中</span></span><br><span class="line">            tempArrs[sequenceNum][counts[sequenceNum]] = arrs[k];</span><br><span class="line">            <span class="comment">//当二维数组中某一个数组中已经添加了一个值，那么下标应该＋1</span></span><br><span class="line">            counts[sequenceNum]++;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//定义原数组下标</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">oIdx</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">l</span> <span class="operator">=</span> <span class="number">0</span>;l&lt;counts.length;l++)&#123;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(counts[l]!=<span class="number">0</span>)&#123;</span><br><span class="line">                <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">g</span> <span class="operator">=</span> <span class="number">0</span>; g&lt;counts[l];g++)&#123;</span><br><span class="line"></span><br><span class="line">                    arrs[oIdx] = tempArrs[l][g];</span><br><span class="line">                    oIdx++;</span><br><span class="line"></span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">//重置为0</span></span><br><span class="line">                counts[l] = <span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<p><strong>&gt; 流程</strong></p>
<ol>
<li>定义以下数组</li>
</ol>
<p><img src="/2020/05/19/%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95/radix-one.png"></p>
<ol start="2">
<li>可知最大数为679，位数为3.故一共需进行三次流程</li>
</ol>
<p><img src="/2020/05/19/%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95/radix-two.png"></p>

        <h3 id="堆排序">
          <a href="#堆排序" class="heading-link"><i class="fas fa-link"></i></a><a href="#堆排序" class="headerlink" title="堆排序"></a>堆排序</h3>
      <ul>
<li><p>升序排列使用大顶堆</p>
</li>
<li><p>降序排列使用小顶堆</p>
</li>
</ul>
<p><strong>1. 根据传入的节点将此节点所构成的树转换为大顶堆【maxHeap()】</strong></p>
<p><img src="/2020/05/19/%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95/heap-one.png"></p>
<p><strong>2. 将完全二叉树从最后一个叶子节点的父节开始从后往前遍历，到根节点停止。从而将整个二叉树转换为大顶堆</strong></p>
<p><img src="/2020/05/19/%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95/heap-two.png"></p>
<p><strong>3. 进行堆排序【heapAsc()】</strong></p>
<p> 将根节点和数组的最后一个元素替换位置后，将除了最后一个元素的数组从根节点重新转换为大顶堆；再次将根节点和数组的倒数第二个元素替换，将除了倒数第二个和其之后的数据的数组重新替换为大顶堆；以此递减。递减至根节点之前停止。</p>
<p>全过程:</p>
<p><img src="/2020/05/19/%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95/heap-three.png"></p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> algorithm;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">heapSort</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">int</span>[] arrs = <span class="keyword">new</span> <span class="title class_">int</span>[]&#123;<span class="number">9</span>,<span class="number">6</span>,<span class="number">8</span>,<span class="number">7</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">10</span>,<span class="number">4</span>,<span class="number">2</span>,<span class="number">11</span>,<span class="number">5</span>&#125;;</span><br><span class="line">        heapAsc(arrs);</span><br><span class="line">        <span class="comment">//打印最终结果</span></span><br><span class="line">        System.out.println(Arrays.toString(arrs));</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *  1. 先将整体数组转换为大顶堆</span></span><br><span class="line"><span class="comment">     *  2. 从根节点开始，将根节点的值放在数组最后一位，再从根节点开始将数组重新转换为</span></span><br><span class="line"><span class="comment">     *  大顶堆(判断的size的值要逐步减去一。即已经将根节点的值放入数组最后的下标不再计</span></span><br><span class="line"><span class="comment">     *  入大顶堆的转化中)。转换后将新获得的根节点的值存入倒数第二位。以此类推。</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> arrs 传入的数组</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">heapAsc</span><span class="params">(<span class="type">int</span>[] arrs)</span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//将数组转换为大顶堆</span></span><br><span class="line">        <span class="comment">//定义最后一个叶子节点的父节点</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">finalleafNodeFaIdx</span> <span class="operator">=</span> (arrs.length-<span class="number">2</span>)/<span class="number">2</span>;</span><br><span class="line">        <span class="comment">//从最后一个叶子节点的父节点开始向上遍历</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> finalleafNodeFaIdx;i&gt;=<span class="number">0</span>;i--)&#123;</span><br><span class="line">            maxHeap(arrs,arrs.length,i);</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//将根节点的值放在最后一位并向前递进</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> arrs.length-<span class="number">1</span>;i&gt;<span class="number">0</span>;i--)&#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">tempVal</span> <span class="operator">=</span> arrs[<span class="number">0</span>];</span><br><span class="line">            arrs[<span class="number">0</span>] = arrs[i];</span><br><span class="line">            arrs[i] = tempVal;</span><br><span class="line">            <span class="comment">//将第一位和最后一位交替后的数组从根节点开始重新转换为大顶堆</span></span><br><span class="line">            maxHeap(arrs,i,<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 大顶堆</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> arrs 传入的数组</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> size 代表数组的大小:arr.length</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> index  选定转换成大顶堆的节点</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span>  <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">maxHeap</span><span class="params">(<span class="type">int</span>[] arrs,<span class="type">int</span> size,<span class="type">int</span> index)</span>&#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">leftNodeIdx</span> <span class="operator">=</span> index*<span class="number">2</span>+<span class="number">1</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">rightNodeIdx</span> <span class="operator">=</span> index*<span class="number">2</span>+<span class="number">2</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">maxIdx</span> <span class="operator">=</span> index;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//比较左子节点和父节点</span></span><br><span class="line">        <span class="keyword">if</span>(leftNodeIdx&lt;size&amp;&amp;arrs[leftNodeIdx] &gt; arrs[maxIdx])&#123;</span><br><span class="line"></span><br><span class="line">            maxIdx = leftNodeIdx;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//比较右子节点 和 左子节点、父节点中最大的一个</span></span><br><span class="line">        <span class="keyword">if</span>(rightNodeIdx&lt;size&amp;&amp;arrs[rightNodeIdx] &gt; arrs[maxIdx])&#123;</span><br><span class="line"></span><br><span class="line">            maxIdx = rightNodeIdx;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(maxIdx!=index)&#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">temp</span> <span class="operator">=</span> arrs[index];</span><br><span class="line">            arrs[index] = arrs[maxIdx];</span><br><span class="line">            arrs[maxIdx] = temp;</span><br><span class="line">            maxHeap(arrs,size,maxIdx);</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure></div></div></article><article class="postlist-item post"><header class="post-header"><h1 class="post-title"><a class="post-title__link" href="/2020/04/04/%E6%9E%9A%E4%B8%BE/">枚举</a></h1><div class="post-meta"><span class="post-meta-item post-meta-item--createtime"><span class="post-meta-item__icon"><i class="far fa-calendar-plus"></i></span><span class="post-meta-item__info">Created</span><span class="post-meta-item__value">2020-04-04</span></span><span class="post-meta-item post-meta-item--updatetime"><span class="post-meta-item__icon"><i class="far fa-calendar-check"></i></span><span class="post-meta-item__info">Updated</span><span class="post-meta-item__value">2022-05-21</span></span></div></header><div class="post-body"><div class="post-excerpt">
        <h2 id="枚举的常见用法">
          <a href="#枚举的常见用法" class="heading-link"><i class="fas fa-link"></i></a><a href="#枚举的常见用法" class="headerlink" title="枚举的常见用法"></a>枚举的常见用法</h2>
      <ol>
<li><strong>定义常量</strong></li>
</ol>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.testdata.demodata.enumeration;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">enumTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">enumT</span>&#123;</span><br><span class="line">        red,orange,yellow,green</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>

<ol start="2">
<li><strong>switch语句</strong></li>
</ol>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="type">enumT</span> <span class="variable">e</span> <span class="operator">=</span> enumT.red;</span><br><span class="line">    <span class="keyword">switch</span> (e)&#123;</span><br><span class="line">        <span class="keyword">case</span> red:</span><br><span class="line">            System.out.println(enumT.red);</span><br><span class="line">            System.out.println(e);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<ol start="3">
<li>枚举中添加方法</li>
</ol>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.testdata.demodata.enumeration;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">enumTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">enumT</span>&#123;</span><br><span class="line">        red(<span class="number">0</span>,<span class="string">&quot;红色&quot;</span>),orange(<span class="number">1</span>,<span class="string">&quot;橘色&quot;</span>),yellow(<span class="number">2</span>,<span class="string">&quot;黄色&quot;</span>),green(<span class="number">3</span>,<span class="string">&quot;绿色&quot;</span>);</span><br><span class="line">        <span class="keyword">private</span> <span class="type">int</span> cid;</span><br><span class="line">        <span class="keyword">private</span> String cname;</span><br><span class="line">        enumT(<span class="type">int</span> cid,String cname)&#123;</span><br><span class="line">            <span class="built_in">this</span>.cid = cid;</span><br><span class="line">            <span class="built_in">this</span>.cname = cname;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//根据枚举id获取枚举</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> enumT <span class="title function_">getEnumT</span><span class="params">(<span class="type">int</span> id)</span>&#123;</span><br><span class="line">            <span class="keyword">for</span> (enumT e:enumT.values()</span><br><span class="line">                 ) &#123;</span><br><span class="line">                <span class="keyword">if</span>(e.getCid() == id)&#123;</span><br><span class="line">                    <span class="keyword">return</span> e;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getCid</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> cid;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setCid</span><span class="params">(<span class="type">int</span> cid)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.cid = cid;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> String <span class="title function_">getCname</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> cname;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setCname</span><span class="params">(String cname)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.cname = cname;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">        <span class="type">enumT</span> <span class="variable">t</span> <span class="operator">=</span> enumT.getEnumT(i);</span><br><span class="line">        System.out.println(t.getCname());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>

<p><strong>注:只有先定义了实例才能自定义构造函数及方法。且最后一个枚举要以分号结束</strong></p>
</div></div></article><article class="postlist-item post"><header class="post-header"><h1 class="post-title"><a class="post-title__link" href="/2020/03/29/%E9%81%87%E9%94%99%E8%A7%A3%E9%94%99/">遇错解错</a></h1><div class="post-meta"><span class="post-meta-item post-meta-item--createtime"><span class="post-meta-item__icon"><i class="far fa-calendar-plus"></i></span><span class="post-meta-item__info">Created</span><span class="post-meta-item__value">2020-03-29</span></span><span class="post-meta-item post-meta-item--updatetime"><span class="post-meta-item__icon"><i class="far fa-calendar-check"></i></span><span class="post-meta-item__info">Updated</span><span class="post-meta-item__value">2022-05-21</span></span></div></header><div class="post-body"><div class="post-excerpt">
        <h1 id="Mysql">
          <a href="#Mysql" class="heading-link"><i class="fas fa-link"></i></a><a href="#Mysql" class="headerlink" title="Mysql"></a>Mysql</h1>
      
        <h2 id="mysql8-0忘记密码的情况">
          <a href="#mysql8-0忘记密码的情况" class="heading-link"><i class="fas fa-link"></i></a><a href="#mysql8-0忘记密码的情况" class="headerlink" title="mysql8.0忘记密码的情况"></a>mysql8.0忘记密码的情况</h2>
      <p>参考地址:</p>
<p><span class="exturl"><a class="exturl__link" target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_42289383/article/details/98039313?depth_1-utm_source=distribute.pc_relevant.none-task&utm_source=distribute.pc_relevant.none-task">https://blog.csdn.net/weixin_42289383&#x2F;article&#x2F;details&#x2F;98039313?depth_1-utm_source&#x3D;distribute.pc_relevant.none-task&amp;utm_source&#x3D;distribute.pc_relevant.none-task</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>
<p><span class="exturl"><a class="exturl__link" target="_blank" rel="noopener" href="https://blog.csdn.net/qq_43116788/article/details/84146918">https://blog.csdn.net/qq_43116788&#x2F;article&#x2F;details&#x2F;84146918</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>
<ol>
<li><p><strong>当前版本 mysql8.0 的my.ini文件所在目录</strong>:[C:\ProgramData\MySQL\MySQL Server 8.0]</p>
</li>
<li><p>进入mysql的bin目录。命令<code>mysqld --console --skip-grant-tables --shared-memory</code>可以无密码进入mysql。</p>
</li>
<li><p>管理员身份进入mysql的命令：<code>mysql -u root -p</code></p>
</li>
<li><p>如果在mysql中找不到user表。那么可能是没切换到mysql数据库。mysql创建后默认带一个mysql数据库。<code>use mysql;</code></p>
</li>
<li><p>修改密码: <code>ALTER USER &#39;root&#39;@&#39;localhost&#39; IDENTIFIED WITH mysql_native_password BY &#39;你的密码&#39;;  </code></p>
</li>
<li><p>在<code>mysqld --console --skip-grant-tables --shared-memory</code>模式可能无法执行，解决方案见下方.</p>
</li>
<li><p>重新登录:<code>mysql -u root -p123456;</code></p>
</li>
</ol>

        <h2 id="The-MySQL-server-is-running-with-the-–skip-grant-tables-option-so-it-cannot-execute-this-statement">
          <a href="#The-MySQL-server-is-running-with-the-–skip-grant-tables-option-so-it-cannot-execute-this-statement" class="heading-link"><i class="fas fa-link"></i></a><a href="#The-MySQL-server-is-running-with-the-–skip-grant-tables-option-so-it-cannot-execute-this-statement" class="headerlink" title="The MySQL server is running with the –skip-grant-tables option so it cannot execute this statement"></a>The MySQL server is running with the –skip-grant-tables option so it cannot execute this statement</h2>
      <ol>
<li><p>表示MYSQL还运行在 –skip-grant-tables模式，无法执行。</p>
</li>
<li><p>解决：</p>
<p> mysql&gt; set global read_only&#x3D;0;<br> （关掉新主库的只读属性）</p>
<p> flush privileges;</p>
<p> set global read_only&#x3D;1;(读写属性)</p>
<p> flush privileges;</p>
</li>
</ol>

        <h2 id="使用NET-START-MYSQL命令时报错">
          <a href="#使用NET-START-MYSQL命令时报错" class="heading-link"><i class="fas fa-link"></i></a><a href="#使用NET-START-MYSQL命令时报错" class="headerlink" title="使用NET START MYSQL命令时报错"></a>使用NET START MYSQL命令时报错</h2>
      <p><strong>错误信息：</strong></p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">MYSQL服务正在启动...</span><br><span class="line">MYSQL服务无法启动...</span><br><span class="line">服务没有报任何错误</span><br></pre></td></tr></table></div></figure>

<ol>
<li>输入<code>mysqld - -console</code>查看错误详细信息</li>
</ol>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">C:\Windows\System32&gt;mysqld --console</span><br><span class="line">2020-04-04T06:53:36.084691Z 0 [System] [MY-010116] [Server] C:\Program Files\MySQL\MySQL Server 8.0\bin\mysqld.exe (mysqld 8.0.19) starting as process 6000</span><br><span class="line">2020-04-04T06:53:36.697581Z 0 [Warning] [MY-010068] [Server] CA certificate ca.pem is self signed.</span><br><span class="line">2020-04-04T06:53:36.704078Z 0 [ERROR] [MY-010262] [Server] Can&#x27;t start server: Bind on TCP/IP port: 通常每个套接字地址( 协议/网络地址/端口)只允许使用一次。</span><br></pre></td></tr></table></div></figure>

<p>由此可见mysql端口被占用</p>
<ol start="2">
<li>输入<code>netstat -aon|findstr &quot;3306&quot;</code>查看3306端口使用情况</li>
</ol>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">TCP    0.0.0.0:3306           0.0.0.0:0              LISTENING       21220</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>

<ol start="3">
<li>杀灭21220进程，重新启动</li>
</ol>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">taskkill/f /pid 21220</span><br></pre></td></tr></table></div></figure>

<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">NET START MYSQL</span><br></pre></td></tr></table></div></figure>

<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">C:\Windows\System32&gt;NET START MYSQL</span><br><span class="line">MySQL 服务正在启动 .</span><br><span class="line">MySQL 服务已经启动成功。</span><br></pre></td></tr></table></div></figure></div></div></article><article class="postlist-item post"><header class="post-header"><h1 class="post-title"><a class="post-title__link" href="/2020/03/29/Spring-Boot%E5%AD%A6%E4%B9%A0v3/">Spring-Boot学习v3</a></h1><div class="post-meta"><span class="post-meta-item post-meta-item--createtime"><span class="post-meta-item__icon"><i class="far fa-calendar-plus"></i></span><span class="post-meta-item__info">Created</span><span class="post-meta-item__value">2020-03-29</span></span><span class="post-meta-item post-meta-item--updatetime"><span class="post-meta-item__icon"><i class="far fa-calendar-check"></i></span><span class="post-meta-item__info">Updated</span><span class="post-meta-item__value">2022-05-21</span></span></div></header><div class="post-body"><div class="post-excerpt">
        <h1 id="访问数据库">
          <a href="#访问数据库" class="heading-link"><i class="fas fa-link"></i></a><a href="#访问数据库" class="headerlink" title="访问数据库"></a>访问数据库</h1>
      
        <h2 id="1-JdbcTemplate">
          <a href="#1-JdbcTemplate" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-JdbcTemplate" class="headerlink" title="1. JdbcTemplate"></a>1. JdbcTemplate</h2>
      <p>在依赖于SpringBoot的spring-boot&#x3D;starter-data&#x3D;jpa后。它就会自动配置数据源。但有时候我们需要配置自己的数据源.</p>

        <h3 id="1-1-配置自定义数据源">
          <a href="#1-1-配置自定义数据源" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-1-配置自定义数据源" class="headerlink" title="1.1 配置自定义数据源"></a>1.1 配置自定义数据源</h3>
      <p>- </p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-boot-starter-data-jpa&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-boot-starter-jdbc&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;mysql&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;</span><br><span class="line">    &lt;scope&gt;runtime&lt;/scope&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;</span><br><span class="line">    &lt;scope&gt;test&lt;/scope&gt;</span><br><span class="line">    &lt;exclusions&gt;</span><br><span class="line">        &lt;exclusion&gt;</span><br><span class="line">            &lt;groupId&gt;org.junit.vintage&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;junit-vintage-engine&lt;/artifactId&gt;</span><br><span class="line">        &lt;/exclusion&gt;</span><br><span class="line">    &lt;/exclusions&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>
<ul>
<li>application.properties&#x2F;application.yml配置数据源</li>
</ul>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">spring:</span><br><span class="line">  datasource:</span><br><span class="line">    url: jdbc:mysql:<span class="comment">//localhost:3306/users?useUnicode=true&amp;characterEncoding=utf-8&amp;useSSL=true&amp;serverTimezone=UTC</span></span><br><span class="line">    username: root</span><br><span class="line">    password: <span class="number">123456</span></span><br><span class="line">    tomcat: #tomcat自带的数据库连接池</span><br><span class="line">      max-idle: <span class="number">0</span>   #最大连接数，<span class="number">0</span>表示没有限制</span><br><span class="line">      max-active: <span class="number">50</span>  #最大连接活动数</span><br><span class="line">      max-wait: <span class="number">10000</span> #最大等待毫秒数，超出报错</span><br><span class="line">      initial-size: <span class="number">5</span> #数据库连接池初始化连接数</span><br><span class="line">    driver-class-name: com.mysql.cj.jdbc.Driver  #驱动类配置</span><br><span class="line">  jpa:</span><br><span class="line">    open-in-view: <span class="literal">false</span></span><br></pre></td></tr></table></div></figure>

<p><strong>注：使用springboot jpa，项目启动的时候有个warn的log：</strong></p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2019</span>-<span class="number">04</span>-<span class="number">03</span> <span class="number">14</span>:<span class="number">05</span>:<span class="number">59</span>: WARN [main] o.s.b.a.o.j.JpaBaseConfiguration$JpaWebConfiguration$JpaWebMvcConfiguration JpaBaseConfiguration.java:<span class="number">234</span> - spring.jpa.open-in-view is enabled by <span class="keyword">default</span>. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable <span class="built_in">this</span> warning</span><br></pre></td></tr></table></div></figure>
<p>在配置文件中加入下面这个：</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">spring.jpa.open-in-view=false</span><br></pre></td></tr></table></div></figure>
<p>原因具体可参考stackoverflow上的解答spring.jpa.open-in-view。</p>
<p><strong>关于配置完数据源启动后报错可能原因是url地址后需要加上：</strong></p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jdbc:mysql://localhost:3306/users?useUnicode=true&amp;characterEncoding=utf-8&amp;useSSL=true&amp;serverTimezone=UTC</span><br></pre></td></tr></table></div></figure>


        <h3 id="1-2-JdbcTemplate操作数据库">
          <a href="#1-2-JdbcTemplate操作数据库" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-2-JdbcTemplate操作数据库" class="headerlink" title="1.2 JdbcTemplate操作数据库"></a>1.2 JdbcTemplate操作数据库</h3>
      <ul>
<li><p>mysql创建数据库users,创建表</p>
</li>
<li><p>定义性别枚举</p>
</li>
</ul>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.testdata.demodata.enumeration;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">sexEnum</span> &#123;</span><br><span class="line">    MaleENUM(<span class="number">1</span>,<span class="string">&quot;男&quot;</span>),</span><br><span class="line">    FemaleEnum(<span class="number">2</span>,<span class="string">&quot;女&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    sexEnum(<span class="type">int</span> id,String name)&#123;</span><br><span class="line">        <span class="built_in">this</span>.id = id;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> sexEnum <span class="title function_">getSexEnum</span><span class="params">(<span class="type">int</span> id)</span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (sexEnum sexenum:sexEnum.values()</span><br><span class="line">             ) &#123;</span><br><span class="line">            <span class="keyword">if</span>(sexenum.getId() == id)&#123;</span><br><span class="line">                <span class="keyword">return</span> sexenum;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getId</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setId</span><span class="params">(<span class="type">int</span> id)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>

<ul>
<li>定义pojo类</li>
</ul>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.testdata.demodata.pojo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.testdata.demodata.enumeration.sexEnum;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">users</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">uId</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">String</span> <span class="variable">uName</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">String</span> <span class="variable">uAge</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">sexEnum</span> <span class="variable">uSex</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">String</span> <span class="variable">uPhone</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">String</span> <span class="variable">uRemark</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getuId</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> uId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setuId</span><span class="params">(<span class="type">int</span> uId)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.uId = uId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getuName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> uName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setuName</span><span class="params">(String uName)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.uName = uName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getuAge</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> uAge;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setuAge</span><span class="params">(String uAge)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.uAge = uAge;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> sexEnum <span class="title function_">getuSex</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> uSex;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setuSex</span><span class="params">(sexEnum uSex)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.uSex = uSex;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getuPhone</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> uPhone;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setuPhone</span><span class="params">(String uPhone)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.uPhone = uPhone;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getuRemark</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> uRemark;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setuRemark</span><span class="params">(String uRemark)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.uRemark = uRemark;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;users&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;uId=&quot;</span> + uId +</span><br><span class="line">                <span class="string">&quot;, uName=&#x27;&quot;</span> + uName + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, uAge=&#x27;&quot;</span> + uAge + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, uSex=&quot;</span> + uSex +</span><br><span class="line">                <span class="string">&quot;, uPhone=&#x27;&quot;</span> + uPhone + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, uRemark=&#x27;&quot;</span> + uRemark + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>

<ul>
<li>定义用户服务类接口</li>
</ul>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.testdata.demodata.Service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.testdata.demodata.pojo.users;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">userService</span> &#123;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    *@id</span></span><br><span class="line"><span class="comment">    * 根据用户id查找用户</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> users <span class="title function_">getUsers</span><span class="params">(<span class="type">int</span> id)</span>;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    *@uName</span></span><br><span class="line"><span class="comment">    * @uRemark</span></span><br><span class="line"><span class="comment">    * 根据用户名称或者备注查找多个用户</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;users&gt; <span class="title function_">findUsers</span><span class="params">(String uName, String uRemark)</span>;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    *@USER</span></span><br><span class="line"><span class="comment">    * 添加用户</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">inertUser</span><span class="params">(users user)</span>;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    *@user</span></span><br><span class="line"><span class="comment">    * 更改用户</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">updateUser</span><span class="params">(users user)</span>;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    *@id</span></span><br><span class="line"><span class="comment">    * 根据用户id删除用户</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span>  <span class="title function_">deleteUser</span><span class="params">(<span class="type">int</span> id)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>

<ul>
<li>用户服务实现类</li>
</ul>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.testdata.demodata.serviceImpl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.testdata.demodata.Service.userService;</span><br><span class="line"><span class="keyword">import</span> com.example.testdata.demodata.enumeration.sexEnum;</span><br><span class="line"><span class="keyword">import</span> com.example.testdata.demodata.pojo.users;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.ApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.AnnotationConfigApplicationContext;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.jdbc.core.JdbcTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.jdbc.core.RowMapper;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.sql.ResultSet;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">userServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">userService</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="type">JdbcTemplate</span> <span class="variable">jdbcTemplate</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="comment">//获取映射关系</span></span><br><span class="line">    <span class="keyword">public</span> RowMapper&lt;users&gt; <span class="title function_">getUserMapper</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">RowMapper</span> <span class="variable">rowMapper</span> <span class="operator">=</span> (ResultSet rs, <span class="type">int</span> i) -&gt; &#123;</span><br><span class="line">            <span class="type">users</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">users</span>();</span><br><span class="line">            user.setuId(rs.getInt(<span class="string">&quot;uid&quot;</span>));</span><br><span class="line">            user.setuName(rs.getString(<span class="string">&quot;uName&quot;</span>));</span><br><span class="line">            <span class="type">int</span> <span class="variable">sexCur</span> <span class="operator">=</span> rs.getInt(<span class="string">&quot;uSex&quot;</span>);</span><br><span class="line">            user.setuSex(sexEnum.getSexEnum(sexCur));</span><br><span class="line">            user.setuAge(rs.getString(<span class="string">&quot;uAge&quot;</span>));</span><br><span class="line">            user.setuPhone(rs.getString(<span class="string">&quot;uPhone&quot;</span>));</span><br><span class="line">            user.setuRemark(rs.getString(<span class="string">&quot;uRemark&quot;</span>));</span><br><span class="line">            <span class="keyword">return</span> user;</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="keyword">return</span> rowMapper;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> users <span class="title function_">getUsers</span><span class="params">(<span class="type">int</span> id)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;select * from u_users where uid = ?&quot;</span>;</span><br><span class="line">        Object[] params = <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;id&#125;;</span><br><span class="line">        <span class="type">users</span> <span class="variable">user</span> <span class="operator">=</span> (users) jdbcTemplate.queryForObject(sql,params,getUserMapper());</span><br><span class="line">        <span class="keyword">return</span> user;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;users&gt; <span class="title function_">findUsers</span><span class="params">(String uName, String uRemark)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;select * from u_users where uName like concat(&#x27;%&#x27;,?,&#x27;%&#x27;) or uRemark like concat(&#x27;%&#x27;,?,&#x27;%&#x27;)&quot;</span>;</span><br><span class="line">        Object[] params = <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;uName,uRemark&#125;;</span><br><span class="line">        List&lt;users&gt; uList = jdbcTemplate.query(sql,params,getUserMapper());</span><br><span class="line">        <span class="keyword">return</span> uList;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">inertUser</span><span class="params">(users user)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;insert into u_users(uName,uAge,uSex,uPhone,uRemark) values(?,?,?,?,?)&quot;</span>;</span><br><span class="line">        Object[] params = <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;user.getuName(),user.getuAge(),user.getuSex().getId(),user.getuPhone(),user.getuRemark()&#125;;</span><br><span class="line">        <span class="type">int</span> <span class="variable">res</span> <span class="operator">=</span> jdbcTemplate.update(sql,params);</span><br><span class="line">        System.out.println(<span class="string">&quot;sql值:&quot;</span>+sql.toString());</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">updateUser</span><span class="params">(users user)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;update u_users set uName = ? where uid = ?&quot;</span>;</span><br><span class="line">        Object[] params = <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;user.getuName(),user.getuId()&#125;;</span><br><span class="line">        <span class="type">int</span> <span class="variable">res</span> <span class="operator">=</span> jdbcTemplate.update(sql,params);</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">deleteUser</span><span class="params">(<span class="type">int</span> id)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;delete from u_users where uid = ?&quot;</span>;</span><br><span class="line">        Object[] params = <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;id&#125;;</span><br><span class="line">        <span class="type">int</span> <span class="variable">res</span> <span class="operator">=</span> jdbcTemplate.update(sql,params);</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">	 <span class="comment">/*</span></span><br><span class="line"><span class="comment">    使用StatementCallback和ConnectionCallback执行多条sql语句</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> users <span class="title function_">getUser2</span><span class="params">(<span class="type">int</span> id)</span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">users</span> <span class="variable">result</span> <span class="operator">=</span> <span class="built_in">this</span>.jdbcTemplate.execute((Statement state) -&gt; &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">sql1</span> <span class="operator">=</span> <span class="string">&quot;select count(*) as total from u_users where uid = &quot;</span> + id;</span><br><span class="line">            <span class="type">ResultSet</span> <span class="variable">rs</span> <span class="operator">=</span> state.executeQuery(sql1);</span><br><span class="line">            <span class="keyword">while</span> (rs.next())&#123;</span><br><span class="line">                <span class="type">int</span> <span class="variable">total</span> <span class="operator">=</span> rs.getInt(<span class="string">&quot;total&quot;</span>);</span><br><span class="line">                System.out.println(<span class="string">&quot;个数:&quot;</span>+total);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="type">String</span> <span class="variable">sql2</span> <span class="operator">=</span> <span class="string">&quot;select * from u_users where uid = &quot;</span> + id;<span class="comment">//注意这里查询全部才会给users对象赋值，如果少一个字段会报错，&quot;xxx&quot; not found</span></span><br><span class="line">            <span class="type">ResultSet</span> <span class="variable">rs2</span> <span class="operator">=</span> state.executeQuery(sql2);</span><br><span class="line">            <span class="type">users</span> <span class="variable">usera</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">            <span class="keyword">while</span> (rs2.next())&#123;</span><br><span class="line">                <span class="type">int</span> <span class="variable">rowNum</span> <span class="operator">=</span> rs2.getRow();</span><br><span class="line">                usera = getUserMapper().mapRow(rs2,rowNum);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> usera;</span><br><span class="line">        &#125;</span><br><span class="line">        );</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></div></figure>

<p><strong>此处获取映射关系可以直接使用Lambda表达式，1.8版本以下可使用匿名类。</strong></p>

        <h3 id="1-3-Controller测试">
          <a href="#1-3-Controller测试" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-3-Controller测试" class="headerlink" title="1.3 Controller测试"></a>1.3 Controller测试</h3>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.testdata.demodata.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.testdata.demodata.pojo.users;</span><br><span class="line"><span class="keyword">import</span> com.example.testdata.demodata.serviceImpl.userServiceImpl;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/user&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">dataController</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="type">userServiceImpl</span> <span class="variable">userService</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/data&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> users <span class="title function_">getControUser</span><span class="params">(<span class="type">int</span> id)</span>&#123;</span><br><span class="line">        <span class="type">users</span> <span class="variable">user</span> <span class="operator">=</span> userService.getUsers(id);</span><br><span class="line">        System.out.println(user.toString());</span><br><span class="line">        <span class="keyword">return</span> user;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>


        <h3 id="启动测试">
          <a href="#启动测试" class="heading-link"><i class="fas fa-link"></i></a><a href="#启动测试" class="headerlink" title="启动测试"></a>启动测试</h3>
      <p>输入地址:<span class="exturl"><a class="exturl__link" target="_blank" rel="noopener" href="http://localhost:8080/user/data?id=1">http://localhost:8080/user/data?id=1</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>
<p><img src="/2020/03/29/Spring-Boot%E5%AD%A6%E4%B9%A0v3/QQ%E6%88%AA%E5%9B%BE20200404231146.png"></p>
<p><strong>外：关于Lambda表达式</strong></p>
<ul>
<li>Java8中Lambda表达式语法:</li>
</ul>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">() -&gt; <span class="number">5</span>;		<span class="comment">//无需参数，返回值为5</span></span><br><span class="line"></span><br><span class="line">x -&gt; <span class="number">5</span>;  		<span class="comment">//只接收一个参数，可不用圆括号。返回5</span></span><br><span class="line"></span><br><span class="line">(a,b) -&gt; a+b	<span class="comment">//表示返回a+b的值，主体只有一条语句可不适用大括号</span></span><br><span class="line"></span><br><span class="line">(String a, String b) -&gt; System.out.println(<span class="string">&quot;a:&quot;</span>+a+<span class="string">&quot;-b:&quot;</span>+b);		<span class="comment">//明确a，b的类型。打印a和b的值，不返回</span></span><br><span class="line"></span><br><span class="line">(<span class="type">int</span> a, <span class="type">int</span> b) -&gt; &#123; <span class="keyword">return</span> a*b ;&#125;;			<span class="comment">//返回a*b的值，主体有大括号</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></div></figure>

<ul>
<li>函数式接口:</li>
</ul>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">@FunctionalInterface</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">funTest</span>&#123;</span><br><span class="line">	<span class="type">int</span> <span class="title function_">methTest</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>

<blockquote>
<p>函数式接口只能定义一个抽象方法，当然不包含重写Object类的方法。</p>
</blockquote>
<ul>
<li>Lambda表达式的使用示例</li>
</ul>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">test</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//加减乘除操作</span></span><br><span class="line">        <span class="type">test</span> <span class="variable">ops</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">test</span>();</span><br><span class="line">        <span class="type">test1</span> <span class="variable">tAdd</span> <span class="operator">=</span> (a,b) -&gt; a+b;</span><br><span class="line">        <span class="type">test1</span> <span class="variable">tSubStraction</span> <span class="operator">=</span> (a,b) -&gt; a-b;</span><br><span class="line">        <span class="type">test1</span> <span class="variable">tMulity</span> <span class="operator">=</span> (a,b) -&gt; a*b;</span><br><span class="line">        <span class="type">test1</span> <span class="variable">tDevi</span> <span class="operator">=</span> (a,b) -&gt; a/b;</span><br><span class="line">        System.out.println(<span class="string">&quot;加法:&quot;</span>+ops.resOps(<span class="number">5</span>,<span class="number">1</span>,tAdd));</span><br><span class="line">        System.out.println(<span class="string">&quot;减法：&quot;</span>+ops.resOps(<span class="number">5</span>,<span class="number">1</span>,tSubStraction));</span><br><span class="line">        System.out.println(<span class="string">&quot;乘法：&quot;</span>+ops.resOps(<span class="number">5</span>,<span class="number">1</span>,tMulity));</span><br><span class="line">        System.out.println(<span class="string">&quot;除法:&quot;</span>+ops.resOps(<span class="number">5</span>,<span class="number">1</span>,tDevi));</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="title function_">resOps</span><span class="params">(<span class="type">int</span> a,<span class="type">int</span> b,test1 t)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> t.methInt(a,b);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@FunctionalInterface</span></span><br><span class="line">    <span class="keyword">interface</span> <span class="title class_">test1</span>&#123;</span><br><span class="line">        <span class="type">int</span> <span class="title function_">methInt</span><span class="params">(<span class="type">int</span> a,<span class="type">int</span> b)</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>

<p><strong>最后打印值</strong></p>
<p><img src="/2020/03/29/Spring-Boot%E5%AD%A6%E4%B9%A0v3/QQ%E6%88%AA%E5%9B%BE20200329202033.png"></p>

        <h2 id="2-整合MyBatis框架">
          <a href="#2-整合MyBatis框架" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-整合MyBatis框架" class="headerlink" title="2.整合MyBatis框架"></a>2.整合MyBatis框架</h2>
      
        <h3 id="一-使用MapperFactoryBean装配MyBatis接口">
          <a href="#一-使用MapperFactoryBean装配MyBatis接口" class="heading-link"><i class="fas fa-link"></i></a><a href="#一-使用MapperFactoryBean装配MyBatis接口" class="headerlink" title="一.使用MapperFactoryBean装配MyBatis接口"></a>一.使用MapperFactoryBean装配MyBatis接口</h3>
      <ul>
<li><strong>引入MyBatis的stater</strong></li>
</ul>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">	&lt;groupId&gt;org.mybatis.spring.boot&lt;/groupId&gt;</span><br><span class="line">	&lt;artifactId&gt;mybatis-spring-boot-starter&lt;/artifactId&gt;</span><br><span class="line">	&lt;version&gt;<span class="number">1.3</span><span class="number">.1</span>&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">	&lt;groupId&gt;mysql&lt;/groupId&gt;</span><br><span class="line">	&lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;</span><br><span class="line">	&lt;scope&gt;runtime&lt;/scope&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></div></figure>

<ul>
<li><strong>pojo中的用户类使用MyBatis别名</strong></li>
</ul>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.sqldata.pojo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.type.Alias;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> *指定别名</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Alias(value = &quot;user&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> uid;</span><br><span class="line">    <span class="keyword">private</span> String uname;</span><br><span class="line">    <span class="keyword">private</span> String uage;</span><br><span class="line">    <span class="keyword">private</span> enumSex usex;</span><br><span class="line">    <span class="keyword">private</span> String uphone;</span><br><span class="line">    <span class="keyword">private</span> String uremark;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getUid</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> uid;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setUid</span><span class="params">(<span class="type">int</span> uid)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.uid = uid;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getUname</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> uname;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setUname</span><span class="params">(String uname)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.uname = uname;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getUage</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> uage;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setUage</span><span class="params">(String uage)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.uage = uage;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> enumSex <span class="title function_">getUsex</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> usex;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setUsex</span><span class="params">(enumSex usex)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.usex = usex;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getUphone</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> uphone;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setUphone</span><span class="params">(String uphone)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.uphone = uphone;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getUremark</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> uremark;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setUremark</span><span class="params">(String uremark)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.uremark = uremark;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;User&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;uid=&quot;</span> + uid +</span><br><span class="line">                <span class="string">&quot;, uname=&#x27;&quot;</span> + uname + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, uage=&#x27;&quot;</span> + uage + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, usex=&quot;</span> + usex +</span><br><span class="line">                <span class="string">&quot;, uphone=&#x27;&quot;</span> + uphone + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, uremark=&#x27;&quot;</span> + uremark + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></div></figure>
<ul>
<li><strong>由于封装的pojo类User中性别是枚举类，在MyBatis中，枚举是可以通过typeHandler转换的</strong></li>
</ul>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.sqldata.typeHander;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.sqldata.pojo.enumSex;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.type.BaseTypeHandler;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.type.JdbcType;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.type.MappedJdbcTypes;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.type.MappedTypes;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.sql.CallableStatement;</span><br><span class="line"><span class="keyword">import</span> java.sql.PreparedStatement;</span><br><span class="line"><span class="keyword">import</span> java.sql.ResultSet;</span><br><span class="line"><span class="keyword">import</span> java.sql.SQLException;</span><br><span class="line"><span class="comment">//声明jdbctype为整型</span></span><br><span class="line"><span class="meta">@MappedJdbcTypes(JdbcType.INTEGER)</span></span><br><span class="line"><span class="comment">//声明javatype为枚举</span></span><br><span class="line"><span class="meta">@MappedTypes(value = enumSex.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">typeHandler</span> <span class="keyword">extends</span> <span class="title class_">BaseTypeHandler</span>&lt;enumSex&gt; &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setNonNullParameter</span><span class="params">(PreparedStatement preparedStatement, <span class="type">int</span> i, enumSex o, JdbcType jdbcType)</span> <span class="keyword">throws</span> SQLException &#123;</span><br><span class="line">        preparedStatement.setInt(i,o.getId());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> enumSex <span class="title function_">getNullableResult</span><span class="params">(ResultSet resultSet, String s)</span> <span class="keyword">throws</span> SQLException &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">sexId</span> <span class="operator">=</span> resultSet.getInt(s);</span><br><span class="line">        <span class="keyword">if</span>(sexId != <span class="number">1</span> &amp;&amp; sexId != <span class="number">2</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> enumSex.getEnum(sexId);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> enumSex <span class="title function_">getNullableResult</span><span class="params">(ResultSet resultSet, <span class="type">int</span> i)</span> <span class="keyword">throws</span> SQLException &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">sexId</span> <span class="operator">=</span> resultSet.getInt(i);</span><br><span class="line">        <span class="keyword">if</span>(sexId != <span class="number">1</span> &amp;&amp; sexId != <span class="number">2</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> enumSex.getEnum(sexId);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> enumSex <span class="title function_">getNullableResult</span><span class="params">(CallableStatement callableStatement, <span class="type">int</span> i)</span> <span class="keyword">throws</span> SQLException &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">sexId</span> <span class="operator">=</span> callableStatement.getInt(i);</span><br><span class="line">        <span class="keyword">if</span>(sexId != <span class="number">1</span> &amp;&amp; sexId != <span class="number">2</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> enumSex.getEnum(sexId);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>

<ul>
<li><strong>定义用户映射文件userDao.xml</strong></li>
</ul>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;?<span class="type">xml</span> <span class="variable">version</span> <span class="operator">=</span> <span class="string">&quot;1.0&quot;</span> encoding = <span class="string">&quot;UTF-8&quot;</span> ?&gt;</span><br><span class="line">&lt;!DOCTYPE mapper</span><br><span class="line">        PUBLIC <span class="string">&quot;-h//mybatis.org/DTD Mapper 3.0//EN&quot;</span></span><br><span class="line">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span><br><span class="line">&lt;mapper namespace=<span class="string">&quot;com.example.sqldata.dao.userDao&quot;</span>&gt;</span><br><span class="line">    &lt;select id=<span class="string">&quot;getUser&quot;</span> parameterType=<span class="string">&quot;int&quot;</span> resultType=<span class="string">&quot;user&quot;</span>&gt;</span><br><span class="line">        select * from u_users <span class="type">where</span> <span class="variable">uid</span> <span class="operator">=</span> #&#123;id&#125;</span><br><span class="line">    &lt;/select&gt;</span><br><span class="line">&lt;/mapper&gt;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></div></figure>

<blockquote>
<p>注:此处的userDao.xml文件最好名称和userDao接口一致。且此xml文件定义在resource中</p>
</blockquote>
<p><img src="/2020/03/29/Spring-Boot%E5%AD%A6%E4%B9%A0v3/QQ%E6%88%AA%E5%9B%BE20200413220209.png"></p>
<ul>
<li><strong>定义MyBatis操作接口userDao</strong></li>
</ul>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.sqldata.dao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.sqldata.pojo.User;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Mapper;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Repository;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">userDao</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">getUser</span><span class="params">(<span class="type">int</span> id)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>

<ul>
<li><strong>配置文件和扫描别名</strong></li>
</ul>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">spring:</span><br><span class="line">  datasource:</span><br><span class="line">    url: jdbc:mysql:<span class="comment">//localhost:3306/users?useUnicode=true&amp;characterEncoding=utf-8&amp;useSSL=true&amp;serverTimezone=UTC</span></span><br><span class="line">    username: root</span><br><span class="line">    password: <span class="number">123456</span></span><br><span class="line">    tomcat:</span><br><span class="line">      max-idle: <span class="number">0</span></span><br><span class="line">      max-active: <span class="number">50</span></span><br><span class="line">      max-wait: <span class="number">10000</span></span><br><span class="line">      initial-size: <span class="number">5</span></span><br><span class="line">    driver-class-name: com.mysql.cj.jdbc.Driver</span><br><span class="line">mybatis:</span><br><span class="line">  mapper-locations: classpath:mapper<span class="comment">/*.xml</span></span><br><span class="line"><span class="comment">  type-aliases-package: com.example.sqldata.pojo</span></span><br><span class="line"><span class="comment">  type-handlers-package: com.example.sqldata.typeHander</span></span><br><span class="line"><span class="comment"></span></span><br></pre></td></tr></table></div></figure>

        <h2 id="三-Spring整合Mybatis（3种）">
          <a href="#三-Spring整合Mybatis（3种）" class="heading-link"><i class="fas fa-link"></i></a><a href="#三-Spring整合Mybatis（3种）" class="headerlink" title="三.Spring整合Mybatis（3种）"></a>三.Spring整合Mybatis（3种）</h2>
      
        <h3 id="使用MapperFactoryBean装配MyBatis接口">
          <a href="#使用MapperFactoryBean装配MyBatis接口" class="heading-link"><i class="fas fa-link"></i></a><a href="#使用MapperFactoryBean装配MyBatis接口" class="headerlink" title="使用MapperFactoryBean装配MyBatis接口"></a>使用MapperFactoryBean装配MyBatis接口</h3>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.sqldata.bean;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.sqldata.dao.userDao;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSessionFactory;</span><br><span class="line"><span class="keyword">import</span> org.mybatis.spring.mapper.MapperFactoryBean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">mapperBean</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="type">SqlSessionFactory</span> <span class="variable">sqlSessionFactory</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> MapperFactoryBean&lt;userDao&gt; <span class="title function_">initMybatisUser</span><span class="params">()</span>&#123;</span><br><span class="line">        MapperFactoryBean&lt;userDao&gt; bean = <span class="keyword">new</span> <span class="title class_">MapperFactoryBean</span>&lt;&gt;();</span><br><span class="line">        bean.setMapperInterface(userDao.class);</span><br><span class="line">        bean.setSqlSessionFactory(sqlSessionFactory);</span><br><span class="line">        <span class="keyword">return</span> bean;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>

<blockquote>
<p>写在Springboot启动时可以扫描的地方，或者直接写在@SpringBootApplication所在的类中</p>
</blockquote>
<ul>
<li><strong>定义服务接口</strong></li>
</ul>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.sqldata.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.sqldata.pojo.User;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">userService</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">getUser</span><span class="params">(<span class="type">int</span> id)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>

<ul>
<li><strong>服务接口实现</strong></li>
</ul>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.sqldata.serviceimpl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.sqldata.dao.userDao;</span><br><span class="line"><span class="keyword">import</span> com.example.sqldata.pojo.User;</span><br><span class="line"><span class="keyword">import</span> com.example.sqldata.service.userService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">userServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">userService</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">userDao</span> <span class="variable">udao</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">getUser</span><span class="params">(<span class="type">int</span> id)</span> &#123;</span><br><span class="line">        <span class="type">User</span> <span class="variable">u</span> <span class="operator">=</span> udao.getUser(id);</span><br><span class="line">        <span class="keyword">return</span> u;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>

<ul>
<li><strong>控制器测试</strong></li>
</ul>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.sqldata.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.sqldata.pojo.User;</span><br><span class="line"><span class="keyword">import</span> com.example.sqldata.service.userService;</span><br><span class="line"><span class="keyword">import</span> com.example.sqldata.serviceimpl.userServiceImpl;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.ResponseBody;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/user&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">userController</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">userService</span> <span class="variable">userv</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/test&quot;)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">getUser</span><span class="params">(<span class="type">int</span> id)</span>&#123;</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userv.getUser(id);</span><br><span class="line">        System.out.println(user.toString());</span><br><span class="line">        <span class="keyword">return</span> user;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>

<blockquote>
<p>注：这里@Autowired中定义的都是接口。</p>
</blockquote>
<p><img src="/2020/03/29/Spring-Boot%E5%AD%A6%E4%B9%A0v3/QQ%E6%88%AA%E5%9B%BE20200413220825.png"></p>

        <h3 id="二-使用MapperScannerConfigurer装配MyBatis接口">
          <a href="#二-使用MapperScannerConfigurer装配MyBatis接口" class="heading-link"><i class="fas fa-link"></i></a><a href="#二-使用MapperScannerConfigurer装配MyBatis接口" class="headerlink" title="二.使用MapperScannerConfigurer装配MyBatis接口"></a>二.使用MapperScannerConfigurer装配MyBatis接口</h3>
      <ul>
<li>修改mapperBean的代码</li>
</ul>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.sqldata.bean;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.sqldata.dao.userDao;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSessionFactory;</span><br><span class="line"><span class="keyword">import</span> org.mybatis.spring.mapper.MapperFactoryBean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">mapperBean</span> &#123;</span><br><span class="line">    <span class="comment">/***</span></span><br><span class="line"><span class="comment">     * 配置MyBatis接口扫描</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span>   返回扫描器</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> MapperScannerConfigurer <span class="title function_">mapperScannerConfig</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">// 定义扫描器实例</span></span><br><span class="line">        <span class="type">MapperScannerConfigurer</span> <span class="variable">mapperScannerConfigurer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MapperScannerConfigurer</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//加载sqlSessionFactory    SpringBoot会自动生成sqlSessionFactory实例</span></span><br><span class="line">        mapperScannerConfigurer.setSqlSessionFactoryBeanName(<span class="string">&quot;sqlSessionFactory&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//定义扫描的包</span></span><br><span class="line">        mapperScannerConfigurer.setBasePackage(<span class="string">&quot;com.example.sqldata.*&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//限定被标注@Repository的接口才被扫描  所以在userDao接口类中的注解需要是@Repository才能被扫描到</span></span><br><span class="line">        mapperScannerConfigurer.setAnnotationClass(Repository.class);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> mapperScannerConfigurer;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>


        <h3 id="三-使用MapperScan定义扫描">
          <a href="#三-使用MapperScan定义扫描" class="heading-link"><i class="fas fa-link"></i></a><a href="#三-使用MapperScan定义扫描" class="headerlink" title="三.使用MapperScan定义扫描"></a>三.使用MapperScan定义扫描</h3>
      <ul>
<li>删除上述<strong>二</strong>代码</li>
</ul>
<ul>
<li>SpringApplication:</li>
</ul>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@MapperScan(</span></span><br><span class="line"><span class="meta">        //指定扫描包</span></span><br><span class="line"><span class="meta">        basePackages = &quot;com.example.sqldata.*&quot;,</span></span><br><span class="line"><span class="meta">        //指定sqlSessionFactory。若sqlSessionTemplate被指定 则作废</span></span><br><span class="line"><span class="meta">        sqlSessionFactoryRef = &quot;sqlSessionFactory&quot;,</span></span><br><span class="line"><span class="meta">        //指定sqlSessionTemplate  将忽略sqlSessionFactory的配置</span></span><br><span class="line"><span class="meta">        sqlSessionTemplateRef = &quot;sqlSessionTemplate&quot;,</span></span><br><span class="line"><span class="meta">        //限定扫描接口</span></span><br><span class="line"><span class="meta">        annotationClass = Repository.class</span></span><br><span class="line"><span class="meta">)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SqldataApplication</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(SqldataApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<p><strong>basePackages：</strong>需要扫描的包，也就是mapper的接口userDao。</p>
<p>**annotationClass &#x3D; Repository.class:**限定扫描的接口。此处表示扫描的mapper的接口必须是Repository</p>
<hr>

        <h1 id="数据库事务处理">
          <a href="#数据库事务处理" class="heading-link"><i class="fas fa-link"></i></a><a href="#数据库事务处理" class="headerlink" title="数据库事务处理"></a>数据库事务处理</h1>
      <p><strong>mybatis框架最常用的事务管理器是DataSourceTransactionManager</strong></p>
<p>对于声明式事务，是使用**@Transactional<strong>进行标注的，这个注解可以标注在类或者方法上。当标注在</strong>类<strong>上时，代表这个类所有</strong>公共非静态方法**都将启用事务功能。</p>

        <h2 id="事务的使用">
          <a href="#事务的使用" class="heading-link"><i class="fas fa-link"></i></a><a href="#事务的使用" class="headerlink" title="事务的使用"></a>事务的使用</h2>
      <ol>
<li><strong>pom.xml引入mysql，mybatis的依赖</strong></li>
</ol>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.mybatis.spring.boot&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;mybatis-spring-boot-starter&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;<span class="number">1.3</span><span class="number">.1</span>&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;mysql&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;</span><br><span class="line">    &lt;scope&gt;runtime&lt;/scope&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></div></figure>

<ol start="2">
<li><strong>application.yml文件配置数据源，Mapper扫描路径等</strong></li>
</ol>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">spring:</span><br><span class="line">  datasource:</span><br><span class="line">    url: jdbc:mysql:<span class="comment">//localhost:3306/users?useUnicode=true&amp;characterEncoding=utf-8&amp;useSSL=true&amp;serverTimezone=UTC</span></span><br><span class="line">    username: root</span><br><span class="line">    password: <span class="number">123456</span></span><br><span class="line">    tomcat:</span><br><span class="line">      max-idle: <span class="number">0</span></span><br><span class="line">      max-active: <span class="number">50</span></span><br><span class="line">      max-wait: <span class="number">10000</span></span><br><span class="line">      initial-size: <span class="number">5</span></span><br><span class="line">    driver-class-name: com.mysql.cj.jdbc.Driver</span><br><span class="line">mybatis:</span><br><span class="line">  mapper-locations: classpath:mapper<span class="comment">/*.xml</span></span><br><span class="line"><span class="comment">  type-aliases-package: com.example.spdemo.myspring.pojo</span></span><br><span class="line"><span class="comment">  type-handlers-package: com.example.spdemo.myspring.typeHandler</span></span><br><span class="line"><span class="comment"></span></span><br></pre></td></tr></table></div></figure>

<ol start="3">
<li><strong>定义dao接口</strong></li>
</ol>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.spdemo.myspring.dao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.spdemo.myspring.pojo.User;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Repository;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">userDao</span> &#123;</span><br><span class="line">     User <span class="title function_">getUser</span><span class="params">(<span class="type">int</span> id)</span>;</span><br><span class="line"></span><br><span class="line">     <span class="type">int</span> <span class="title function_">insertUser</span><span class="params">(User user)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>

<ol start="4">
<li><strong>userDao的xml文件</strong></li>
</ol>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&lt;?<span class="type">xml</span> <span class="variable">version</span> <span class="operator">=</span> <span class="string">&quot;1.0&quot;</span> encoding = <span class="string">&quot;UTF-8&quot;</span> ?&gt;</span><br><span class="line">&lt;!DOCTYPE mapper</span><br><span class="line">        PUBLIC <span class="string">&quot;-h//mybatis.org/DTD Mapper 3.0//EN&quot;</span></span><br><span class="line">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span><br><span class="line">&lt;mapper namespace=<span class="string">&quot;com.example.spdemo.myspring.dao.userDao&quot;</span>&gt;</span><br><span class="line">   </span><br><span class="line"> 	&lt;select id=<span class="string">&quot;getUser&quot;</span> parameterType=<span class="string">&quot;int&quot;</span> resultType=<span class="string">&quot;user&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line">        select * from u_users <span class="type">where</span> <span class="variable">uid</span> <span class="operator">=</span> #&#123;uid&#125;</span><br><span class="line"></span><br><span class="line">    &lt;/select&gt;</span><br><span class="line"></span><br><span class="line">    &lt;insert id=<span class="string">&quot;insertUser&quot;</span> useGeneratedKeys=<span class="string">&quot;true&quot;</span> keyProperty=<span class="string">&quot;id&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line">        insert into <span class="title function_">u_users</span><span class="params">(uName , uAge , uSex , uPhone , uRemark)</span> values(#&#123;uName&#125; , #&#123;uAge&#125; , #&#123;uSex&#125; , #&#123;uPhone&#125; , #&#123;uRemark&#125;)</span><br><span class="line"></span><br><span class="line">    &lt;/insert&gt;</span><br><span class="line"></span><br><span class="line">&lt;/mapper&gt;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>

<p><strong>注意:此处的resultType的值要么是全路径，要么是pojo类的别名</strong></p>
<ol start="5">
<li><strong>service接口及实现</strong></li>
</ol>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.spdemo.myspring.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.spdemo.myspring.pojo.User;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">userService</span> &#123;</span><br><span class="line">     User <span class="title function_">getUser</span><span class="params">(<span class="type">int</span> id)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 添加用户</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@int</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">insertUser</span><span class="params">(User user)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>

<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.spdemo.myspring.serviceImpl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.spdemo.myspring.dao.userDao;</span><br><span class="line"><span class="keyword">import</span> com.example.spdemo.myspring.pojo.User;</span><br><span class="line"><span class="keyword">import</span> com.example.spdemo.myspring.service.userService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"><span class="keyword">import</span> org.springframework.transaction.annotation.Isolation;</span><br><span class="line"><span class="keyword">import</span> org.springframework.transaction.annotation.Transactional;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">userServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">userService</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="type">userDao</span> <span class="variable">udao</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="meta">@Transactional(isolation = Isolation.READ_COMMITTED , timeout = 1)</span></span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">getUser</span><span class="params">(<span class="type">int</span> id)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> udao.getUser(id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="meta">@Transactional(isolation = Isolation.READ_COMMITTED , timeout = 1)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">insertUser</span><span class="params">(User user)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> udao.insertUser(user);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>

<p><strong>此处仅仅使用@Transactional注解，标识insertUser方法需要启动事务处理机制。Spring会自动把insertUser的方法织入到约定的流程中，这样就可以减少大量打吗，同时代码也更具备可读性和可维护性</strong></p>
<ol start="6">
<li><strong>controller类测试</strong></li>
</ol>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.spdemo.myspring.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.spdemo.myspring.enums.sexEnum;</span><br><span class="line"><span class="keyword">import</span> com.example.spdemo.myspring.pojo.User;</span><br><span class="line"><span class="keyword">import</span> com.example.spdemo.myspring.service.userService;</span><br><span class="line"><span class="keyword">import</span> com.example.spdemo.myspring.serviceImpl.userServiceImpl;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.ResponseBody;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/user&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">testcon</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="type">userService</span> <span class="variable">usera</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/test&quot;)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">getUsert</span><span class="params">(<span class="type">int</span> id)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> usera.getUser(id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/insert&quot;)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> Map&lt;String,Object&gt; <span class="title function_">insertUser</span><span class="params">(String uName , String uAge , <span class="type">int</span> uSex , String uPhone , String uRemark)</span>&#123;</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">        user.setuName(uName);</span><br><span class="line">        user.setuAge(uAge);</span><br><span class="line">        user.setuSex(sexEnum.getSexEnumCur(uSex));</span><br><span class="line">        user.setuPhone(uPhone);</span><br><span class="line">        user.setuRemark(uRemark);</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> usera.insertUser(user);</span><br><span class="line"></span><br><span class="line">        Map&lt;String,Object&gt; userMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;String,Object&gt;();</span><br><span class="line">        userMap.put(<span class="string">&quot;success&quot;</span> , result == <span class="number">1</span>);</span><br><span class="line">        userMap.put(<span class="string">&quot;user&quot;</span> , user);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> userMap;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>

<ol start="7">
<li><strong>启动文件</strong></li>
</ol>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.spdemo.myspring;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.mybatis.spring.annotation.MapperScan;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Repository;</span><br><span class="line"><span class="keyword">import</span> org.springframework.transaction.PlatformTransactionManager;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.annotation.PostConstruct;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@MapperScan(</span></span><br><span class="line"><span class="meta">        //指定扫描包</span></span><br><span class="line"><span class="meta">        basePackages = &quot;com.example.spdemo.myspring.*&quot;,</span></span><br><span class="line"><span class="meta">        //指定sqlSessionFactory。若sqlSessionTemplate被指定 则作废</span></span><br><span class="line"><span class="meta">        sqlSessionFactoryRef = &quot;sqlSessionFactory&quot;,</span></span><br><span class="line"><span class="meta">        //指定sqlSessionTemplate  将忽略sqlSessionFactory的配置</span></span><br><span class="line"><span class="meta">        sqlSessionTemplateRef = &quot;sqlSessionTemplate&quot;,</span></span><br><span class="line"><span class="meta">        //限定扫描接口</span></span><br><span class="line"><span class="meta">        annotationClass = Repository.class</span></span><br><span class="line"><span class="meta">)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyspringApplication</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(MyspringApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//注入事务管理器，由SpringBoot自动生成</span></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="type">PlatformTransactionManager</span> <span class="variable">transactionManager</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//使用后初始化方法，观察自动生成的事务管理器</span></span><br><span class="line">    <span class="meta">@PostConstruct</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">viewTransactionManager</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(transactionManager.getClass().getName());</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure></div></div></article><article class="postlist-item post"><header class="post-header"><h1 class="post-title"><a class="post-title__link" href="/2020/02/09/Spring-Boot%E5%AD%A6%E4%B9%A0v2/">Spring-Boot学习v2</a></h1><div class="post-meta"><span class="post-meta-item post-meta-item--createtime"><span class="post-meta-item__icon"><i class="far fa-calendar-plus"></i></span><span class="post-meta-item__info">Created</span><span class="post-meta-item__value">2020-02-09</span></span><span class="post-meta-item post-meta-item--updatetime"><span class="post-meta-item__icon"><i class="far fa-calendar-check"></i></span><span class="post-meta-item__info">Updated</span><span class="post-meta-item__value">2022-05-21</span></span></div></header><div class="post-body"><div class="post-excerpt">
        <h2 id="约定编程–Spring-AOP">
          <a href="#约定编程–Spring-AOP" class="heading-link"><i class="fas fa-link"></i></a><a href="#约定编程–Spring-AOP" class="headerlink" title="约定编程–Spring AOP"></a>约定编程–Spring AOP</h2>
      
        <h3 id="简单实现约定编程">
          <a href="#简单实现约定编程" class="heading-link"><i class="fas fa-link"></i></a><a href="#简单实现约定编程" class="headerlink" title="简单实现约定编程"></a>简单实现约定编程</h3>
      <ol>
<li><strong>简单接口HelloService</strong></li>
</ol>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.sprbot.interfece;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">HelloService</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sayHello</span><span class="params">(String name)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<ol start="2">
<li><strong>HelloService实现类HelloServiceImpl</strong></li>
</ol>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.sprbot.serviceImpl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.sprbot.interfece.HelloService;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">HelloService</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sayHello</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(name==<span class="literal">null</span>||name.trim()==<span class="string">&quot;&quot;</span>)&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;参数为空！&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;Hello,&quot;</span>+name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>
<blockquote>
<p>此代码清单表示如果参数为空的话就会抛出异常。抛出异常后之后的代码不会执行。</p>
</blockquote>
<ol start="3">
<li><strong>定义拦截器接口Interceptor</strong></li>
</ol>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.sprbot.interfece;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.sprbot.invoke.Invocation;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Interceptor</span> &#123;</span><br><span class="line">    <span class="comment">//事前方法</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">before</span><span class="params">()</span>;</span><br><span class="line">    <span class="comment">//事后方法</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">after</span><span class="params">()</span>;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 取代原有事件的方法</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> invocation --回调参数，可以通过它的proceed方法，回调原有事件</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span>  原有事件返回对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> java.lang.reflect.InvocationTargetException</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IllegalAccessException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">around</span><span class="params">(Invocation invocation)</span><span class="keyword">throws</span> Exception;</span><br><span class="line">    <span class="comment">//事后返回方法</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterReturning</span><span class="params">()</span>;</span><br><span class="line">    <span class="comment">//事后异常方法</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterThrowing</span><span class="params">()</span>;</span><br><span class="line">    <span class="comment">//是否使用around方法取代原有方法</span></span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">useAround</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<ol start="4">
<li><strong>拦截器接口实现MyInterceptor</strong></li>
</ol>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.sprbot.serviceImpl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.sprbot.interfece.Interceptor;</span><br><span class="line"><span class="keyword">import</span> com.example.sprbot.invoke.Invocation;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyInterceptor</span> <span class="keyword">implements</span> <span class="title class_">Interceptor</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">before</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;before....之前&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">after</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;after....之后&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">around</span><span class="params">(Invocation invocation)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;around before...&quot;</span>);</span><br><span class="line">        <span class="type">Object</span> <span class="variable">object</span> <span class="operator">=</span> invocation.proceed();</span><br><span class="line">        System.out.println(<span class="string">&quot;around after .....&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> object;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterReturning</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;afterReturning.....&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterThrowing</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;afterThrowing....&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">useAround</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>

<p>Invocation类源码</p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.sprbot.invoke;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Invocation</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Object[] params;</span><br><span class="line">    <span class="keyword">private</span> Method method;</span><br><span class="line">    <span class="keyword">private</span> Object target;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Invocation</span><span class="params">(Object target,Method method,Object[] params)</span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.target=target;</span><br><span class="line">        <span class="built_in">this</span>.method=method;</span><br><span class="line">        <span class="built_in">this</span>.params=params;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//反射方法</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">proceed</span><span class="params">()</span><span class="keyword">throws</span> Exception&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.method.invoke(target,params);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//getter/setter</span></span><br><span class="line">    <span class="keyword">public</span> Object[] getParams() &#123;</span><br><span class="line">        <span class="keyword">return</span> params;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setParams</span><span class="params">(Object[] params)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.params = params;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Method <span class="title function_">getMethod</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> method;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setMethod</span><span class="params">(Method method)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.method = method;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">getTarget</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> target;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setTarget</span><span class="params">(Object target)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.target = target;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>

<blockquote>
<p>以上代码的proceed方法会以反射的形式去调用原有的方法</p>
</blockquote>
<p>当有了以上服务类和拦截方法时我们就需要一个代理对象(proxy)，可以使用target对象实现的接口类型对其强制转换。当调用代理对象(proxy)的方法时，执行流程如下:</p>
<ul>
<li><p>使用proxy调用方法时会先执行拦截器的before方法</p>
</li>
<li><p>如果拦截器的useAround方法返回true，则执行拦截器的around方法，而不调用target对象对应的方法，然而由于around方法中Invocation对象存在proceed方法，它可以调用target对象对应的方法。如果useAround方法返回false，则直接调用target对象的事件方法。</p>
</li>
<li><p>无论如何，在完成之前的事件方法后，都会执行拦截器的after方法。</p>
</li>
<li><p>在执行around方法或者回调target的事件方法时，如果发生异常，执行拦截器的afterThrowing方法，否则执行afterReturning方法。</p>
</li>
</ul>
<ol start="5">
<li><strong>ProxyBean类的实现</strong></li>
</ol>
<p>如果要将服务类和拦截方法织入对应的流程，需要一个类ProxyBean，此类中会有一个方法getProxyBean。在此方法中生成代理对象，而代理对象的生成，则需要Proxy类中的静态方法–newProxyInstance:</p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title function_">newProxyInstance</span><span class="params">(ClassLoader classloader, Class[] interfaces, InvocationHandler invocationHandler)</span>;</span><br></pre></td></tr></table></div></figure>

<ul>
<li><p>classloader：类加载器</p>
</li>
<li><p>interfaces:绑定的接口。就是把代理对象绑定到那些接口下，可以是多个</p>
</li>
<li><p>invocationHandler:绑定代理对象逻辑实现。它是一个接口InvocationHandler对象，定义了invoke方法，这个方法就是实现代理对象的逻辑。</p>
</li>
</ul>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.sprbot.invoke;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.sprbot.interfece.Interceptor;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cglib.proxy.InvocationHandler;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cglib.proxy.Proxy;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProxyBean</span> <span class="keyword">implements</span> <span class="title class_">InvocationHandler</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Object target=<span class="literal">null</span>;<span class="comment">//目标对象</span></span><br><span class="line">    <span class="keyword">private</span> Interceptor interceptor=<span class="literal">null</span>;<span class="comment">//拦截接口</span></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 绑定代理对象</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title function_">getProxyBean</span><span class="params">(Object target,Interceptor interceptor)</span>&#123;</span><br><span class="line">        <span class="type">ProxyBean</span> <span class="variable">proxyBean</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ProxyBean</span>();</span><br><span class="line">        proxyBean.setTarget(target);</span><br><span class="line">        proxyBean.setInterceptor(interceptor);</span><br><span class="line">        <span class="type">Object</span> <span class="variable">proxy</span> <span class="operator">=</span> Proxy.newProxyInstance(target.getClass().getClassLoader(),target.getClass().getInterfaces(),proxyBean);</span><br><span class="line">        <span class="comment">//返回代理对象</span></span><br><span class="line">        <span class="keyword">return</span> proxy;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	*<span class="doctag">@retObj</span> 调用的方法的返回结果</span></span><br><span class="line"><span class="comment">	*/</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        <span class="comment">//是否异常标识</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">excepFlag</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="type">Invocation</span> <span class="variable">invocation</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Invocation</span>(target,method,args);</span><br><span class="line">        <span class="built_in">this</span>.interceptor.before();</span><br><span class="line">        <span class="type">Object</span> <span class="variable">retObj</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="built_in">this</span>.interceptor.useAround())&#123;</span><br><span class="line">                retObj = <span class="built_in">this</span>.interceptor.around(invocation);</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                method.invoke(target,args);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">            excepFlag = <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">this</span>.interceptor.after();</span><br><span class="line">        <span class="keyword">if</span>(excepFlag)&#123;</span><br><span class="line">            <span class="built_in">this</span>.interceptor.afterThrowing();</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="built_in">this</span>.interceptor.afterReturning();</span><br><span class="line">            <span class="keyword">return</span> retObj;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">getTarget</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> target;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setTarget</span><span class="params">(Object target)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.target = target;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Interceptor <span class="title function_">getInterceptor</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> interceptor;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setInterceptor</span><span class="params">(Interceptor interceptor)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.interceptor = interceptor;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>

<blockquote>
<p>以上代码因为继承了接口InvocationHandler，因此就可以定义invoke方法。</p>
</blockquote>
<ol start="6">
<li><strong>测试方法</strong></li>
</ol>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">      <span class="type">HelloService</span> <span class="variable">helloService</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HelloServiceImpl</span>();</span><br><span class="line">      <span class="comment">//按约定获取proxy</span></span><br><span class="line">      <span class="type">HelloService</span> <span class="variable">proxy</span> <span class="operator">=</span> (HelloService) ProxyBean.getProxyBean(helloService,<span class="keyword">new</span> <span class="title class_">MyInterceptor</span>());</span><br><span class="line">      proxy.sayHello(<span class="string">&quot;LWT&quot;</span>);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></div></figure>

<p>输出如下:<br><img src="/2020/02/09/Spring-Boot%E5%AD%A6%E4%B9%A0v2/consoleout.png" alt="输出"></p>
<p><strong>重点方法:</strong><code>getProxyBean</code>和<code>invoke</code>。</p>

        <h3 id="AOP术语和流程">
          <a href="#AOP术语和流程" class="heading-link"><i class="fas fa-link"></i></a><a href="#AOP术语和流程" class="headerlink" title="AOP术语和流程"></a>AOP术语和流程</h3>
      <ol>
<li><p><strong>连接点（join point）</strong>:对应的是具体被拦截的对象。因为Spring只能支持方法。故呗拦截的对象往往就是指特定的方法。</p>
</li>
<li><p>**切点(point cut)**：通过正则式和指示器的规则定义，从而适配连接点。切点就是提供这样一个功能的概念。</p>
</li>
<li><p>**通知(advice)**：按照约定的流程下的方法。</p>
</li>
<li><p>**目标对象(target)**：即被代理对象。—–getProxyBean方法。</p>
</li>
<li><p><strong>引入(introduction)</strong>:指引入的新的类和其方法</p>
</li>
<li><p><strong>织入(weaving)</strong>:通过动态代理技术，为原有服务对象生成代理对象，然后将与切点定义匹配的连接点拦截，并按约定将各类通知织入约定流程的过程。</p>
</li>
<li><p>**切面(aspect)**：是一个可以定义切点，各类通知引入的内容。</p>
</li>
</ol>

        <h2 id="AOP实例详解">
          <a href="#AOP实例详解" class="heading-link"><i class="fas fa-link"></i></a><a href="#AOP实例详解" class="headerlink" title="AOP实例详解"></a>AOP实例详解</h2>
      <ul>
<li>确定连接点（用户服务接口）</li>
</ul>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">package</span> com.example.springaop.aopdemo.HelloInter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.springaop.aopdemo.pojo.User;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">printUser</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">PrintUser</span><span class="params">(User user)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>
<p>（实现方法）</p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">package</span> com.example.springaop.aopdemo.IntercepImpl;</span><br><span class="line"><span class="keyword">import</span> com.example.springaop.aopdemo.HelloInter.printUser;</span><br><span class="line"><span class="keyword">import</span> com.example.springaop.aopdemo.pojo.User;</span><br><span class="line"><span class="keyword">import</span> java.util.logging.Logger;</span><br><span class="line"><span class="meta">@Service(&quot;auser&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">printUserImpl</span> <span class="keyword">implements</span> <span class="title class_">printUser</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">PrintUser</span><span class="params">(User user)</span> &#123;</span><br><span class="line">       <span class="keyword">if</span>(user == <span class="literal">null</span>)&#123;</span><br><span class="line">           <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;所得用户为空&quot;</span>);</span><br><span class="line">       &#125;</span><br><span class="line">        <span class="type">Logger</span> <span class="variable">log</span> <span class="operator">=</span> Logger.getLogger(<span class="string">&quot;日志&quot;</span>);</span><br><span class="line">        log.info(<span class="string">&quot;用户姓名:&quot;</span>+user.getUserName());</span><br><span class="line">        log.warning(<span class="string">&quot;用户Id:&quot;</span>+user.getId());</span><br><span class="line">        log.fine(<span class="string">&quot;用户年龄:&quot;</span>+user.getAge());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<ul>
<li>引入依赖，定义切面</li>
</ul>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-boot-starter-aop&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></div></figure>

<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.springaop.aopdemo.Aspect;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.*;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">aspect</span> &#123;</span><br><span class="line">    <span class="meta">@Before(&quot;execution(* com.example.springaop.aopdemo.IntercepImpl.printUserImpl.PrintUser(..))&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">before</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;前置方法...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@After(&quot;execution(* com.example.springaop.aopdemo.IntercepImpl.printUserImpl.PrintUser(..))&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">after</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;后置方法...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@AfterReturning(&quot;execution(* com.example.springaop.aopdemo.IntercepImpl.printUserImpl.PrintUser(..))&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterReturning</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;后置返回方法...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@AfterThrowing(&quot;execution(* com.example.springaop.aopdemo.IntercepImpl.printUserImpl.PrintUser(..))&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterThrowing</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;后置错误方法...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>

<blockquote>
<p>以上定义切面可简化为:</p>
</blockquote>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.springaop.aopdemo.Aspect;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.*;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">aspect</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Pointcut(&quot;execution(* com.example.springaop.aopdemo.IntercepImpl.printUserImpl.PrintUser(..))&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">pointCut</span><span class="params">()</span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Before(&quot;pointCut()&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">before</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;前置方法...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@After(&quot;pointCut()&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">after</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;后置方法...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@AfterReturning(&quot;pointCut()&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterReturning</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;后置返回方法...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@AfterThrowing(&quot;pointCut()&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterThrowing</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;后置错误方法...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>

<p><strong>以上正则表达式的含义:</strong></p>
<ol>
<li><p>execution:表示在执行的时候，拦截里面的正则匹配的方法</p>
</li>
<li><p>*： 表示返回任何类型的方法</p>
</li>
<li><p>com.example.springaop.aopdemo.IntercepImpl.printUserImpl：制定目标对象的全限定名称</p>
</li>
<li><p>printUser:指定目标对象的方法</p>
</li>
<li><p>(..):表示任意参数进行匹配</p>
</li>
</ol>
<ul>
<li>控制器–aspectController</li>
</ul>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.springaop.aopdemo.testController;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.springaop.aopdemo.IntercepImpl.printUserImpl;</span><br><span class="line"><span class="keyword">import</span> com.example.springaop.aopdemo.pojo.User;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/user&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">aspectController</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">printUserImpl</span> <span class="variable">auser</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/print&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">printUsers</span><span class="params">(<span class="type">int</span> Id,String name,<span class="type">int</span> age)</span>&#123;</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">        user.setId(Id);</span><br><span class="line">        user.setAge(age);</span><br><span class="line">        user.setUserName(name);</span><br><span class="line">        auser.PrintUser(user);</span><br><span class="line">        <span class="keyword">return</span> user;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<ul>
<li>SpringBoot配置启动文件</li>
</ul>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.springaop.aopdemo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.springaop.aopdemo.Aspect.aspect;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AopdemoApplication</span> &#123;</span><br><span class="line">    <span class="meta">@Bean(name = &quot;aspectA&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> aspect <span class="title function_">myAspect</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">aspect</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(AopdemoApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>

<blockquote>
<p>最后在浏览器地址栏中输入请求地址:<span class="exturl"><a class="exturl__link" target="_blank" rel="noopener" href="http://localhost:8080/user/print?id=1&amp;userName=userName&amp;age=3">http://localhost:8080/user/print?id=1&amp;userName=userName&amp;age=3</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>
</blockquote>
<ul>
<li>环绕通知i</li>
</ul>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Around(&quot;pointCut()&quot;)</span></span><br><span class="line"> <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">aroundAdvice</span><span class="params">(ProceedingJoinPoint p)</span>&#123;</span><br><span class="line">     <span class="keyword">try</span> &#123;</span><br><span class="line">         System.out.println(<span class="string">&quot;环绕前&quot;</span>);</span><br><span class="line">         p.proceed();</span><br><span class="line">         System.out.println(<span class="string">&quot;环绕后&quot;</span>);</span><br><span class="line">     &#125; <span class="keyword">catch</span> (Throwable throwable) &#123;</span><br><span class="line">         throwable.printStackTrace();</span><br><span class="line">     &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></div></figure>

<p>再次测试查看日志:</p>
<p><img src="/2020/02/09/Spring-Boot%E5%AD%A6%E4%B9%A0v2/QQ%E6%88%AA%E5%9B%BE20200322111102.png"></p>
<p><strong>注意此处“前置方法”打印在“环绕前”之后，可能是什么版本差异的bug</strong></p>
<ul>
<li>引入</li>
</ul>
<p>上述切面中，如果我们传的user类的值为null的话，那么就会打印AfterThrowing的内容。那么如何在不改变原有Service类的情况下判断user值为空的话就不去调用 auser.PrintUser(user);的方法呢。</p>
<ol>
<li>定义新的Servicec类，用来判断user对象是否为null</li>
</ol>
<p>定义接口</p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.springaop.aopdemo.HelloInter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.springaop.aopdemo.pojo.User;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">userValidtor</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">userIsNull</span><span class="params">(User user)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<p>实现类</p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.springaop.aopdemo.IntercepImpl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.springaop.aopdemo.HelloInter.userValidtor;</span><br><span class="line"><span class="keyword">import</span> com.example.springaop.aopdemo.pojo.User;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">userValidatorImpl</span> <span class="keyword">implements</span> <span class="title class_">userValidtor</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">userIsNull</span><span class="params">(User user)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(user == <span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>
<ol start="2">
<li>切面引入新的接口</li>
</ol>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@DeclareParents(value = &quot;com.example.springaop.aopdemo.IntercepImpl.printUserImpl+&quot;,defaultImpl = userValidatorImpl.class)</span></span><br><span class="line">   <span class="keyword">public</span> userValidtor uValidator;</span><br></pre></td></tr></table></div></figure>

<blockquote>
<p>@DeclareParents注解表示引入新的类来增强服务。它有两个必须配置的属性：value和deefaultImpl</p>
</blockquote>
<p><strong>value</strong>属性指向的是你要增强功能的目标对象，比如这里要增强的是printUserImpl，故配置为value &#x3D; “com.example.springaop.aopdemo.IntercepImpl.printUserImpl+”。</p>
<p><strong>defaultImpl</strong>表示的是引入增强功能的类，这里配置的是defaultImpl &#x3D; userValidatorImpl.class。</p>
<p>注意两个属性都是实现的类而不是接口。</p>
<p>3.Controller中测试</p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.springaop.aopdemo.testController;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.springaop.aopdemo.HelloInter.userValidtor;</span><br><span class="line"><span class="keyword">import</span> com.example.springaop.aopdemo.IntercepImpl.printUserImpl;</span><br><span class="line"><span class="keyword">import</span> com.example.springaop.aopdemo.pojo.User;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/user&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">aspectController</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">printUserImpl</span> <span class="variable">auser</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/print&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">printUsers</span><span class="params">(<span class="type">int</span> Id,String name,<span class="type">int</span> age)</span>&#123;</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">        user.setId(Id);</span><br><span class="line">        user.setAge(age);</span><br><span class="line">        user.setUserName(name);</span><br><span class="line">        <span class="type">userValidtor</span> <span class="variable">uVal</span> <span class="operator">=</span> (userValidtor)auser;</span><br><span class="line">        <span class="keyword">if</span>(!uVal.userIsNull(user))&#123;</span><br><span class="line">            auser.PrintUser(user);</span><br><span class="line">        &#125;</span><br><span class="line">        auser.PrintUser(user);</span><br><span class="line">        <span class="keyword">return</span> user;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<p>上述代码中，<code>userValidtor uVal = (userValidtor)auser;</code></p>
<p>userVlidtor为引入的类的接口。将auser强制转换为userValidtor类型。然后调用userIsNull方法判断当前对象是否为null。如果为null。则不执行打印方法。00                  </p>
<ul>
<li>通知获取参数</li>
</ul>
<p>前置通知</p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Before(&quot;pointCut() &amp;&amp; args(user)&quot;)</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">before</span><span class="params">(JoinPoint point,User user)</span>&#123;</span><br><span class="line">      System.out.println(<span class="string">&quot;point的args:&quot;</span>+point.getArgs());</span><br><span class="line">      System.out.println(<span class="string">&quot;User:&quot;</span>+user.getUserName());</span><br><span class="line">      System.out.println(<span class="string">&quot;前置方法...&quot;</span>);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></div></figure>

<p><strong>以上AOP的实现都是采用接口+实现类的模式，这是Spring推荐的模式。但是对于是否拥有接口则并不是SpringBoot的强制要求。当你需要使用AOP的类拥有接口时，它会以JDK动态代理运行，否则以CGLIB运行。</strong></p>

        <h2 id="多个切面">
          <a href="#多个切面" class="heading-link"><i class="fas fa-link"></i></a><a href="#多个切面" class="headerlink" title="多个切面"></a>多个切面</h2>
      <p>Spring可以支持多个切面的运行，在组织多个切面时，需要知道其顺序。</p>
<p>如：</p>
<p><strong>第一个切面</strong></p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Order(1)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyAspect1</span>&#123;</span><br><span class="line">...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>


<p><strong>第二个切面</strong></p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Order(2)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyAspect2</span>&#123;</span><br><span class="line">...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>


<p><strong>第三个切面</strong></p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Order(3)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyAspect3</span>&#123;</span><br><span class="line">...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<p>这样如果三个切面同时拦截一个方法，那么这三个切面将会以顺序进行拦截。如果没有@Order这个注解的话。切面拦截的顺序将会是混乱的。</p>

        <h2 id="本章总结">
          <a href="#本章总结" class="heading-link"><i class="fas fa-link"></i></a><a href="#本章总结" class="headerlink" title="本章总结"></a>本章总结</h2>
      <p>本章主要记录了SpringBoot中Spring AOP的主要写法和其示例。便于以后得到快速学习复习。</p>
<ol>
<li><p>AOP 术语：连接点，通常指被拦截的方法;切点，指通过正则式或者指示器的规则定义，从而适配连接点;通知，按照约定流程的方法；目标对象，指被代理的对象；引入，当一个服务类不能满足需求但有不能更改这个服务类时可以引入另一个服务类增强原有服务类的实现；织入，将各类通知织入约定流程；切面，定义各类切点，通知和引入的内容</p>
</li>
<li><p>定义切面：关键注解： @Aspect</p>
</li>
<li><p>定义切点：关键注解： @PointCut</p>
</li>
<li><p>引入新的接口：关键注解： @DeclareParents(value,dedfaultImpl)</p>
</li>
</ol>
</div></div></article></section><nav class="paginator"><div class="paginator-inner"><a class="extend prev" rel="prev" href="/page/3/"><i class="fas fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/3/">3</a><span class="page-number current">4</span><a class="page-number" href="/page/5/">5</a><a class="extend next" rel="next" href="/page/5/"><i class="fas fa-angle-right"></i></a></div></nav></div></div><div class="sidebar-wrap" id="sidebar-wrap"><aside class="sidebar" id="sidebar"><section class="sidebar-toc hide"></section><!-- ov = overview--><section class="sidebar-ov"><div class="sidebar-ov-author"><div class="sidebar-ov-author__avatar"><img class="sidebar-ov-author__avatar_img" src="/images/icons/stun-logo.svg" alt="avatar"></div><p class="sidebar-ov-author__text">hello world</p></div><div class="sidebar-ov-state"><a class="sidebar-ov-state-item sidebar-ov-state-item--posts" href="/archives/"><div class="sidebar-ov-state-item__count">46</div><div class="sidebar-ov-state-item__name">Archives</div></a><a class="sidebar-ov-state-item sidebar-ov-state-item--categories" href="/categories/"><div class="sidebar-ov-state-item__count">0</div><div class="sidebar-ov-state-item__name">Categories</div></a><a class="sidebar-ov-state-item sidebar-ov-state-item--tags" href="/tags/"><div class="sidebar-ov-state-item__count">68</div><div class="sidebar-ov-state-item__name">Tags</div></a></div><div class="sidebar-ov-cc"><a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en" target="_blank" rel="noopener" data-popover="Creative Commons" data-popover-pos="up"><img src="/images/cc-by-nc-sa.svg"></a></div></section></aside></div><div class="clearfix"></div></div></main><footer class="footer" id="footer"><div class="footer-inner"><div><span>Copyright © 2022</span><span class="footer__icon"><i class="fas fa-heart"></i></span><span>ashen</span></div><div><span>Powered by <a href="http://hexo.io/" title="Hexo" target="_blank" rel="noopener">Hexo</a></span><span> v6.1.0</span><span class="footer__devider">|</span><span>Theme - <a href="https://github.com/liuyib/hexo-theme-stun/" title="Stun" target="_blank" rel="noopener">Stun</a></span><span> v2.6.2</span></div></div></footer><div class="loading-bar" id="loading-bar"><div class="loading-bar__progress"></div></div><div class="back2top" id="back2top"><span class="back2top__icon"><i class="fas fa-rocket"></i></span></div></div><script src="https://cdn.jsdelivr.net/npm/jquery@v3.4.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@1.5.2/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@1.5.2/velocity.ui.min.js"></script><script src="/js/utils.js?v=2.6.2"></script><script src="/js/stun-boot.js?v=2.6.2"></script><script src="/js/scroll.js?v=2.6.2"></script><script src="/js/header.js?v=2.6.2"></script><script src="/js/sidebar.js?v=2.6.2"></script></body></html>